(window.webpackJsonp=window.webpackJsonp||[]).push([["trading"],{"+J+G":function(t,e,i){t.exports=i.p+"alarm_clock.48d3df0afe4d4981523b8a12e4e25f92.mp3"},"+xnd":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToastIntent=void 0,function(t){t.Default="default",t.Success="success",t.Warning="warning",t.Danger="danger"}(e.ToastIntent||(e.ToastIntent={}))},"0jws":function(t,e,i){t.exports={blockHidden:"blockHidden-pECc1q1w","pane-button":"pane-button-3IbFaPrJ"}},"0sCh":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("q1tI"),r=function(){var t=Object(o.useRef)(!1);return Object(o.useEffect)((function(){return t.current=!0,function(){t.current=!1}}),[]),t}},"1rjR":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));i("HbRj"),i("YFKU");var o=i("hHwE"),r={get:function(){return this},open:function(t){var e=window.t("Cancel Order"),i="<p>"+window.t("Are you sure you want to cancel order %s?").replace(/%s/,String(t))+"</p>";return Object(o.a)(e,i)},multiple:function(t,e,i){var r=t;void 0!==e&&(r+=" ",r+=1===e?window.t("BUY"):window.t("SELL"));var n=window.t("Cancel Orders"),s="<p>"+window.t("Are you sure you want to cancel {0} {1} orders?").format(String(i),r)+"</p>";return Object(o.a)(n,s)}}},"2TBc":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("Eyy1"),r=function(){function t(t){this._activeBroker=null,this._trading=t,this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange),this._onStatusChange(this._trading.connectStatus())}return t.prototype.activeBroker=function(){return this._activeBroker},t.prototype.trading=function(){return this._trading},t.prototype._stopService=function(){this.stopService(),Object(o.ensureNotNull)(this._activeBroker).currentAccountUpdate.unsubscribeAll(this)},t.prototype._startService=function(){this.startService(),Object(o.ensureNotNull)(this._activeBroker).currentAccountUpdate.subscribe(this,this._onCurrentAccountUpdate)},t.prototype._onStatusChange=function(t){var e=this._trading.activeBroker();this._activeBroker===e&&1===t||(null!==this._activeBroker&&(this._stopService(),this._activeBroker=null),null!==e&&1===t&&(this._activeBroker=e,this._startService(),this._lastAccountId=e.currentAccount()))},t.prototype._onCurrentAccountUpdate=function(){var t=Object(o.ensureNotNull)(this._activeBroker);this._lastAccountId!==t.currentAccount()&&(this.stopService(),this.startService(),this._lastAccountId=t.currentAccount())},t}()},"5XxY":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i("HbRj"),i("YFKU");var o={show:function(t,e,o){Promise.all([i.e(40),i.e("dialogs-core"),i.e(49),i.e(36),i.e("create-dialog")]).then(function(r){var n=i("YDhE").createDialog,s=[{name:"ok",text:window.t("Ok"),type:"primary",method:"close"}];o&&s.push({name:"do-not-show-again",type:"checkbox",text:window.t("Don't show anymore"),checked:!1,addClass:"tv-control-checkbox tv-control-checkbox--do-not-show-again i-align_left i-float_left"});var a=n({title:t,content:e,width:500,type:"modal",draggable:!1,
destroyOnClose:!0,closeOnOutsideClick:!1,addClass:"tv-text",actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--actions-adaptive tv-dialog__section--actions_multiline tv-dialog__section--no-border">',actions:s});o&&a.on("action:do-not-show-again",(function(t,e){o(e)})),a.open()}.bind(null,i)).catch(i.oe)}}},"6aj4":function(t,e,i){t.exports={"trading-panel-content":"trading-panel-content-1fMpgHzg","trading-panel-spinner":"trading-panel-spinner-302GKpcG","trading-panel-handle":"trading-panel-handle-31nauMFK"}},"8Wzo":function(t,e,i){"use strict";var o;i.r(e),i.d(e,"StopType",(function(){return o})),function(t){t[t.StopLoss=0]="StopLoss",t[t.TrailingStop=1]="TrailingStop"}(o||(o={}))},"8wgr":function(t,e,i){"use strict";i.r(e),i.d(e,"settingsKeys",(function(){return o}));var o={ACTIVE_BROKER:"trading.active_broker",FILTER_BROKER:"trading.filter_brokers_by_locale",PROPERTIES:"trading.chart.proterty",QTY:"trading.qty.",BROKERS_QTY:"trading.brokers.qty",PROFIT_VIEW_TYPE:"trading.dom.profitViewType",ORDER_WIDGET_MODE:"trading.orderWidgetMode.",TAKE_PROFIT:"trading.takeprofit.",STOP_LOSS:"trading.stoploss.",ORDER_DURATION:"trading.orderDuration.",TRADING_PANEL_OPENED:"trading.tradingPanelOpened",TRADING_PANEL_ACTIVE_PAGE:"trading.tradingPanelActivePage",PANEL_WIDTH:"trading.panelWidth",PANEL_HEIGHT:"trading.panelHeight",ORDER_PANEL_SETTINGS:"trading.orderPanelSettings",FAVORITE_BROKERS:"trading.panelFavorite",REVIEW_DIALOG_WAS_SHOWED:"trading.reviewDialogShowedOnLogin",SHOW_TOOLTIP_FOR_SELECT_BROKER:"trading.showTooltipForSelectBroker",LOGIN_COUNTER:"trading.brokerLogInCounter",LOGOUT_COUNTER:"trading.brokerLogOutCounter"}},"9pog":function(t,e,i){"use strict";i.r(e),i.d(e,"abbreviatedNumber",(function(){return n}));var o=i("zXvd"),r=["","K","M","G","T","Y"];function n(t){if(t<1)return o.NumericFormatter.formatNoE(t);var e=0,i=+t;if(isFinite(i))for(;i>=1e3&&i%100==0;)e++,i/=1e3;return i+(e<r.length?r[e]:"e"+3*e)}},AvGy:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("qFKp"),r=o.CheckMobile.any()},C9TK:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));i("HbRj"),i("YFKU");var o=i("hHwE");function r(t,e,i,r){return new Promise((function(n){var s=window.t("Reverse {0} position?").format(t),a="<p>"+(r?window.t("Are you sure you want to reverse {positionId} position?{newLineAndBoldText}This will also close all active orders.{endBoldText}"):window.t("Are you sure you want to reverse {positionId} position?")).format({positionId:t,newLineAndBoldText:"<br><b>",endBoldText:"</b>"})+"</p>",c=window.t("Reverse position"),u=window.t("Cancel");Object(o.a)(s,a,c,u).then((function(t){return!0===t?i():n(!1)})).then((function(){n(!0)})).catch((function(t){var i="";null!==t&&"object"==typeof t&&t.message?i=t.message:"string"==typeof t&&(i=t);var o=window.t("Failed to reverse position");e(o,i),n(!1)}))}))}},E9hm:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return r}));var o={isSuspended:!1,supportDemoLiveSwitcher:!0,
supportEditAmount:!0,supportMarketBrackets:!0,supportMarketOrders:!0,supportStopOrders:!0,supportLimitOrders:!0,supportStopLimitOrders:!1,supportPositions:!0,supportDOM:!0,supportModifyOrder:!0,supportAddBracketsToExistingOrder:!0,supportVerifyLiveAccount:!0,supportReversePosition:!0};function r(t){return Object.assign({},o,t)}},EOiv:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i("fBig"),r=function(){function t(t,e){void 0===e&&(e={}),this._loadingEl=null,this._parentEl=t,this._options=e,this._renderLoading()}return t.prototype.toggleVisibility=function(t){null!==this._loadingEl&&this._loadingEl.classList.toggle(o.shown,t)},t.prototype._renderLoading=function(){this._loadingEl=document.createElement("span"),this._loadingEl.classList.add(o.loader),this._options.className&&this._loadingEl.classList.add(this._options.className),this._loadingEl.innerHTML='\n\t\t\t<span class="'+o.loaderItem+'"></span>\n\t\t\t<span class="'+o.loaderItem+'"></span>\n\t\t\t<span class="'+o.loaderItem+'"></span>\n\t\t',this._parentEl.appendChild(this._loadingEl)},t}()},End0:function(t,e,i){"use strict";i.r(e);var o=i("mrSG"),r=(i("P5fv"),i("bSeV"),i("YFKU")),n=(i("X8qL"),i("Eyy1")),s=i("ivNn"),a=i("Hgre"),c=i("OekH"),u=i("8wgr"),l=i("U/Is"),d=i("aIyQ"),h=i.n(d),p=i("txPx"),_=i("d13A"),f=Object(p.getLogger)("Trading.RealtimeProvider"),b=function(){function t(t){this._results={},this._getter=t}return t.prototype.get=function(t){return this._results[t]||(this._results[t]=this._getter(t)),this._results[t]},t}(),y=function(){function t(t,e,i,o,r){var n=this;this._stopped=!1,this._subscribed=!1,this._provider=null,this._formatters=null,this._symbol=t,this._type=r,this._callback=e,this._providersCache=i,this._formattersCache=o,"Realtime"===this._type?this._handler=function(t,i){n._stopped||e(t,i,n._formatters)}:this._handler=function(t,i){n._stopped||e(t,i)},this._start().catch((function(t){}))}return t.prototype.symbol=function(){return this._symbol},t.prototype.type=function(){return this._type},t.prototype.callback=function(){return this._callback},t.prototype.destroy=function(){this._ensureNotStopped(),this._subscribed&&("Realtime"===this._type?Object(n.ensureNotNull)(this._provider).unsubscribeRealtime(this._symbol,this._handler):Object(n.ensureNotNull)(this._provider).unsubscribeDOME(this._symbol,this._handler)),this._stopped=!0},t.prototype._start=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return t=this,[4,this._providersCache.get(this._symbol)];case 1:return t._provider=i.sent(),this._ensureNotStopped(),e=this,[4,this._formattersCache.get(this._symbol)];case 2:return e._formatters=i.sent(),Object(n.ensure)(this._formatters),this._ensureNotStopped(),this._subscribed=!0,"Realtime"===this._type?this._provider.subscribeRealtime(this._symbol,this._handler):this._provider.subscribeDOME(this._symbol,this._handler),[2]}}))}))},t.prototype._ensureNotStopped=function(){Object(n.assert)(!this._stopped,"Should not be stopped")
},t}(),m=function(){function t(t,e,i,o){this.onStatusChanged=new h.a,this._subscriptions=[],this._currentBroker=null,this._activeBrokerGetter=t,this._suggestedQty=o,e.subscribe(this,this._connectionStatusChanged),i.subscribe(this,this._connectionStatusChanged),this._tvProvider=new l.a("RealtimeProvider"),this._connectionStatusChanged()}return t.prototype.isTradable=function(t){return this._tradableCache.get(t)},t.prototype.subscribeRealtime=function(t,e){this._subscriptions.some((function(i){return i.symbol()===t&&i.callback()===e&&"Realtime"===i.type()}))||this._subscriptions.push(new y(t,e,this._providersCache,this._formattersCache,"Realtime"))},t.prototype.unsubscribeRealtime=function(t,e){var i=this._subscriptions.findIndex((function(i){return i.symbol()===t&&i.callback()===e&&"Realtime"===i.type()}));-1!==i?(this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)):f.logWarn("Subscription not found")},t.prototype.subscribeDOME=function(t,e){this._subscriptions.some((function(i){return i.symbol()===t&&i.callback()===e&&"Dome"===i.type()}))||this._subscriptions.push(new y(t,e,this._providersCache,this._formattersCache,"Dome"))},t.prototype.unsubscribeDOME=function(t,e){var i=this._subscriptions.findIndex((function(i){return i.symbol()===t&&i.callback()===e&&"Dome"===i.type()}));-1!==i?(this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)):f.logWarn("Subscription not found")},t.prototype.formatter=function(t){return this._formattersCache.get(t).then((function(t){return t.formatter}))},t.prototype.spreadFormatter=function(t){return this._formattersCache.get(t).then((function(t){return t.spreadFormatter}))},t.prototype.quantityFormatter=function(t){return this._formattersCache.get(t).then((function(t){return t.quantityFormatter}))},t.prototype.symbolInfo=function(t){var e=this;if(!t){var i={minTick:NaN,qty:{min:NaN,max:NaN,step:NaN},pipValue:NaN,pipSize:NaN,description:"no symbol"};return Promise.resolve(i)}return this._providersCache.get(t).then((function(i){return i!==e._tvProvider?i.symbolInfo(t).then((function(i){return i||e._tvProvider.symbolInfo(t)})).catch((function(i){return e._tvProvider.symbolInfo(t)})):e._tvProvider.symbolInfo(t)}))},t.prototype.quotesSnapshot=function(t){return this._providersCache.get(t).then((function(e){return e.quotesSnapshot(t)}))},t.prototype.activeBroker=function(){return null!==this._currentBroker&&this._currentBroker!==this._tvProvider?this._currentBroker:null},t.prototype._isTradable=function(t){if(null===this._currentBroker||this._currentBroker===this._tvProvider)return Promise.resolve({tradable:!1});try{return Object(_.a)(this._currentBroker.isTradable(t),6e4,"isTradable Promise Timeout").catch((function(){return Promise.resolve({tradable:!1})}))}catch(e){return Promise.resolve({tradable:!1})}},t.prototype._haveRealtime=function(t){return this._tradableCache.get(t)||Promise.resolve(null===this._currentBroker)},t.prototype._connectionStatusChanged=function(){var t=this,e=this._activeBrokerGetter(),i=this._currentBroker,o=e&&1===e.connectionStatus()?e:null
;if(this._createCaches(),i!==o){var r=this._subscriptions.map((function(t){return{symbol:t.symbol(),callback:t.callback(),type:t.type()}}));this._unsubscribeAll(),this._currentBroker=o,this._subscribeAll(r),this._allSymbols().forEach((function(e){t._suggestedQty.changed.fire(e)})),this.onStatusChanged.fire()}},t.prototype._allSymbols=function(){var t=new Set;return this._subscriptions.forEach((function(e){return t.add(e.symbol())})),Array.from(t)},t.prototype._createCaches=function(){var t=this;this._providersCache=new b((function(e){return t._provider(e)})),this._tradableCache=new b((function(e){return t._isTradable(e)})),this._formattersCache=new b((function(e){return t._providersCache.get(e).then((function(t){return Promise.all([t.formatter(e,!1),t.spreadFormatter(e),t.quantityFormatter(e)])})).then((function(t){return{formatter:t[0],spreadFormatter:t[1],quantityFormatter:t[2]}}))}))},t.prototype._provider=function(t){var e=this;return this._haveRealtime(t).then((function(t){return t.tradable&&e._currentBroker&&1===e._currentBroker.connectionStatus()?e._currentBroker:e._tvProvider}))},t.prototype._unsubscribeAll=function(){this._subscriptions.forEach((function(t){t.destroy()})),this._subscriptions=[]},t.prototype._subscribeAll=function(t){var e=this;t.forEach((function(t){e._subscriptions.push(new y(t.symbol,t.callback,e._providersCache,e._formattersCache,t.type))}))},t}(),g=i("2TBc"),v=function(t){function e(e){var i=t.call(this,e)||this;return i._userId=(window.user.id||"").toString(),window.loginStateChange&&window.loginStateChange.subscribe(i,i._onLoginStateChange),i}return Object(o.__extends)(e,t),e.prototype.trackOrderPlaced=function(t){this._trackOrderEvent("Placed",t)},e.prototype.startService=function(){Object(n.ensure)(this.activeBroker()).orderUpdate.subscribe(this,this._orderUpdate),this._trackTradingBrokerConnnected()},e.prototype.stopService=function(){Object(n.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)},e.prototype._orderUpdate=function(t,e){e||(5===t.status?this._trackOrderEvent("Rejected",t):2===t.status?this._trackOrderEvent("Executed",t):1===t.status&&this._trackOrderEvent("Canceled",t))},e.prototype._trackOrderEvent=function(t,e){var i=this,o=this.activeBroker();e&&o&&o.symbolInfo(e.symbol).then((function(o){var r={amount:e.qty*(o.lotSize||1),instrumentType:o.type,eventName:"Order "+t,userId:i._userId};i._trackTradingOrder(r)}))},e.prototype._trackTradingOrder=function(t){var e=this.activeBroker();if(!e)throw new Error("no active broker")},e.prototype._trackTradingBrokerConnnected=function(){var t=this.activeBroker();null!==t&&t.metainfo().id;if(!t)throw new Error("no active broker")},e.prototype._onLoginStateChange=function(){this._userId=(window.user.id||"").toString()},e}(g.a),k=i("Vdly"),w=i("4qhP"),P=i("9pog"),O=i("1AAW"),B=i("hY0g"),S=i.n(B),C=i("PT1i"),T=i("JWMC"),E=i("+xnd"),j=i("QloM");function I(t){switch(void 0===t&&(t="default"),t){case"danger":return E.ToastIntent.Danger;case"attention":return E.ToastIntent.Warning;case"success":
return E.ToastIntent.Success;default:return E.ToastIntent.Default}}var D=function(){function t(t){this._chartWidgetCollection=t}return t.prototype.proSymbol=function(){return C.linking.proSymbol.value()},t.prototype.showTradingProperties=function(){this._chartWidgetCollection.activeChartWidget.value().showGeneralChartProperties(j.TabNames.trading)},t.prototype.showNotification=function(t,e,i,r){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this._chartWidgetCollection.getToasts()];case 1:return null===(n=o.sent())||(s="","string"==typeof e&&(s=e),n.showSimpleToast({text:s,time:r,title:t,intent:I(i)})),[2]}}))}))},t.prototype.showMaintenance=function(t){0},t.prototype.trackEvent=function(t,e,i){Object(T.trackEvent)(t,e,i)},t.prototype.showReplayConfirmationDialog=function(){return Promise.resolve()},t.prototype.reconnectChartApi=function(t){0},t}(),A=i("Kxc7"),N=i("8Wzo"),L=(i("HbRj"),i("i8i4")),M=i("q1tI"),R=i("0sCh"),V=function(t){var e=Object(M.useState)(!1),i=e[0],o=e[1];return Object(M.useEffect)((function(){!i&&t&&o(!0)}),[t]),i},U=M.lazy((function(){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,Promise.all([i.e("react"),i.e(4),i.e(10),i.e(20),i.e(23),i.e(29),i.e(42),i.e(150),i.e(0),i.e("confirmation-dialog")]).then(i.bind(null,"LUc8"))];case 1:return[2,{default:t.sent().СonfirmationDialog}]}}))}))})),q=M.memo((function(t){var e=Object(R.a)();return(V(t.isOpen)||t.isOpen)&&e?M.createElement(M.Suspense,{fallback:null},M.createElement(U,Object(o.__assign)({},t))):null})),F=function(){function t(){var t=this;this._close=function(){L.unmountComponentAtNode(t._root)},this._root=document.createElement("div")}return t.prototype.open=function(t,e){var i=this,r={isOpen:!0,title:window.t("Close position"),mainText:e,closeButton:window.t("Cancel"),confirmButton:window.t("Close position"),onClose:function(){t({status:!1}),i._close()},onConfirm:function(){t({status:!0}),i._close()},buttonAppearanceConfirm:"default",buttonIntentConfirm:"primary",reverseButtons:!0};L.render(M.createElement(q,Object(o.__assign)({},r)),this._root)},t}();function x(t,e,i){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Q(i)];case 1:if(!o.sent().status)return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e()];case 3:return[2,o.sent()];case 4:return r=o.sent(),n=window.t("Failed to close the position"),t(n,function(t){var e="";null!==t&&"object"==typeof t&&t.message?e=t.message:"string"==typeof t&&(e=t);return e}(r)),[2,!1];case 5:return[3,7];case 6:return[2,!1];case 7:return[2]}}))}))}function Q(t){var e=new F;return new Promise((function(i){e.open(i,t)}))}var W=i("C9TK"),H=i("1rjR"),K=i("QBLL");i("5XxY");var G,z=M.lazy((function(){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){
case 0:return[4,Promise.all([i.e("react"),i.e(4),i.e(10),i.e(11),i.e(12),i.e(20),i.e(21),i.e(23),i.e(24),i.e(42),i.e(145),i.e(0),i.e(19),i.e(25),i.e(22),i.e("partially-closing-dialog")]).then(i.bind(null,"zSOM"))];case 1:return[2,{default:t.sent().PartiallyClosingDialog}]}}))}))})),Y=(G=z,function(t){var e=Object(R.a)();return(V(t.isOpen)||t.isOpen)&&e?M.createElement(M.Suspense,{fallback:null},M.createElement(G,Object(o.__assign)({},t))):null}),J=function(){function t(){var t=this;this._close=function(){L.unmountComponentAtNode(t._root)},this._root=document.createElement("div")}return t.prototype.open=function(t){var e=Object(o.__assign)(Object(o.__assign)({},t),{isOpen:!0,onClose:this._close});L.render(M.createElement(Y,Object(o.__assign)({},e)),this._root)},t}();function X(t,e,i){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Z(t)];case 1:if(!(r=o.sent()).status)return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e(r.qty)];case 3:return[2,o.sent()];case 4:return n=o.sent(),s=window.t("Failed to close the position"),i(s,function(t){var e="";null!==t&&"object"==typeof t&&t.message?e=t.message:"string"==typeof t&&(e=t);return e}(n)),[2,!1];case 5:return[3,7];case 6:return[2,!1];case 7:return[2]}}))}))}function Z(t){var e=new J;return new Promise((function(i){e.open(Object(o.__assign)(Object(o.__assign)({},t),{dialogActionHandler:i}))}))}var tt=Object(p.getLogger)("Trading.BrokerCommandsUI"),et={symbol:1,qty:1,side:1,type:1,seenPrice:1};var it=function(){function t(t,e,i,o,r,n){this._isClosePositionDialogLoading=!1,this._isCloseTradeDialogLoading=!1,this._activeBroker=t,this._guiAccessor=e,this._orderViewController=o,this._showErrorNotification=r,this._noConfirmEnabled=i,this._trackEvent=n}return t.prototype.placeOrder=function(t,e,i){var r;return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,s,a,c,u,l=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:0,this._makeSureBrokerIsConnected(),n=e&&this._noConfirmEnabled.value(),s=this._guiAccessor&&n?this._guiAccessor.showReplayConfirmationDialog():Promise.resolve(!1),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s];case 2:return o.sent(),[3,4];case 3:return o.sent(),Promise.resolve(!1),[3,4];case 4:return[4,this._activeBroker.isTradable(t.symbol)];case 5:return a=o.sent(),n&&a.tradable&&function(t){for(var e in et)if(!(e in t))return!1;return!0}(t)?(c=this._activeBroker.metainfo().durations,void 0===t.duration&&void 0!==c&&c.length>0&&(t.duration=null!==(r=Object(w.getSuitableDuration)(t.type,c))&&void 0!==r?r:{type:c[0].value}),[2,this._activeBroker.placeOrder(t)]):(u=this._activeBroker.metainfo()).customUI&&void 0!==u.customUI.showOrderDialog?[2,u.customUI.showOrderDialog(t)]:[2,this._orderViewController().then((function(e){return l._activeBroker?e.showOrderView(l._activeBroker,t,void 0,i):Promise.reject("Broker connection adapter is null")}))]}}))}))},t.prototype.modifyOrder=function(t,e,i,r){
return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,s,a,c,u,l,d,h,p,_,f,b=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return this._makeSureBrokerIsConnected(),t.flags&&t.flags.trailingStop?(tt.logError("Attempt to modify trailing stop loss order"+t.id),this._showErrorNotification(window.t("Cannot Modify Order"),window.t("Trailing Stops cannot be modified")),[2,Promise.resolve(!1)]):[4,this._activeBroker.symbolInfo(t.symbol)];case 1:if(n=o.sent(),t.limitPrice=void 0!==n.limitPriceStep&&void 0!==t.limitPrice?Object(w.roundToStepByPriceTypeAndSide)(t.limitPrice,n.limitPriceStep,1,t.side):t.limitPrice,t.stopPrice=void 0!==n.stopPriceStep&&void 0!==t.stopPrice?Object(w.roundToStepByPriceTypeAndSide)(t.stopPrice,n.stopPriceStep,2,t.side):t.stopPrice,s=t.limitPrice,a=t.stopPrice,c=t.stopType,u=e&&this._noConfirmEnabled.value(),l=i||(1===t.type?1:2),!t.parentId||A.enabled("always_pass_called_order_to_modify"))return[3,6];d=this._activeBroker.orderById.bind(this._activeBroker),2===t.parentType&&(d=this._activeBroker.positionById.bind(this._activeBroker)),3===t.parentType&&(d=this._activeBroker.tradeById.bind(this._activeBroker)),h=void 0,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,d(t.parentId)];case 3:return h=o.sent(),[3,5];case 4:return o.sent(),h=void 0,[3,5];case 5:if(h){if(l=i||(1===t.type?3:4),p={takeProfit:s},c===N.StopType.TrailingStop?p.trailingStopPips=t.trailingStopPips:p.stopLoss=a,u&&(p.takeProfit=p.takeProfit||h.takeProfit,p.stopLoss=p.stopLoss||h.stopLoss,p.trailingStopPips=p.trailingStopPips||h.trailingStopPips),3===t.parentType)return u?[2,this._activeBroker.editTradeBrackets(h.id,p)]:[2,this._showTradeDialog(h,p,l)];if(2===t.parentType&&t.qty===Math.abs(h.qty))return u?[2,this._activeBroker.editPositionBrackets(h.id,p)]:[2,this._showPositionDialog(h,p,l)];_=h,Object(w.isOrderActive)(_.status)&&(t=Object.assign({},_),s&&(t.takeProfit=s),a&&(c===N.StopType.TrailingStop?t.trailingStopPips=p.trailingStopPips||t.trailingStopPips:t.stopLoss=a))}o.label=6;case 6:return u?[2,this._activeBroker.modifyOrder(t)]:(f=this._activeBroker.metainfo()).customUI&&void 0!==f.customUI.showOrderDialog?[2,f.customUI.showOrderDialog(t,l)]:[2,this._orderViewController().then((function(e){return b._activeBroker?e.showOrderView(b._activeBroker,t,l,r):Promise.reject("Broker connection adapter is null")}))]}}))}))},t.prototype.closePosition=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,n,s,a=this;return Object(o.__generator)(this,(function(c){switch(c.label){case 0:return this._makeSureBrokerIsConnected(),this._noConfirmEnabled.value()?[2,this._activeBroker.closePosition(t)]:[3,1];case 1:return this._isClosePositionDialogLoading?[2,!1]:[4,this._obtainPositionClosingData(t)];case 2:return void 0===(e=c.sent())?[2,!1]:(i=e.supportPartialClosePosition,r=e.position,n=Object(o.__rest)(e,["supportPartialClosePosition","position"]),i?(s=function(i){
return i!==e.position.qty?a._trackEvent("","Close Position Dialog","partial"):a._trackEvent("","Close Position Dialog","full"),a._activeBroker.closePosition(t,i)},[2,X(Object(o.__assign)(Object(o.__assign)({},n),{positionOrTrade:r}),s,this._showErrorNotification)]):(s=function(){return a._activeBroker.closePosition(t)},[2,x(this._showErrorNotification,s,e.message)]));case 3:return[2]}}))}))},t.prototype.closeTrade=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,s,a,c=this;return Object(o.__generator)(this,(function(u){switch(u.label){case 0:return this._makeSureBrokerIsConnected(),Object(n.assert)(!!this._activeBroker.config.supportTrades,"Broker doesn`t support trades"),this._noConfirmEnabled.value()?[2,this._activeBroker.closeTrade(t)]:[3,1];case 1:return this._isCloseTradeDialogLoading?[2,!1]:[4,this._obtainTradeClosingData(t)];case 2:return void 0===(e=u.sent())?[2,!1]:(i=e.supportPartialCloseTrade,r=e.trade,s=Object(o.__rest)(e,["supportPartialCloseTrade","trade"]),i?(a=function(e){return Object(o.__awaiter)(c,void 0,void 0,(function(){return Object(o.__generator)(this,(function(i){return e!==r.qty?this._trackEvent("","Close Trade Dialog","partial"):this._trackEvent("","Close Trade Dialog","full"),[2,this._activeBroker.closeTrade(t,e)]}))}))},[2,X(Object(o.__assign)(Object(o.__assign)({},s),{positionOrTrade:r}),a,this._showErrorNotification)]):(a=function(){return c._activeBroker.closeTrade(t)},[2,x(this._showErrorNotification,a,e.message)]));case 3:return[2]}}))}))},t.prototype.editPositionBrackets=function(t,e,i,o){var r=this;return this._makeSureBrokerIsConnected(),Object(n.assert)(!!this._activeBroker.config.supportPositionBrackets,"Broker doesn`t support brackets on positions"),o?Object(n.ensureDefined)(this._activeBroker.editPositionBrackets)(t,e):this._activeBroker.positionById(t).then((function(t){return r._activeBroker?r._showPositionDialog(Object(n.ensureDefined)(t),e,i):Promise.reject("Broker connection adapter is null")}))},t.prototype.editTradeBrackets=function(t,e,i,o){var r=this;return void 0===e&&(e={}),o&&this._noConfirmEnabled.value()?this._activeBroker.editTradeBrackets(t):this._activeBroker.tradeById(t).then((function(t){if(!r._activeBroker)return Promise.reject("Broker connection adapter is null");var o=Object(n.ensureDefined)(t);return r._showTradeDialog(o,e,i)}))},t.prototype.reversePosition=function(t){var e=this;return this._makeSureBrokerIsConnected(),this._activeBroker.metainfo().configFlags.supportMultiposition&&!this._activeBroker.config.supportNativeReversePosition?Promise.reject("Cannot reverse position on multiposition acount"):this._noConfirmEnabled.value()?this._activeBroker.reversePosition(t):this._activeBroker.positionById(t).then((function(i){if(!e._activeBroker)return Promise.reject("Broker connection adapter is null");var o=e._activeBroker.reversePosition.bind(e._activeBroker,t);return Object(W.a)(t,e._showErrorNotification,o,e._activeBroker.config.closePositionCancelsOrders)}))},t.prototype.cancelOrder=function(t){
return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,n,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return this._makeSureBrokerIsConnected(),this._noConfirmEnabled.value()?[2,this._activeBroker.cancelOrder(t)]:[3,1];case 1:return[4,this._activeBroker.orderById(t)];case 2:return e=o.sent(),i=this._activeBroker.cancelOrder.bind(this._activeBroker,t),e?(r=e.refNumber||e.referenceNumber||e.id,e.parentId?2!==e.parentType?[3,4]:[4,this._activeBroker.orders()]:[3,5]):[3,6];case 3:return n=o.sent(),s=n.filter((function(t){return t.refNumber===e.refNumber})),this._activeBroker.metainfo().configFlags.cancellingOnePositionBracketsCancelsOther&&s.length>1?[2,this._showCancelMultipleBracketsDialog(r,i)]:[2,this._showCancelBracketsDialog(r,i)];case 4:if(!this._activeBroker.metainfo().configFlags.cancellingBracketCancelsParentOrder)return[2,this._showCancelBracketsDialog(r,i)];o.label=5;case 5:return[2,this._showCancelOrderDialog(r,i)];case 6:return[2,Promise.reject("Failed to find order")]}}))}))},t.prototype.cancelOrders=function(t,e){var i=this;return this._makeSureBrokerIsConnected(),this._activeBroker.orders().then((function(o){if(!i._activeBroker)return Promise.reject("Broker connection adapter is null");var r=o.filter((function(i){return i.symbol===t&&(!e||i.side===e)&&function(t){return 4===t.status||3===t.status||6===t.status}(i)}));if(!r.length)return Promise.resolve(!1);if(1===r.length)return i.cancelOrder(r[0].id);var n=r.map((function(t){return t.id}));if(i._noConfirmEnabled.value())return i._activeBroker.cancelOrders(t,e,n);var s=i._activeBroker.cancelOrders.bind(i._activeBroker);return i._showCancelMultipleOrdersDialog(t,e,n,s)}))},t.prototype._makeSureBrokerIsConnected=function(){Object(n.assert)(1===this._activeBroker.connectionStatus(),"Broker is not connected")},t.prototype._showPositionDialog=function(t,e,i){return void 0===e&&(e={}),Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n,s,a=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this._activeBroker.isTradable(t.symbol)];case 1:return(r=o.sent()).tradable?(s=this._activeBroker.metainfo()).customUI&&void 0!==s.customUI.showPositionDialog?[2,s.customUI.showPositionDialog(t,{stopLoss:e.stopLoss||t.stopLoss,takeProfit:e.takeProfit||t.takeProfit},i)]:[2,this._orderViewController().then((function(o){return a._activeBroker?o.showPositionView(a._activeBroker,t,{stopLoss:e.stopLoss,takeProfit:e.takeProfit,trailingStopPips:e.trailingStopPips},i||t.limitPrice&&3||t.stopPrice&&4):Promise.reject("Broker connection adapter is null")}))]:(n=void 0!==r.reason?r.reason:window.t("Symbol {symbol} cannot be traded through {broker}.").format({symbol:t.symbol,broker:this._activeBroker.metainfo().title}),this._showErrorNotification(window.t("Cannot protect position"),n),[2,Promise.resolve(!1)])}}))}))},t.prototype._showTradeDialog=function(t,e,i){var o=this;void 0===e&&(e={});var r=this._activeBroker.metainfo()
;return r.customUI&&void 0!==r.customUI.showPositionDialog?r.customUI.showPositionDialog(t,{stopLoss:e.stopLoss||t.stopLoss,takeProfit:e.takeProfit||t.takeProfit},i):this._orderViewController().then((function(r){return o._activeBroker?r.showTradeView(o._activeBroker,t,{stopLoss:e.stopLoss,takeProfit:e.takeProfit,trailingStopPips:e.trailingStopPips},i||t.limitPrice&&3||t.stopPrice&&4):Promise.reject("Broker connection adapter is null")}))},t.prototype._showCancelOrderDialog=function(t,e){return H.a.get().open(t).then((function(i){return i?e(t):Promise.resolve(!1)}))},t.prototype._showCancelMultipleOrdersDialog=function(t,e,i,o){var r=i.length;return H.a.get().multiple(t,e,r).then((function(r){return r?o(t,e,i):Promise.resolve(!1)}))},t.prototype._showCancelBracketsDialog=function(t,e){return K.a.get().open(t).then((function(i){return i?e(t):Promise.resolve(!1)}))},t.prototype._showCancelMultipleBracketsDialog=function(t,e){return K.a.get().multiple(t).then((function(i){return i?e(t):Promise.resolve(!1)}))},t.prototype._obtainPositionClosingData=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,s,a,c,u,l,d,h;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),this._isClosePositionDialogLoading=!0,i=n.ensureDefined,[4,this._activeBroker.positionById(t)];case 1:return e=i.apply(void 0,[o.sent()]),[4,this._obtainPositionOrTradeClosingCommonData(e)];case 2:return r=o.sent(),s=r.supportLots,a=r.qtyStep,c=r.minQty,u=r.qtyFormatter,l=r.priceFormatter,d=this._activeBroker.metainfo().configFlags.supportPartialClosePosition,h=window.t("Are you sure you want to close position {positionSymbol} {positionSide} {positionQty} @ {positionPrice}?").format({positionSymbol:e.symbol,positionSide:1===e.side?window.t("Buy"):window.t("Sell"),positionQty:u.format(e.qty),positionPrice:l.format(e.avgPrice)}),this._isClosePositionDialogLoading=!1,[2,{position:e,supportLots:s,qtyStep:a,minQty:c,supportPartialClosePosition:d,qtyFormatter:u,message:this._activeBroker.config.closePositionCancelsOrders?h+" "+window.t("This will also close all active orders."):h}];case 3:return o.sent(),this._isClosePositionDialogLoading=!1,[2];case 4:return[2]}}))}))},t.prototype._obtainTradeClosingData=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,s,a,c,u,l,d,h;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),this._isCloseTradeDialogLoading=!0,i=n.ensureDefined,[4,this._activeBroker.tradeById(t)];case 1:return e=i.apply(void 0,[o.sent()]),[4,this._obtainPositionOrTradeClosingCommonData(e)];case 2:return r=o.sent(),s=r.supportLots,a=r.qtyStep,c=r.minQty,u=r.qtyFormatter,l=r.priceFormatter,d=this._activeBroker.metainfo().configFlags.supportPartialCloseTrade,h=window.t("Are you sure you want to close position {positionSymbol} {positionSide} {positionQty} @ {positionPrice}? Position id {positionId}.").format({positionSymbol:e.symbol,positionSide:1===e.side?window.t("Buy"):window.t("Sell"),
positionQty:u.format(e.qty),positionPrice:l.format(e.price),positionId:e.id}),this._isCloseTradeDialogLoading=!1,[2,{trade:e,supportLots:s,qtyStep:a,minQty:c,supportPartialCloseTrade:d,qtyFormatter:u,message:this._activeBroker.config.closePositionCancelsOrders?h+" "+window.t("This will also close all active orders."):h}];case 3:return o.sent(),this._isCloseTradeDialogLoading=!1,[2];case 4:return[2]}}))}))},t.prototype._obtainPositionOrTradeClosingCommonData=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,r,n,s,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this._activeBroker.symbolInfo(t.symbol)];case 1:return e=o.sent(),i=void 0!==e.lotSize,r=e.qty.step,n=e.qty.min,[4,this._activeBroker.quantityFormatter(t.symbol)];case 2:return s=o.sent(),[4,this._activeBroker.formatter(t.symbol,!1)];case 3:return a=o.sent(),[2,{supportLots:i,qtyStep:r,minQty:n,qtyFormatter:s,priceFormatter:a}]}}))}))},t}(),ot=function(){function t(t,e){var i=this;this._domePanel=null,this._resizerBridge=t,this._close=function(){i.unmount(),e()}}return t.prototype.mount=function(){return this._getDomPanel().then((function(t){t.setVisibility(!0)}))},t.prototype.unmount=function(){this._getDomPanel().then((function(t){t.setVisibility(!1)}))},t.prototype._getDomPanel=function(){var t=this;return null!==this._domePanel?Promise.resolve(this._domePanel):Promise.all([i.e("react"),i.e(1),i.e(3),i.e(5),i.e(12),i.e(39),i.e(57),i.e(100),i.e(114),i.e(0),i.e(2),i.e(53),i.e(82),i.e("dome-panel")]).then(i.t.bind(null,"SScx",7)).then((function(e){var i=new e.DomePanel({resizerBridge:t._resizerBridge});return i.setCloseHandler(t._close),t._domePanel=i,i}))},t}(),rt=function(){function t(){}return t.prototype.mount=function(){return Promise.resolve()},t.prototype.unmount=function(){},t}(),nt=i("vOQ2"),st=i("/BH3"),at=i("6aj4"),ct=A.enabled("show_order_panel_on_start"),ut=function(){function t(t){var e=this;this.isOpened=new S.a(!1),this.isAvailable=new S.a(!0),this.activePage=new S.a(ct?nt.d.OrderPanel:nt.d.DomPanel),this.isLoading=new S.a(!1),this._pages={},this._width=nt.c,this._onLayoutResizeHandleMousedown=function(t){if(!t.defaultPrevented&&t.cancelable){t.preventDefault();var i,o=Math.max(e._resizerBridge.width.value(),0);i="touches"in t?t.touches[0].clientX:t.clientX;var r=function(t){var r;t.preventDefault(),r="touches"in t?t.touches[0].clientX:t.clientX;var n=o-(r-i);n<nt.c?n=nt.c:n>nt.a&&(n=nt.a),e._requestWidth(n)},n=function(){document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",n),document.removeEventListener("touchend",n),k.setValue(u.settingsKeys.PANEL_WIDTH,e._width)};document.addEventListener("mousemove",r),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",n),document.addEventListener("touchend",n,{passive:!1})}},this._resizerBridge=t,this._rootContainer=this._resizerBridge.container.value(),this.container=document.createElement("div"),
this.container.classList.add(at["trading-panel-content"],"trading-panel-content"),this._rootContainer.appendChild(this.container),this._addSpinner(),this._addResizeHandler(),this._updateAvailable({width:this._resizerBridge.availWidth.value(),height:this._resizerBridge.availHeight.value()}),Object(O.combine)((function(t,e){return{width:t,height:e}}),this._resizerBridge.availWidth,this._resizerBridge.availHeight).subscribe(this._updateAvailable.bind(this)),this.isLoading.subscribe(this._setLoading.bind(this)),this._rootContainer.style.overflow=this.isOpened.value()?"":"hidden"}return t.prototype.addPage=function(t,e){this._pages[t]=e},t.prototype.isPageOpened=function(t){return this.isOpened.value()&&this.activePage.value()===t},t.prototype.setPage=function(t){this.isOpened.value()&&this.activePage.value()!==t&&this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this.activePage.setValue(t),k.setValue(u.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,t)},t.prototype.openPage=function(t){this.setPage(t),this.open()},t.prototype.open=function(){this._pages[this.activePage.value()]&&(this._togglePanel(!0),this.isOpened.setValue(!0),this._pages[this.activePage.value()].mount())},t.prototype.close=function(){this.isOpened.setValue(!1),this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this._togglePanel(!1)},t.prototype._setLoading=function(t){t?this._rootContainer.appendChild(this._spinnerContainer):this._rootContainer.contains(this._spinnerContainer)&&this._rootContainer.removeChild(this._spinnerContainer)},t.prototype._addSpinner=function(){var t=this;this._spinnerContainer=document.createElement("div"),this._spinnerContainer.classList.add(at["trading-panel-spinner"]),Promise.all([i.e("react"),i.e("spinner-renderer")]).then(i.bind(null,"lG9f")).then((function(e){e.render(t._spinnerContainer)}))},t.prototype._addResizeHandler=function(){this._handle=document.createElement("div"),this._handle.classList.add(at["trading-panel-handle"]),this._rootContainer.appendChild(this._handle),this._handle.addEventListener("mousedown",this._onLayoutResizeHandleMousedown,{passive:!1}),this._handle.addEventListener("touchstart",this._onLayoutResizeHandleMousedown,{passive:!1}),this._width=k.getInt(u.settingsKeys.PANEL_WIDTH)||nt.c},t.prototype._togglePanel=function(t){this._resizerBridge.negotiateWidth(t?this._width:0),this._resizerBridge.negotiateHeight(t?nt.b:0),this._rootContainer.style.overflow=t?"":"hidden",k.setValue(u.settingsKeys.TRADING_PANEL_OPENED,t)},t.prototype._updateAvailable=function(t){this.isAvailable.setValue(t.width>=nt.c&&t.height>=nt.b)},t.prototype._requestWidth=function(t){this._canOpen(t)&&this._resizerBridge.width.value()!==t&&(this._resizerBridge.negotiateWidth([{min:nt.c,max:t}]),this._width=t)},t.prototype._canOpen=function(t){return t+st.tabsWidth<=this._resizerBridge.availWidth.value()},t}(),lt=i("lxNp");function dt(t){var e;if("object"!=typeof t||null==t||"number"==typeof t.nodeType)e=t;else if(Array.isArray(t)){e=[]
;for(var i=0,o=t.length;i<o;i++)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=dt(t[i]))}else for(var r in e={},t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=dt(t[r]));return e}var ht=i("9XXR"),pt=i("mNbo"),_t=i("+J+G"),ft=Object(p.getLogger)("Lib.Sound",{color:"#dea433"}),bt="notification/notification",yt=[{title:window.t("Alarm Clock"),path:"alert/alarm_clock",soundForAlerts:!0,filePath:_t}];var mt={};function gt(){vt(yt.filter((function(t){return!!t.soundForAlerts})).map((function(t){return t.path})))}function vt(t){if(!Object(pt.a)("any")&&(t&&/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(window.navigator.userAgent)))if(Array.isArray(t)||(t=[t]),0!==(t=t.filter((function(t){var e=kt(t);return!(!e||!e.el.load||e._mobilePreloadActive)&&(e._mobilePreloadActive=!0,!0)}))).length){var e=function(){var o=[];Array.isArray(t)&&t.forEach((function(t){var e=kt(t);e.el.load();var i=e.play().catch((function(t){if("AbortError"!==t.name)throw ft.logError('enableForMobile for "'+e.el.src+'" preload error: - '+t.message),t}));e.el.pause(),o.push(i)})),Promise.all(o).then((function(){ft.logNormal("enableForMobile sounds initialized")})),i.forEach((function(t){document.removeEventListener(t,e,!0)}))},i=["click","touchend","keydown"];i.forEach((function(t){document.addEventListener(t,e,!0)}))}else ft.logNormal("enableForMobile no sounds passed")}var kt=function(t){if(t in mt)return mt[t];ft.logNormal("requested sound  "+t+" not cached, building a new audio element");var e=yt.find((function(e){return e.path===t}));if(void 0===e)throw new Error('Cannot find sound "'+t+'"');var i=new Audio(e.filePath),o={el:i,playing:new S.a(!1),play:function(e){return void 0===e&&(e=0),o.playing.value()?(ft.logNormal("sound already playing"),Promise.reject("already playing")):(o.playing.setValue(!0),new Promise((function(i,r){var n=e>0,s=function(){(function(t){try{ft.logNormal('"'+t.el.src+'" triggering html5 play method, readyState - '+t.el.readyState+"; muted - "+t.el.muted+"; volume - "+t.el.volume+"; currentTime - "+t.el.currentTime);var e=t.el.play();return e||(e=Promise.resolve()),e}catch(i){return ft.logError('play method for "'+t.el.src+'" catch error - '+i.message),Promise.reject(i)}})(o).catch((function(e){ft.logNormal('stop counting sound "'+t+'"; as playing due to an error: '+e.message),o.stop(),r(e)}))};o._onEnded=function(){n?s():(o.stop(),i())},o.el.addEventListener("ended",o._onEnded),n&&setTimeout((function(){ft.logNormal('"'+t+'" repeat timeout - '+e+"s off"),n=!1}),1e3*e),s()})))},stop:function(){o.el.pause(),o.playing.setValue(!1),o._onEnded&&o.el.removeEventListener("ended",o._onEnded)}};mt[t]=o;return["canplaythrough","error"].forEach((function(e){i.addEventListener(e,(function(){ft.logNormal('for sound "'+t+'", event - '+e+" is fired")}),!1)})),ft.logNormal("canPlayType - "+i.canPlayType("audio/mp3")),mt[t]};vt(yt.filter((function(t){return!!t.common})).map((function(t){return t.path})));var wt=i("JOqt"),Pt=i("IWXC"),Ot=["qty","stopPrice","limitPrice","filledQty","status"];function Bt(t,e){
return t.enabled.value()&&(e.soundName=t.name),e}function St(t){return 6===t||3===t}var Ct=function(t){function e(e){var i=t.call(this,e)||this;return i._orders=[],i._playSound=Object(wt.debounce)(i._playSoundImpl,50),gt(),i}return Object(o.__extends)(e,t),e.prototype.startService=function(){var t=this,e=Object(n.ensure)(this.activeBroker());e.orders().then((function(e){return t._orders=dt(e)})),e.orderUpdate.subscribe(this,this._orderUpdate)},e.prototype.stopService=function(){Object(n.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)},e.prototype._showNotification=function(t,e,i){A.enabled("trading_notifications")&&("error"===i?this.trading().showErrorNotification(t,e):this.trading().showSuccessNotification(t,e))},e.prototype._formatter=function(t){return Object(Pt.getQuoteSessionInstance)("simple").formatter(t)},e.prototype._checkOrderModified=function(t,e){var i=this.activeBroker(),o=i&&i.metainfo().customNotificationFields||[],r=Ot.concat(o),n=!1;return r.forEach((function(i){n||function t(e,i,o){if(void 0===e||void 0===i)return!1;var r=o.indexOf(".");if(-1!==r){var n=o.substring(0,r);return t(e[n],i[n],o.substring(r+1))}return e[o]===i[o]}(t,e,i)||(n=!0)})),n},e.prototype._generateNotificationsInfo=function(t,e){var i=[],o=t.statusMessage?": "+t.statusMessage:"",r=(1===t.side?window.t("Bought"):window.t("Sold")).toUpperCase(),n=this.trading().orderExecutedSoundParams;return e?(this._checkOrderModified(t,e)&&(1===t.status?i.push({text:window.t("cancelled")}):6===t.status&&e.filledQty!==t.filledQty?i.push(Bt(n,{side:r,text:window.t("executed partially")})):St(t.status)?i.push({text:window.t("modified")}):2===t.status&&i.push(Bt(n,{side:r,text:window.t("executed")}))),Object.assign(e,t)):St(t.status)?(this._orders.push(t),i.push({text:window.t("placed")}),this.trading().trackEvent("","Order placed symbol",t.symbol)):1===t.status?i.push({text:window.t("cancelled")}):5===t.status?(this._orders.push(t),i.push({text:window.t("rejected")+o,type:"error"})):2===t.status&&(this._orders.push(t),i.push({text:window.t("placed")},Bt(n,{side:r,text:window.t("executed"),emptyOrderType:!0})),this.trading().trackEvent("","Order placed symbol",t.symbol)),i},e.prototype._orderUpdate=function(t,e){var i=this,o=dt(t),r=this._orders.find((function(t){return t.id===o.id}));if(e)void 0===r&&this._orders.push(o);else if(!r||!w.isFinalOrderStatus(r.status)){var n=this._generateNotificationsInfo(o,r);0!==n.length&&this._formatter(o.symbol).then((function(t){var e=w.sideToText(o.side,!0),r="",s="",a=o.qty;switch(o.type){case 2:r=o.avgPrice?" ("+w.orderTypeToText(o.type)+")":"",s=o.avgPrice?t.format(o.avgPrice):w.orderTypeToText(o.type);break;case 4:r=" "+window.t("(Limit) after {0} (Stop) crossed").format(t.format(o.stopPrice)),s=t.format(o.avgPrice||o.limitPrice);break;default:r=" ("+w.orderTypeToText(o.type)+")",s=t.format(o.avgPrice||o.limitPrice||o.stopPrice)}o.hasOwnProperty("filledQty")&&void 0!==o.filledQty&&o.filledQty>0&&(a=o.filledQty)
;var c=Object(ht.splitThousands)(Math.abs(a)," ")+" "+(o.brokerSymbol||o.symbol)+" "+window.t("at")+" "+s,u=void 0!==o.message?""+o.message.text.charAt(0).toUpperCase()+o.message.text.substr(1):"";n.forEach((function(t){var n=t.side,s=t.text,a=t.type,l=t.emptyOrderType,d=t.soundName,h=window.t("Order")+" "+o.id+" "+s,p=(n||e)+" "+c+" "+(l?"":r)+"\n"+u;void 0!==d&&i._playSound(d),i._showNotification(h,p,a)}))}))}},e.prototype._playSoundImpl=function(t){var e,i,o=this;if(this._playingSound){if(this._playingSound===t)return;!function(t){if(!Object(pt.a)("any")){var e=[];t?e.push(kt(t)):e=Object.values(mt),e.forEach((function(t){t.stop()}))}}(this._playingSound)}this._playingSound=t,void 0===(e=t)&&(e=bt),Object(pt.a)("any")?Promise.resolve():(ft.logNormal('Sound play attempt for "'+e+'" duration-'+i+"s;"),kt(e).play(i)),function(t,e){Object(pt.a)("any")||kt(t).playing.subscribe((function(t){t||e()}),{once:!0})}(t,(function(){delete o._playingSound}))},e}(g.a),Tt=i("pJ/4"),Et=i.n(Tt),jt=i("pPtI"),It=0;var Dt=function(){function t(t,e,i,o,r){this._currentPointsetId=null,this._onUpdate=new h.a,this._requestPoints=[],this._gateway=t,this._pointsetSuffix=e,this._isGatewayConnected=this._gateway.isConnected().spawn(),this._isGatewayConnected.subscribe(this._updateByGatewayConnection.bind(this)),this._addPoints(i,o,r)}return t.prototype.onUpdate=function(){return this._onUpdate},t.prototype.destroy=function(){this._isGatewayConnected.value()&&null!==this._currentPointsetId&&this._gateway.removePointset(this._currentPointsetId),this._requestPoints=[],this._currentPointsetId=null,this._isGatewayConnected.destroy()},t.prototype._updateByGatewayConnection=function(t){t||(this._currentPointsetId=null,this._requestPoints=[])},t.prototype._addPoints=function(t,e,i){var o,r;this._isGatewayConnected.value()&&(Object(n.assert)(t.length>0,"Can't possible create point set for empty array of time points"),this._requestPoints=t.map((function(t){return[t.time_t,t.offset]})),this._currentPointsetId=(o=this._pointsetSuffix,r=++It,"pointset_"+o+"_"+r),this._gateway.createPointset(this._currentPointsetId,"turnaround",e,Object(jt.getServerInterval)(i),this._requestPoints,this._dataUpdate.bind(this)))},t.prototype._dataUpdate=function(t){for(var e=[],i=0,o=t.params.plots;i<o.length;i++){var r=o[i];e.push({time_t:this._requestPoints[r.index][0],index:r.value[0],barTime:r.value[1]})}this._onUpdate.fire(e)},t}(),At=i("GOhO");function Nt(t){var e=t.mainSeries().data().first();return null===e?null:e.value[0]}function Lt(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n,s,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.all([i.e("trading-custom-sources").then(i.bind(null,"fA+p")),i.e("trading-custom-sources").then(i.bind(null,"KSBC")),i.e("trading-custom-sources").then(i.bind(null,"EgV8"))])];case 1:return r=o.sent(),n=r[0],s=r[1],a=r[2],t.addCustomSource("executions",(function(t){var i=Object(At.b)(t.isInReplay.bind(t),t.onInReplayStateChanged()),o=Object(At.a)((function(t,e){return e
}),i,t.properties().tradingProperties.showExecutions),r=t.mainSeries(),c=r.dataEvents(),u=function(t,e,i){return function(o){var r=i.symbolId(),n=i.interval();return null===r?null:new Dt(t,e,o,r,n)}}(t.chartApi(),"executions",r),l=Object(At.c)(Nt.bind(null,t),c.barReceived()),d=new n.ExecutionsService(e,c,function(t){return function(){var e=t.symbolInfo();return null!==e?e.pro_name||e.full_name:t.proSymbol()}}(r)),h=new s.ExecutionsPointsManager(d,u,l);return new a.ExecutionsSource(t,e,o,h)})),[2]}}))}))}var Mt=i("ogJP"),Rt=Object(p.getLogger)("Trading.Positions");function Vt(t){var e=null===t?0:Math.round(100*t)/100;return e>0?"positive":e<0?"negative":"neutral"}var Ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._positions=new Map,e._positionUpdate=new h.a,e._positionsRemoved=new h.a,e._displayMode=1,e._updatePositionPLHandler=e._updatePositionPL.bind(e),e}return Object(o.__extends)(e,t),e.prototype.destroy=function(){this.stopService()},e.prototype.positions=function(){return Array.from(this._positions.values())},e.prototype.positionUpdate=function(){return this._positionUpdate},e.prototype.positionsRemoved=function(){return this._positionsRemoved},e.prototype.isDisplayModeTrades=function(){return 0===this._displayMode},e.prototype.stopService=function(){this._clearPositions();var t=Object(n.ensureNotNull)(this.activeBroker());this.isDisplayModeTrades()?t.tradeUpdate.unsubscribeAll(this):t.positionUpdate.unsubscribeAll(this)},e.prototype.startService=function(){this._clearPositions(),this._displayMode=function(t){if(null===t)return 1;var e=t.metainfo().configFlags;return e.supportTrades?e.supportPositionBrackets?1:e.supportCloseTrade?0:1:1}(this.activeBroker()),this._requestPositions()},e.prototype._clearPositions=function(){for(var t=Object(n.ensureNotNull)(this.activeBroker()),e=Array.from(this._positions.keys()),i=0,o=e;i<o.length;i++){var r=o[i];this.isDisplayModeTrades()?t.unsubscribeTradePL(r,this._updatePositionPLHandler):t.unsubscribePL(r,this._updatePositionPLHandler)}this._positions.clear(),this._positionsRemoved.fire(e)},e.prototype._requestPositions=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e,i,r,n,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return(t=this.activeBroker())?[4,(e=this.isDisplayModeTrades())?t.trades():t.positions()]:[2];case 1:for(i=o.sent(),r=0,n=i;r<n.length;r++)s=n[r],this._addPosition(s);return e?t.tradeUpdate.subscribe(this,this._addPosition):t.positionUpdate.subscribe(this,this._addPosition),[2]}}))}))},e.prototype._addPosition=function(t){var e=t.id,i=this._positions.has(e),o=Object(n.ensureNotNull)(this.activeBroker());Rt.logDebug("Update position. Symbol:"+t.symbol+" , qty:"+t.qty);var r=this.isDisplayModeTrades();if(t.qty){var s=this._getPositionData(t);this._positions.set(e,s),this._positionUpdate.fire(s),i||(r?o.subscribeTradePL(e,this._updatePositionPLHandler):o.subscribePL(e,this._updatePositionPLHandler))
}else i&&(r?o.unsubscribeTradePL(e,this._updatePositionPLHandler):o.unsubscribePL(e,this._updatePositionPLHandler),this._positions.delete(e),this._positionsRemoved.fire([e]))},e.prototype._updatePositionPL=function(t,e){var i=Object(n.ensureDefined)(this._positions.get(t));i.pl=Object(Mt.isNumber)(e)?e:null,i.profitState=Vt(e),this._positionUpdate.fire(i)},e.prototype._getPositionData=function(t){var e=Object(n.ensureNotNull)(this.activeBroker()).metainfo().configFlags,i=this._positions.get(t.id),r=this.isDisplayModeTrades(),s="neutral",a=t.pl||i&&i.pl||null;return null!==a&&(s=Vt(a)),Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},void 0!==i?i:{}),t),{pl:a,price:Math.abs(r?t.price:t.avgPrice),qtyBySide:Math.abs(t.qty)*(1===t.side?1:-1),profitState:s,supportClose:Boolean(r?e.supportCloseTrade&&t.canBeClosed:e.supportClosePosition),supportReverse:Boolean(!r&&e.supportReversePosition),supportBrackets:Boolean(r?e.supportTradeBrackets:e.supportPositionBrackets)})},e}(g.a),qt=i("QfUd"),Ft=i("kcTO"),xt=window.t("A broker is not connected"),Qt=window.t("This symbol can not be traded though this broker"),Wt=window.t("No bids"),Ht=window.t("No asks"),Kt=window.t("Buy Market"),Gt=window.t("Sell Market"),zt=window.t("Spread"),Yt=window.t("Amount"),Jt=window.t("Quantity"),Xt=function(){function t(t,e,i,o){var r=this;this.ask=new S.a(null),this.askTooltip=new S.a(Kt),this.bid=new S.a(null),this.bidTooltip=new S.a(Gt),this.spread=new S.a(null),this.spreadTooltip=new S.a(zt),this.qty=new S.a(null),this.qtyTooltip=new S.a(""),this.isQtyVisible=new S.a(!1),this.hasAskBidAdditionalPrecision=new S.a(!1),this.canTrade=new S.a(!0),this._isSymbolTradableResult=new qt.a(null),this._formatter=null,this._spreadFormatter=null,this._symbol=null,this._dataEvents=t,this._getSymbolName=e,this._realtimeProvider=i.realtimeProvider,this._suggestedQty=i.suggestedQty,this._onNeedSelectBroker=i.onNeedSelectBroker,this._toggleTradingWidget=i.toggleTradingWidget,this._brokerCommandsUI=i.brokerCommandsUI,this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this),this._isBrokerConnected=Object(At.c)((function(){return null!==r._realtimeProvider.activeBroker()}),this._realtimeProvider.onStatusChanged),this._isBrokerConnected.subscribe(this._updateIsSymbolTraded.bind(this)),this._isBrokerConnected.subscribe(this._updateQtyTooltip.bind(this),{callWithLast:!0}),this.visible=o.showSellBuyButtons.spawn(),this.visible.subscribe(this._toggleState.bind(this),{callWithLast:!0}),this._isInstantMode=o.noConfirmEnabled.spawn(),this._tradePossibilityComputedWV=Object(O.combine)((function(){return{}}),this._isBrokerConnected,this._isSymbolTradableResult,this.ask,this.bid),this._tradePossibilityComputedWV.subscribe(this._updateTradePossibilityAndTooltip.bind(this),{callWithLast:!0}),this._isQtyVisibleComputedWV=Object(O.combine)((function(){return{}}),this.canTrade,this._isInstantMode),this._isQtyVisibleComputedWV.subscribe(this._updateIsQtyVisible.bind(this),{callWithLast:!0})}return t.prototype.destroy=function(){this._stop(),this.visible.destroy(),
this._isInstantMode.destroy(),this._tradePossibilityComputedWV.destroy(),this._isQtyVisibleComputedWV.destroy()},t.prototype.tryToPlaceSellOrder=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._tryToPlaceOrder(parseFloat(Object(n.ensureNotNull)(this.bid.value())),-1)];case 1:return t.sent(),[2]}}))}))},t.prototype.tryToPlaceBuyOrder=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._tryToPlaceOrder(parseFloat(Object(n.ensureNotNull)(this.ask.value())),1)];case 1:return t.sent(),[2]}}))}))},t.prototype.getQtyInfo=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return null!==this._symbol&&this.canTrade.value()?[4,this._realtimeProvider.symbolInfo(this._symbol)]:[2,null];case 1:return[2,t.sent().qty]}}))}))},t.prototype.setQty=function(t){this.qty.setValue(String(t))},t.prototype.applyQty=function(){if(null!==this._symbol&&this.canTrade.value()){var t=this.qty.value();null!==t&&this._suggestedQty.setValue(this._symbol,Number(t))}},t.prototype._tryToPlaceOrder=function(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var i,r,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return null!==this._realtimeProvider.activeBroker()?[3,2]:[4,this._toggleTradingWidget()];case 1:return o.sent(),this._onNeedSelectBroker.fire(),[2];case 2:return i=Number(this.qty.value())||1,r=this._isMarketOrderSupported()?2:1,s={symbol:Object(n.ensureNotNull)(this._symbol),qty:i,side:e,type:r,seenPrice:null},1===r&&(s.limitPrice=t),[4,Object(n.ensureNotNull)(this._brokerCommandsUI()).placeOrder(s,!0)];case 3:return o.sent(),[2]}}))}))},t.prototype._toggleState=function(t){t?this._start():this._stop()},t.prototype._start=function(){this._dataEvents.symbolResolved().subscribe(this,this._createTradedSymbol),this._dataEvents.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol(),this._suggestedQty.changed.subscribe(this,this._updateQty)},t.prototype._stop=function(){this._clearTradedSymbol(),this._symbol=null,this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this),this._suggestedQty.changed.unsubscribeAll(this)},t.prototype._createTradedSymbol=function(){var t=this._getSymbolName();t!==this._symbol&&(this._clearTradedSymbol(),t.length>0&&this._initTradedSymbol(t))},t.prototype._initTradedSymbol=function(t){this._symbol=t,this._updateIsSymbolTraded(),this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler)},t.prototype._clearTradedSymbol=function(){this.ask.setValue(null),this.bid.setValue(null),this.spread.setValue(null),this.qty.setValue(null),null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(this._symbol,this._updateRealtimeDataHandler),this._symbol=null,this._updateIsSymbolTraded())},
t.prototype._isMarketOrderSupported=function(){var t=this._realtimeProvider.activeBroker();return null===t||Boolean(t.metainfo().configFlags.supportMarketOrders)},t.prototype._updateTradePossibilityAndTooltip=function(){this._updateCanTrade(),this._updateSellBuyTooltip()},t.prototype._updateCanTrade=function(){var t=!1,e=!1,i=this._isSymbolTradableResult.value();this._isBrokerConnected.value()&&null!==i&&i.tradable&&(e=!0,this.canTrade.value()||(t=!0)),this.canTrade.setValue(e),t&&null!==this._symbol&&this._updateQty(this._symbol)},t.prototype._updateSellBuyTooltip=function(){var t=this._isSymbolTradableResult.value(),e=null,i=null,o=null,r=null===this.ask.value(),n=null===this.bid.value();null===t||t.tradable?(r||n)&&(r&&(i=Ht),n&&(o=Wt)):e=t.shortReason?t.shortReason:this._isBrokerConnected.value()?Qt:xt,this.askTooltip.setValue(i||e||Kt),this.bidTooltip.setValue(o||e||Gt)},t.prototype._updateRealtimeData=function(t,e,i){this._formatter=i.formatter,this._spreadFormatter=i.spreadFormatter;var o=e.ask,r=e.bid,n=Object(s.isNumber)(o)?this._formatter.format(o):null,a=Object(s.isNumber)(r)?this._formatter.format(r):null;this.ask.setValue(n),this.bid.setValue(a);var c=e.spread||Object(s.isNumber)(o)&&Object(s.isNumber)(r)&&o-r||0,u=Object(s.isNumber)(e.spread)?this._spreadFormatter:this._formatter;this.spread.setValue(u.format(c));var l=!1;Object(Ft.isFormatterHasForexAdditionalPrecision)(this._formatter)&&(l=this._formatter.hasForexAdditionalPrecision()),this.hasAskBidAdditionalPrecision.setValue(l)},t.prototype._updateIsSymbolTraded=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return null===this._symbol?(this._isSymbolTradableResult.setValue(null),[2]):[4,this._realtimeProvider.isTradable(this._symbol)];case 1:return t=e.sent(),this._isSymbolTradableResult.setValue(Object(Mt.clone)(t)),[2]}}))}))},t.prototype._updateQty=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return t===this._symbol&&this.canTrade.value()?[4,this._suggestedQty.value(t)]:[2];case 1:return e=i.sent(),(!isFinite(e)||e<=0)&&(e=1),this.qty.setValue(""+Object(s.fixComputationError)(e)),[2]}}))}))},t.prototype._updateIsQtyVisible=function(){var t=this._isInstantMode.value()&&this.canTrade.value();this.isQtyVisible.setValue(t)},t.prototype._updateQtyTooltip=function(){this.qtyTooltip.setValue(this._getQtyTooltip())},t.prototype._getQtyTooltip=function(){var t=this._realtimeProvider.activeBroker();return null!==t&&t.metainfo().configFlags.showQuantityInsteadOfAmount?Jt:Yt},t}(),Zt=i("EOiv"),$t=i("AvGy"),te=i("qBrV"),ee=i("N8pX"),ie=i("0jws");function oe(t,e,i,o){var r=t.querySelector("."+o);if(!i)return null!==r&&r.remove(),void Object(te.a)(t,e);null===r&&((r=document.createElement("span")).classList.add(o),t.appendChild(r)),Object(te.a)(Object(n.ensureNotNull)(r),e.slice(-1)),Object(te.a)(t,e.slice(0,-1))}var re=function(){function t(t,e,i){var o=this
;this.element=document.createElement("div"),this._sellButtonEl=document.createElement("div"),this._sellButtonTextEl=document.createElement("span"),this._buyButtonEl=document.createElement("div"),this._buyButtonTextEl=document.createElement("span"),this._spreadQtyWrapper=document.createElement("div"),this._spreadEl=document.createElement("div"),this._qtyEl=document.createElement("div"),this._qtyTextEl=document.createElement("span"),this._isCalcOpened=!1,this._calcContainer=document.createElement("div"),this._sellLoader=new Zt.a(this._sellButtonEl,{className:ee.loader}),this._buyLoader=new Zt.a(this._buyButtonEl,{className:ee.loader}),this._isModeHidden=!1,this._getCurrentQty=function(){var t=o._qty.value();return null!==t?Number(t):null},this._model=t,this._ask=this._model.ask.spawn(),this._ask.subscribe(this._updateBuyButton.bind(this)),this._bid=this._model.bid.spawn(),this._bid.subscribe(this._updateSellButton.bind(this)),this._spread=this._model.spread.spawn(),this._spread.subscribe(this._updateSpread.bind(this)),this._qty=this._model.qty.spawn(),this._qty.subscribe(this._updateQtyEl.bind(this)),this._trackEvent=i,this._render(),this._askTooltip=this._model.askTooltip.spawn(),this._askTooltip.subscribe(this._updateButtonTooltip.bind(this,this._buyButtonEl),{callWithLast:!0}),this._bidTooltip=this._model.bidTooltip.spawn(),this._bidTooltip.subscribe(this._updateButtonTooltip.bind(this,this._sellButtonEl),{callWithLast:!0}),this._spreadTooltip=this._model.spreadTooltip.spawn(),this._spreadTooltip.subscribe(this._updateButtonTooltip.bind(this,this._spreadEl),{callWithLast:!0}),this._qtyTooltip=this._model.qtyTooltip.spawn(),this._qtyTooltip.subscribe(this._updateButtonTooltip.bind(this,this._qtyEl),{callWithLast:!0}),this._isVisible=this._model.visible.spawn(),this._isVisible.subscribe(this._updateVisibility.bind(this),{callWithLast:!0}),this._isQtyVisible=this._model.isQtyVisible.spawn(),this._isQtyVisible.subscribe(this._updateQtyVisibility.bind(this),{callWithLast:!0}),this._isLastDigitSup=this._model.hasAskBidAdditionalPrecision.spawn(),this._isLastDigitSup.subscribe(this._updateLastDigitSup.bind(this)),this._highButtonsMode=e.spawn(),this._highButtonsMode.subscribe(this._updateHighButtonsMode.bind(this),{callWithLast:!0}),this._withBgButtonsMode=this._model.canTrade.spawn(),this._withBgButtonsMode.subscribe(this._updateBgButtonsMode.bind(this),{callWithLast:!0}),this._sellButtonHandler=this._onSellButton.bind(this),this._buyButtonHandler=this._onBuyButton.bind(this),this._qtyHandler=this._toggleCalcVisibility.bind(this),this._sellButtonEl.addEventListener("click",this._sellButtonHandler),this._buyButtonEl.addEventListener("click",this._buyButtonHandler),this._qtyEl.addEventListener("click",this._qtyHandler)}return t.prototype.destroy=function(){this._ask.destroy(),this._askTooltip.destroy(),this._bid.destroy(),this._bidTooltip.destroy(),this._spread.destroy(),this._spreadTooltip.destroy(),this._qty.destroy(),this._qtyTooltip.destroy(),this._isVisible.destroy(),this._isQtyVisible.destroy(),
this._isLastDigitSup.destroy(),this._highButtonsMode.destroy(),this._withBgButtonsMode.destroy(),this._sellButtonEl.removeEventListener("click",this._sellButtonHandler),this._buyButtonEl.removeEventListener("click",this._buyButtonHandler),this._qtyEl.removeEventListener("click",this._qtyHandler),this.element.remove(),delete this.element},t.prototype.updateModeByWidth=function(t){var e=t<290;this.element.classList.toggle(ee.column,e),this._isModeHidden=t<90,this._updateVisibility()},t.prototype._render=function(){var t=this._bid.value()||"...";this._sellButtonTextEl.appendChild(document.createTextNode(t)),this._sellButtonTextEl.classList.add(ee.buttonText),this._sellButtonEl.append(this._sellButtonTextEl),this._sellButtonEl.classList.add("apply-common-tooltip",ee.button,ee.sellButton);var e=this._spread.value()||"";this._spreadEl.appendChild(document.createTextNode(String(e))),this._spreadEl.classList.add("apply-common-tooltip",ee.spread);var i=this._qty.value()||"";this._qtyTextEl.appendChild(document.createTextNode(i)),this._qtyEl.append(this._qtyTextEl),this._qtyEl.classList.add("apply-common-tooltip",ee.button,ee.qty),this._spreadQtyWrapper.classList.add(ee.spreadQtyWrapper),this._spreadQtyWrapper.appendChild(this._spreadEl),this._spreadQtyWrapper.appendChild(this._qtyEl);var o=this._ask.value()||"...";this._buyButtonTextEl.appendChild(document.createTextNode(String(o))),this._buyButtonTextEl.classList.add(ee.buttonText),this._buyButtonEl.append(this._buyButtonTextEl),this._buyButtonEl.classList.add("apply-common-tooltip",ee.button,ee.buyButton),this.element.appendChild(this._sellButtonEl),this.element.appendChild(this._spreadQtyWrapper),this.element.appendChild(this._buyButtonEl),this.element.classList.add(ee.wrapper),this.element.classList.toggle(ee.touchMode,$t.a)},t.prototype._onSellButton=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e=this;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return null===this._bid.value()?[2]:(t=this._highButtonsMode.value(),this._trackEvent("Sell/Buy Buttons","Sell",t?"Instant":"Not Instant"),t&&this._withBgButtonsMode.value()&&this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!0),[4,this._model.tryToPlaceSellOrder()]);case 1:return i.sent(),t&&this._withBgButtonsMode.value()&&setTimeout((function(){return e._toggleLoaderVisibility(e._sellButtonEl,e._sellLoader,!1)}),300),[2]}}))}))},t.prototype._onBuyButton=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e=this;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return null===this._ask.value()?[2]:(t=this._highButtonsMode.value(),this._trackEvent("Sell/Buy Buttons","Buy",t?"Instant":"Not Instant"),t&&this._withBgButtonsMode.value()&&this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!0),[4,this._model.tryToPlaceBuyOrder()]);case 1:return i.sent(),t&&this._withBgButtonsMode.value()&&setTimeout((function(){return e._toggleLoaderVisibility(e._buyButtonEl,e._buyLoader,!1)}),300),[2]}}))}))},
t.prototype._toggleLoaderVisibility=function(t,e,i){t.classList.toggle(ee.loading,i),e.toggleVisibility(i)},t.prototype._updateBuyButton=function(t){var e=null!==t&&this._isLastDigitSup.value();oe(this._buyButtonTextEl,""+(t||"..."),e,ee.lastCharSup)},t.prototype._updateSellButton=function(t){var e=null!==t&&this._isLastDigitSup.value();oe(this._sellButtonTextEl,""+(t||"..."),e,ee.lastCharSup)},t.prototype._updateSpread=function(t){var e=""+(t||"");Object(te.a)(this._spreadEl,e),this._updateVisibilityForSpreadQtyWrapper()},t.prototype._updateQtyEl=function(t){this._updateQty(t)},t.prototype._updateQty=function(t){var e=""+(t||"");!this._isCalcOpened&&e.length>0&&(e=Object(P.abbreviatedNumber)(Number(e))),Object(te.a)(this._qtyTextEl,e)},t.prototype._updateHighButtonsMode=function(t){this.element.classList.toggle(ee.highButtons,t)},t.prototype._updateBgButtonsMode=function(t){this.element.classList.toggle(ee.withoutBg,!t)},t.prototype._updateVisibilityForSpreadQtyWrapper=function(){var t=!this._isQtyVisible.value()&&null===this._spread.value();this._spreadQtyWrapper.classList.toggle(ie.blockHidden,t)},t.prototype._updateQtyVisibility=function(t){this._qtyEl.classList.toggle(ie.blockHidden,!t),this._spreadQtyWrapper.classList.toggle(ee.withoutQty,!t),this._updateVisibilityForSpreadQtyWrapper()},t.prototype._updateVisibility=function(){var t=this._isVisible.value()&&!this._isModeHidden;this.element.classList.toggle(ie.blockHidden,!t)},t.prototype._updateLastDigitSup=function(){this._updateBuyButton(this._ask.value()),this._updateSellButton(this._bid.value())},t.prototype._updateButtonTooltip=function(t,e){t.setAttribute("title",e)},t.prototype._toggleCalcVisibility=function(){this._isCalcOpened=!this._isCalcOpened,this._renderCalc()},t.prototype._closeCalc=function(){this._isCalcOpened=!1,this._updateQty(this._qty.value()),this._model.applyQty(),this._renderCalc()},t.prototype._renderCalc=function(){var t=this;Promise.all([i.e("react"),i.e(3),i.e(90),i.e(101),i.e(2),i.e(25),i.e(73),i.e("trading-custom-widgets")]).then(i.bind(null,"Hmbi")).then((function(e){return Object(o.__awaiter)(t,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return[4,this._model.getQtyInfo()];case 1:return null===(t=i.sent())||e.render(this._isCalcOpened,this._calcContainer,Object(o.__assign)(Object(o.__assign)({},t),{valueGetter:this._getCurrentQty,position:this._getCalcPosition(),targetEl:this._qtyEl,onClose:this._closeCalc.bind(this),onValueChange:this._model.setQty.bind(this._model),trackEventTarget:"Sell/Buy Buttons",trackEvent:this._trackEvent})),[2]}}))}))}))},t.prototype._getCalcPosition=function(){var t=this._qtyEl.getBoundingClientRect();return{x:t.left,y:t.bottom+2}},t}(),ne=i("7KDR"),se=window.t("Show Buy/Sell Buttons"),ae=function(){function t(t,e,i,o){this._showSellBuyButtons=o.showSellBuyButtons,this._trackEvent=i.trackEvent,this._model=new Xt(t,e,i,o),this._renderer=new re(this._model,o.noConfirmEnabled,i.trackEvent)}return t.prototype.destroy=function(){this._model.destroy(),
this._renderer.destroy()},t.prototype.getElement=function(){return this._renderer.element},t.prototype.visibility=function(){return this._model.visible},t.prototype.updateWidgetModeBySize=function(t){this._renderer.updateModeByWidth(t.w)},t.prototype.contextMenuActions=function(){var t=this;return window.innerWidth<600||window.innerHeight<440?[]:[new ne.Action({checkable:!0,checked:this._showSellBuyButtons.value(),label:se,onExecute:function(){var e=!t._showSellBuyButtons.value();t._showSellBuyButtons.setValue(e),t._trackEvent("SellBuyButtonsWidget context menu","Show Sell/Buy Button",e?"Check":"Uncheck")}})]},t}();var ce,ue=i("MXV9");i.d(e,"showSellBuyButtonsDefault",(function(){return fe})),i.d(e,"Trading",(function(){return be}));var le=Object(p.getLogger)("Trading.Core"),de=((ce={})[1]="Connected",ce[2]="Connecting",ce[3]="Disconnected",ce[4]="Error",ce),he={enabled:new S.a(!1),name:"alert/alarm_clock"};var pe=A.enabled("buy_sell_buttons"),_e=r.t("Show Buy/Sell Buttons"),fe=!0,be=function(){function t(t){var e=this;this.accountType=new S.a,this.onBrokerChange=new h.a,this.onBrokerLoading=new h.a,this.onConnectionStatusChange=new h.a,this.onNewNotification=new h.a,this.onNeedSelectBroker=new h.a,this.onNotificationsChanged=new h.a,this.showSellBuyButtons=new S.a,this.noConfirmEnabled=new S.a,this.showOnlyRejectionNotifications=new S.a,this.showPricesWithZeroVolume=new S.a,this.showSpread=new S.a,this.orderExecutedSoundParams=he,this._activeBroker=null,this._orderViewController=null,this._orderControllerPromise=null,this._brokerCommandsUI=null,this._showPricesWithZeroVolume=new S.a,this._showSpread=new S.a,this._offlineListener=this._offlineHandler.bind(this),this._onlineListener=this._onlineHandler.bind(this),this._notifications=[],this._account=null,this._domPanelVisibility=new S.a(!1),this._orderPanelVisibility=new S.a(!1),this._switchingBroker=!1,this._accountVerificationPromise=null,this._chartWidgetCollection=null,this._updateAccountId=function(){e._account=Object(n.ensureNotNull)(e._activeBroker).currentAccount(),e.onNotificationsChanged.fire(e.getNotifications())},this._resizerBridge=t,this._realtimeProvider=new m((function(){return e.activeBroker()}),this.onBrokerChange,this.onConnectionStatusChange,this.suggestedQty()),this._positionService=new Ut(this),this._tradingStat=new v(this),this.tradingPanel=new ut(t);var o=new ot(t,(function(){return e.tradingPanel.close()}));this.tradingPanel.addPage(nt.d.DomPanel,o);var r=new rt;this.tradingPanel.addPage(nt.d.OrderPanel,r);var s=k.getValue(u.settingsKeys.TRADING_PANEL_ACTIVE_PAGE),a=k.getBool(u.settingsKeys.TRADING_PANEL_OPENED,A.enabled("show_order_panel_on_start"));this._applyCQGTerminalRedirectPatches(),s&&this.tradingPanel.activePage.setValue(s),a&&this.tradingPanel.open(),this.tradingPanel.isPageOpened(nt.d.OrderPanel)&&this.tradingPanel.isAvailable.value()&&this.setOrderPanelVisibility(!0),Object(O.combine)((function(){return{}}),this.tradingPanel.activePage,this.tradingPanel.isOpened).subscribe((function(){
e._domPanelVisibility.setValue(e.tradingPanel.isPageOpened(nt.d.DomPanel)),e._orderPanelVisibility.setValue(e.tradingPanel.isPageOpened(nt.d.OrderPanel))})),this._loginDialogRenderer=Promise.all([i.e("react"),i.e(4),i.e(10),i.e(11),i.e(12),i.e(15),i.e(17),i.e(20),i.e(42),i.e(134),i.e(0),i.e("login-dialog")]).then(i.bind(null,"hdTl")).then((function(t){return new t.LoginDialogRenderer((function(){return e.selectBroker(null)}),e.trackEvent.bind(e),e._checkCQGCredentials.bind(e))}))}return t.prototype.setChartWidgetCollection=function(t){var e=this;Object(n.assert)(null===this._chartWidgetCollection,"ChartWidgetCollection can be set only once"),this._chartWidgetCollection=t,this._guiAccessor=new D(t),new Ct(this),this._loadState(),k.onSync.subscribe(this,this._loadState);var i=function(){e._save()};this.showSellBuyButtons.subscribe(i),this.noConfirmEnabled.subscribe(i),this.showOnlyRejectionNotifications.subscribe(i),this._showPricesWithZeroVolume.subscribe(i),this._showSpread.subscribe(i),this.orderExecutedSoundParams.enabled.subscribe(i),window.addEventListener("offline",this._offlineListener),window.addEventListener("online",this._onlineListener),this.bindShortcuts(),this._registerCustomSources(t),this._registerCustomWidgets(t)},t.prototype.showPricesWith=function(){return{zeroVolume:this._showPricesWithZeroVolume,spread:this._showSpread}},t.prototype.domPanelVisibility=function(){return this._domPanelVisibility},t.prototype.orderPanelVisibility=function(){return this._orderPanelVisibility},t.prototype.realtimeProvider=function(){return this._realtimeProvider},t.prototype.toggleTradingWidget=function(){return TradingView.bottomWidgetBar?TradingView.bottomWidgetBar.activateTradingTab():Promise.resolve()},t.prototype.tradingWizard=function(){return this._tradingWizard},t.prototype.showTradingProperties=function(){this._gui()&&this._gui().showTradingProperties()},t.prototype.brokersList=function(){return a.brokersList()},t.prototype.brokersPlans=function(){return this._getBrokerPlans()},t.prototype.activeBroker=function(){return this._activeBroker},t.prototype.brokerCommandsUI=function(){return this._brokerCommandsUI},t.prototype.trackEvent=function(t,e,i){var o=t?"["+t+"] "+e:e;if(this._gui()){var r=this._activeBroker?this._activeBroker.metainfo().id+" Trading":"Trading No Broker",n=this._activeBroker?this._activeBroker.currentAccountType():void 0;this._gui().trackEvent(r,o,i||n)}},t.prototype.selectBroker=function(t,e){void 0===e&&(e=!1),this._selectBrokerInternal(t,!0,e)},t.prototype.pickDefaultBroker=function(){if(!this._activeBroker){var t=null,e=this.brokersList().filter((function(t){return!t.configFlags.isSuspended}));if(1===e.length)t=e[0].id;else{var i=k.getValue(u.settingsKeys.ACTIVE_BROKER);i&&e.some((function(t){return t.id===i}))&&(t=i)}t&&this.selectBroker(t)}},t.prototype.defaultContextMenuActions=function(t,e){var i=void 0===e?{}:e,n=i.onlyMainActions,s=void 0!==n&&n,a=i.gaOrigin,c=void 0===a?"Chart Context Menu":a;return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,i,n,a=this
;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.suggestedQty().value(t.symbol)];case 1:return e=o.sent(),i=t.value||void 0,[4,this._makeSubActions(t,e,c)];case 2:return n=o.sent(),s||(n.push({name:"trade-new-order",action:function(){a.trackEvent(c,"New Order"),a._checkAndOpenOrderDialog({limitPrice:i,qty:e,stopPrice:i,symbol:t.symbol})},text:r.t("Create New Order..."),statName:"NewOrder"}),A.enabled("property_pages")&&(n.push({separator:!0}),n.push({name:"trade-properties",action:function(){a.trackEvent(c,"Trading Properties"),a.showTradingProperties()},text:r.t("Trading Settings..."),icon:ue,statName:"Properties"}))),[2,n]}}))}))},t.prototype.defaultDropdownMenuActions=function(t){var e=this,i="Bottom Panel Dropdown",o=[],n=this.activeBroker(),s=t||{disconnect:!0,selectAnotherBroker:!A.enabled("trading_terminal"),showSellBuyButtons:pe,showOrderPanel:A.enabled("order_panel"),showDOM:A.enabled("dome_widget")&&n&&n.metainfo().configFlags.supportDOM,tradingProperties:!0,showHowToUse:n&&n.metainfo().configFlags.supportHowToUse};A.enabled("property_pages")||(s.tradingProperties=!1);var a={separator:!0};function c(t){return t.length&&t.push(a),t}return s.showSellBuyButtons&&o.push({action:function(){var t=!e.showSellBuyButtons.value();e.trackEvent(i,"Show Sell/Buy Buttons",t?"Check":"Uncheck"),e.showSellBuyButtons.setValue(t)},checkable:!0,checked:this.showSellBuyButtons.value(),text:_e}),s.showOrderPanel&&A.enabled("order_panel")&&o.push({action:function(){var t=e.tradingPanel.isPageOpened(nt.d.OrderPanel);e.trackEvent(i,"Show Order Panel",t?"Uncheck":"Check"),e.setOrderPanelVisibility(!t)},checkable:!0,checked:this.tradingPanel.isPageOpened(nt.d.OrderPanel),text:$.t("Show Order Panel")}),s.showDOM&&A.enabled("dome_widget")&&o.push({action:function(){var t=e.tradingPanel.isPageOpened(nt.d.DomPanel);e.trackEvent(i,"Show DOM",t?"Uncheck":"Check"),e.setDomPanelVisibility(!t)},checkable:!0,checked:this.tradingPanel.isPageOpened(nt.d.DomPanel),text:r.t("Show DOM")}),s.tradingProperties&&(c(o),o.push({action:function(){e.showTradingProperties(),e.trackEvent(i,"Trading Properties")},text:r.t("Trading Settings..."),icon:ue})),s.disconnect,o},t.prototype.chartContextMenuActions=function(t,e){return(this._activeBroker&&1===this._activeBroker.connectionStatus()?this._activeBroker.chartContextMenuActions(t,e):this.defaultContextMenuActions(t,e)).then((function(t){return Object(w.convertActionDescriptionsToActions)(t)}))},t.prototype.connectStatus=function(){return this._activeBroker?this._activeBroker.connectionStatus():3},t.prototype.bindShortcuts=function(){var t=this;if(!this._hotkeys){this._hotkeys=lt.createGroup({desc:"Trading"});var e=function(e){var i=t._gui().proSymbol();t.suggestedQty().value(i).then((function(o){t.realtimeProvider().quotesSnapshot(i).then((function(r){var n=r.bid,s=r.ask,a={price:void 0!==n&&void 0!==s?(n+s)/2:NaN,qty:o,side:e,symbol:i,type:2,seenPrice:null};t.trackEvent("Shortcut",-1===e?"Sell":"Buy"),t._checkAndPlaceOrder(a)}))}))};this._hotkeys.add({desc:"Buy",
hotkey:lt.Modifiers.Shift+66,handler:function(){return e(1)}}),this._hotkeys.add({desc:"Sell",hotkey:lt.Modifiers.Shift+83,handler:function(){return e(-1)}})}},t.prototype.suggestedQty=function(){var t=this;if(!this._suggestedQty){var e=new h.a;this._suggestedQty={changed:e,setValue:function(i,o){t._setSymbolQty(i,o),e.fire(i)},value:function(e){return t.realtimeProvider().symbolInfo(e).then((function(i){var o=t._getSymbolQty(e)||t._getOldSymbolQty(e),r=void 0!==i.qty.default?i.qty.default:i.qty.min;return o?Object(s.alignTo)(Math.max(Math.min(i.qty.max,+o),i.qty.min),i.qty.step):r}))}}}return this._suggestedQty},t.prototype.formatter=function(t){return this.realtimeProvider().formatter(t)},t.prototype.showSuccessNotification=function(t,e,i){void 0===i&&(i=1e4),this.showOnlyRejectionNotifications.value()||this._showNotification(t,e,"success",i),A.enabled("show_trading_notifications_history")&&this._addNotificationRow(t,e,"success",i),this._log(t,e)},t.prototype.showErrorNotification=function(t,e,i){void 0===i&&(i=25e3),this._showNotification(t,e,"danger",i),A.enabled("show_trading_notifications_history")&&this._addNotificationRow(t,e,"danger",i),this._log(t,e)},t.prototype.getNotifications=function(){var t=this;return this._notifications.filter((function(e){return e.account===t._account&&e.broker===(t._activeBroker?t._activeBroker.metainfo().id:null)}))},t.prototype.setDomPanelVisibility=function(t){t?this.tradingPanel.openPage(nt.d.DomPanel):this.tradingPanel.close()},t.prototype.setOrderPanelVisibility=function(t){this._getOrderViewController().then((function(e){t?e.openPanel():e.closePanel()}))},t.prototype.orderViewController=function(){return Object(n.ensureNotNull)(this._orderViewController)},t.prototype.tradingStat=function(){return this._tradingStat},t.prototype.verifyBrokerLiveAccount=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._verifyLiveAccount(),[2,null!==this._accountVerificationPromise?this._accountVerificationPromise:Promise.reject("Account verification is not needed")]}))}))},t.prototype._getOrderViewController=function(){var t=this;return null===this._orderViewController?this._createOrderController().then((function(){return t._getOrderViewController()})):Promise.resolve(this._orderViewController)},t.prototype._getSymbolQty=function(t){var e=this._getBrokerSymbolsQty();if(e)return e[t]},t.prototype._getOldSymbolQty=function(t){var e=k.getFloat(u.settingsKeys.QTY+t);return void 0!==e&&(this._setSymbolQty(t,e),k.remove(u.settingsKeys.QTY+t)),e},t.prototype._getBrokerSymbolsQty=function(){if(this._activeBroker){var t=this._activeBroker.metainfo().id;return k.getJSON(u.settingsKeys.BROKERS_QTY,{})[t]}},t.prototype._setSymbolQty=function(t,e){if(this._activeBroker){var i=this._activeBroker.metainfo().id,o=k.getJSON(u.settingsKeys.BROKERS_QTY,{});o[i]||(o[i]={}),o[i][t]=e,k.setJSON(u.settingsKeys.BROKERS_QTY,o)}},t.prototype._selectBrokerInternal=function(t,e,i,r){return void 0===i&&(i=!1),
Object(o.__awaiter)(this,void 0,void 0,(function(){var n,s,l,d,h,p=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return!0===this._switchingBroker?(le.logWarn("Broker is already selected, but a new broker id: "+t+" was received."),[2]):(n=this._activeBroker?this._activeBroker.metainfo().id:null,t===n?[2]:(this._activeBroker&&(this._showReviewDialogIfNeeded(3,{disconnectType:c.DisconnectType.LogOut}),this._activeBroker.connectionStatusUpdate.unsubscribe(this,this._connectionListener),this._activeBroker.disconnect(i||!e),this._activeBroker.destroy(),this._activeBroker=null,this._updateConnectionStatus(3,e,r)),null==t?[3,3]:(this._switchingBroker=!0,s=void 0,l=function(t){p._activeBroker&&(le.logWarn("Another one connecting broker detected. Disconnect it."),p._activeBroker.disconnect(i),p._activeBroker.destroy()),p._switchingBroker=!1,p._activeBroker=t,t.connectionStatusUpdate.subscribe(p,p._connectionListener),p._brokerCommandsUI=new it(p._activeBroker,p._guiAccessor,p.noConfirmEnabled,p._getOrderViewController.bind(p),p.showErrorNotification.bind(p),p.trackEvent.bind(p)),t.tryRestoreSession(),k.setValue(u.settingsKeys.ACTIVE_BROKER,t.metainfo().id),p.onBrokerChange.fire(p._activeBroker),p._getOrderViewController(),p._updateConnectionStatus(p.connectStatus())},[3,2])));case 1:d=o.sent(),s=d.filter((function(e){return e.slug_name===t}))[0],window.user.active_broker=s,o.label=2;case 2:return(h=a.createBrokerConnection(this,t,s)).then(l),h.catch((function(t){return le.logError(t)})),[3,4];case 3:e&&setTimeout((function(){k.remove(u.settingsKeys.ACTIVE_BROKER)})),this.onBrokerChange.fire(null),this._brokerCommandsUI=null,this._accountVerificationPromise=null,o.label=4;case 4:return[2]}}))}))},t.prototype._gui=function(){return this._guiAccessor},t.prototype._addNotificationRow=function(t,e,i,o){var r={id:this._notifications.length,account:this._account,broker:this._activeBroker?this._activeBroker.metainfo().id:null,time:new Date,title:t,text:e,type:i};this._notifications.push(r),this.onNewNotification.fire(r)},t.prototype._offlineHandler=function(){this._selectBrokerInternal(null,!1,!1,{disconnectType:c.DisconnectType.Offline}),le.logNormal("The connection to the Internet was interrupted")},t.prototype._onlineHandler=function(){var t=k.getValue(u.settingsKeys.ACTIVE_BROKER);t&&(this._selectBrokerInternal(t,!1),le.logNormal("The connection to the Internet was restored"))},t.prototype._showNotification=function(t,e,i,o){this._gui()&&this._gui().showNotification(t,e,i,o)},t.prototype._showReviewDialogIfNeeded=function(t,e){if(null!==this._activeBroker)this._activeBroker},t.prototype._connectionListener=function(t,e){var i=this.connectStatus();this._showReviewDialogIfNeeded(t,e),3===t&&e&&e.disconnectType===c.DisconnectType.LogOut&&this._selectBrokerInternal(null,!1,!1,e),this._updateConnectionStatus(i,!0,e)},t.prototype._updateOrderPanelSpinnerState=function(){var t=this._orderViewController,e=2===this.connectStatus(),i=null!==t&&t.stateChanging.value();this.tradingPanel.isLoading.setValue(e||i)},
t.prototype._updateConnectionStatus=function(t,e,i){var o=this;void 0===e&&(e=!0),this._updateOrderPanelSpinnerState(),this.onConnectionStatusChange.fire(t,i),this._log("Connection status",de[t]);var r=this._activeBroker;if(e){var n=this._activeBroker?this._activeBroker.metainfo().id:void 0;k.setValue(u.settingsKeys.ACTIVE_BROKER,n,{forceFlush:!0})}this._activeBroker&&(1===t?this._account=this._activeBroker.currentAccount():(this._accountVerificationPromise=null,null!==this._account&&this._activeBroker.currentAccountUpdate.unsubscribe(this,this._updateAccountId))),this._loginDialogRenderer.then((function(e){r===o._activeBroker&&e.updateStatus(r,t,i)}))},t.prototype._verifyLiveAccount=function(){if(null===this._accountVerificationPromise){var t=Object(n.ensureNotNull)(this._activeBroker);t.metainfo().configFlags.supportVerifyLiveAccount&&(t.currentAccountType(),c.AccountType.Live)}},t.prototype._save=function(){k.setJSON(u.settingsKeys.PROPERTIES,{showSellBuyButtons:+!!this.showSellBuyButtons.value(),noConfirmEnabled:+!!this.noConfirmEnabled.value(),qweqrq:+!!this.showOnlyRejectionNotifications.value(),showPricesWithZeroVolume:+!!this._showPricesWithZeroVolume.value(),showSpread:+!!this._showSpread.value(),orderExecutedSoundParams:JSON.stringify({enabled:+!!this.orderExecutedSoundParams.enabled.value(),name:this.orderExecutedSoundParams.name})})},t.prototype._loadState=function(){var t=k.getJSON(u.settingsKeys.PROPERTIES,{});if(this.showSellBuyButtons.setValue(void 0!==t.showSellBuyButtons?!!t.showSellBuyButtons:fe),this.noConfirmEnabled.setValue(!!t.noConfirmEnabled),this.showOnlyRejectionNotifications.setValue(!!t.qweqrq),this._showPricesWithZeroVolume.setValue(!t.hasOwnProperty("showPricesWithZeroVolume")||t.showPricesWithZeroVolume),this._showSpread.setValue(!t.hasOwnProperty("showSpread")||t.showSpread),t.hasOwnProperty("orderExecutedSoundParams")){var e=JSON.parse(t.orderExecutedSoundParams);this.orderExecutedSoundParams.enabled.setValue(!!e.enabled),this.orderExecutedSoundParams.name=e.name}},t.prototype._log=function(t,e){le.logNormal((this._activeBroker?this._activeBroker.metainfo().id+" Trading: ":"")+t+" - "+e)},t.prototype._makeSureCanTrade=function(){var t=this,e=this.activeBroker(),i=this.brokerCommandsUI();return e&&i?1===e.connectionStatus()||(this.toggleTradingWidget(),!1):(this.toggleTradingWidget().then((function(){return t.onNeedSelectBroker.fire()})),!1)},t.prototype._checkAndPlaceOrder=function(t,e){void 0===e&&(e=!0),this._makeSureCanTrade()&&Object(n.ensureNotNull)(this.brokerCommandsUI()).placeOrder(t,e)},t.prototype._checkAndOpenOrderDialog=function(t){this._makeSureCanTrade()&&Object(n.ensureNotNull)(this.brokerCommandsUI()).placeOrder(t)},t.prototype._makeSubAction=function(t,e,i,o,n,s,a){var c=this,u=1===e?"Buy":"Sell",l=1===i?"Limit":"Stop",d=u+l,h={BuyLimit:r.t("Buy {symbol} Limit {qty} @ {value}").format({symbol:t.displaySymbol,qty:Object(P.abbreviatedNumber)(s),value:n}),SellStop:r.t("Sell {symbol} Stop {qty} @ {value}").format({symbol:t.displaySymbol,
qty:Object(P.abbreviatedNumber)(s),value:n}),SellLimit:r.t("Sell {symbol} Limit {qty} @ {value}").format({symbol:t.displaySymbol,qty:Object(P.abbreviatedNumber)(s),value:n}),BuyStop:r.t("Buy {symbol} Stop {qty} @ {value}").format({symbol:t.displaySymbol,qty:Object(P.abbreviatedNumber)(s),value:n})};return{name:("trade-"+u+"-"+l).toLowerCase(),action:function(){c.trackEvent(a,u+" "+l);var r=1===i?"limitPrice":"stopPrice",n={qty:s,side:e,symbol:t.symbol,type:i,seenPrice:null};null!==o&&(n[r]=o),c._checkAndPlaceOrder(n)},text:h[d],statName:d}},t.prototype._createOrderController=function(){var t=this;return null===this._orderControllerPromise&&(this._orderControllerPromise=new Promise((function(e){Promise.all([i.e(101),i.e(25),i.e(73),i.e("order-view-controller")]).then(function(o){var r=i("3bpA").OrderViewController;e(new r({resizerBridge:t._resizerBridge,onNeedSelectBroker:t.onNeedSelectBroker,realtimeProvider:t.realtimeProvider(),suggestedQty:t.suggestedQty(),trackEvent:t.trackEvent.bind(t),toggleTradingWidget:t.toggleTradingWidget.bind(t),showErrorNotification:t.showErrorNotification.bind(t)},{container:t.tradingPanel.container,isAvailable:t.tradingPanel.isAvailable,isOpened:t.tradingPanel.isOpened,activePage:t.tradingPanel.activePage,close:t.tradingPanel.close.bind(t.tradingPanel),openPage:t.tradingPanel.openPage.bind(t.tradingPanel)}))}.bind(null,i)).catch(void 0)})).then((function(e){t._orderControllerPromise=null,t._orderViewController=e,t._orderViewController.stateChanging.subscribe((function(){return t._updateOrderPanelSpinnerState()}))}))),this._orderControllerPromise},t.prototype._registerCustomSources=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return t.addCustomSource("trading",(function(t){return new Et.a(t,e)})),function(t,e){Object(o.__awaiter)(this,void 0,void 0,(function(){var r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,i.e("trading-custom-sources").then(i.bind(null,"bydf"))];case 1:return r=o.sent(),t.addCustomSource("bidask",(function(i){return new r.BidAsk(i,e.realtimeProvider(),(function(){t.activeChartWidget.value().showGeneralChartProperties(j.TabNames.style)}))})),[2]}}))}))}(t,this),Lt(t,this),[4,i.e("trading-custom-sources").then(i.bind(null,"J1Ip"))];case 1:return new(r.sent().PositionsManager)(this._positionService,t,{brokerCommandsUI:this.brokerCommandsUI.bind(this),trackEvent:this.trackEvent.bind(this)}),[2]}}))}))},t.prototype._registerCustomWidgets=function(t){pe&&function(t,e){t.addCustomWidgetToLegend((function(t){var i=t.mainSeries();return new ae(i.dataEvents(),function(t){return function(){var e=t.symbolInfo();return null!==e?e.pro_name||e.full_name||e.name||"":t.proSymbol()}}(i),{onNeedSelectBroker:e.onNeedSelectBroker,realtimeProvider:e.realtimeProvider(),suggestedQty:e.suggestedQty(),trackEvent:e.trackEvent.bind(e),toggleTradingWidget:e.toggleTradingWidget.bind(e),brokerCommandsUI:e.brokerCommandsUI.bind(e)},{
showSellBuyButtons:e.showSellBuyButtons,noConfirmEnabled:e.noConfirmEnabled})}),{block:0,position:0})}(t,this)},t.prototype._makeSubActions=function(t,e,i){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,n,a,c,u,l,d,h,p,_,f,b,y,m,g,v,k,P;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return r=[],n=this.activeBroker(),a=null===n,c=null===n,null===n||1!==n.connectionStatus()?[3,2]:[4,n.isTradable(t.symbol)];case 1:y=o.sent(),o.label=2;case 2:return null!==n&&y&&y.tradable&&null!==t.value?(m=n.metainfo().configFlags,[4,n.symbolInfo(t.symbol)]):[3,5];case 3:return g=o.sent(),O=t.value,B=g.minTick,v=Object(s.fixComputationError)(Math.round(O/B)*B),u=v,d=v,h=v,l=v,a=Boolean(m.supportLimitOrders),c=Boolean(m.supportStopOrders),void 0!==g.limitPriceStep&&(k=Object(w.roundToStepByPriceTypeAndSide)(t.value,g.limitPriceStep,1,1),u=k,d=Object(w.roundToStepByPriceTypeAndSide)(t.value,g.limitPriceStep,1,-1)),void 0!==g.stopPriceStep&&(k=Object(w.roundToStepByPriceTypeAndSide)(t.value,g.stopPriceStep,2,1),h=k,l=Object(w.roundToStepByPriceTypeAndSide)(t.value,g.stopPriceStep,2,-1)),[4,n.formatter(t.symbol,!1)];case 4:return P=o.sent(),p=P.format(u),_=P.format(l),f=P.format(d),b=P.format(h),[3,6];case 5:u=d=h=l=t.value,p=_=f=b=t.formattedValue,o.label=6;case 6:return null!==t.value&&t.value<=t.last?(a&&r.push(this._makeSubAction(t,1,1,u,p,e,i)),c&&r.push(this._makeSubAction(t,-1,3,l,_,e,i))):null!==t.value&&t.value>=t.last&&(a&&r.push(this._makeSubAction(t,-1,1,d,f,e,i)),c&&r.push(this._makeSubAction(t,1,3,h,b,e,i))),[2,r]}var O,B}))}))},t.prototype._initPaidBrokersByUserRegion=function(){this._brokersListPromise=fetch("/api/v1/brokers/trading_panel",{method:"GET"}).then((function(t){return t.json()})).catch((function(t){le.logWarn("Failed to fetch brokers info: "+t)}))},t.prototype._getBrokerPlans=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:t=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._brokersListPromise];case 2:if(t=i.sent(),!Array.isArray(t))throw new Error("Request result is not valid");return[3,4];case 3:return e=i.sent(),le.logError("Failed to fetch broker list by user region: "+e.message),[3,4];case 4:return[2,t]}}))}))},t.prototype._checkCQGCredentials=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return[2];case 1:return i.trys.push([1,4,,5]),this._activeBroker?[4,checkRealtimeDataSubscription(this._activeBroker.metainfo().id,t)]:[3,3];case 2:i.sent()&&this._guiAccessor.reconnectChartApi(!0),i.label=3;case 3:return[3,5];case 4:return e=i.sent(),le.logError("Failed to fetch credentials verifier: "+e.message),[3,5];case 5:return[2]}}))}))},t.prototype._applyCQGTerminalRedirectPatches=function(){for(var t=k.getJSON(u.settingsKeys.FAVORITE_BROKERS,[]),e=function(e){if(document.referrer.includes(e.toLowerCase()+".tradingview.com")&&!t.some((function(t){return t===e
})))return t.push(e),k.setJSON(u.settingsKeys.FAVORITE_BROKERS,t),"break"},i=0,o=["CQG","AMP"];i<o.length;i++){if("break"===e(o[i]))break}},t}()},GOhO:function(t,e,i){"use strict";var o=i("+DwS"),r=i("tc+8"),n=i.n(r);function s(t,e){var i=new n.a(t()),o={};return i.destroy=function(){e.unsubscribeAll(o)},e.subscribe(o,(function(){i.setValue(t())})),i}var a=i("m/cY");function c(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var o=function(){return t.apply(void 0,e.map((function(t){return t.value()})))},r=Object(a.a)(o()),n=function(){return r.setValue(o())},s={},c=0,u=e;c<u.length;c++){var l=u[c];l.subscribe(s,n)}return r.destroy=function(){e.forEach((function(t){return t.unsubscribeAll(s)}))},r}i.d(e,"c",(function(){return o.a})),i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return c}))},Hgre:function(t,e,i){"use strict";i.r(e);var o=i("mrSG"),r=(i("P5fv"),i("YFKU"),i("Kxc7")),n=i("Eyy1"),s=function(){function t(t,e,i){var o=this;this._symbol=null,this._side=null,this._realtimeData=null,this._avgPrice=null,this._positionId=t,this._adapter=e,this._host=i,this._adapter.positionById(t).then((function(t){var e=Object(n.ensureDefined)(t);o._symbol=e.symbol,o._side=e.side,o._onPositionChanged(e),o._onRealtimeBinded=o._onRealtime.bind(o),o._adapter.subscribeRealtime(o._symbol,o._onRealtimeBinded),o._adapter.positionUpdate.subscribe(o,o._onPositionChanged)}))}return t.prototype.stop=function(){this._symbol&&this._adapter.unsubscribeRealtime(this._symbol,this._onRealtimeBinded),this._adapter.positionUpdate.unsubscribe(this,this._onPositionChanged)},t.prototype._updatePL=function(){if(this._realtimeData&&this._realtimeData.trade&&this._avgPrice){var t=(this._realtimeData.trade-Math.abs(this._avgPrice))*(1===this._side?1:-1);this._host.plUpdate(this._positionId,t)}},t.prototype._onRealtime=function(t,e){this._realtimeData=e,this._updatePL()},t.prototype._onPositionChanged=function(t){this._avgPrice=t.avgPrice,this._updatePL()},t}(),a=i("ogJP"),c=i("aIyQ"),u=i.n(c),l=i("4qhP"),d=function(){function t(t){this._objects={},this._started=!1,this._isObjectsRequestActual=!1,this._ordersPromise=null,this._getter=t,this.updateDelegate=new u.a,this.partialUpdateDelegate=new u.a}return t.prototype.start=function(){this._started||(this._started=!0,this._ordersPromise=this._requestObjects())},t.prototype.stop=function(){this._objects={},this._started=!1,this._ordersPromise=null,this._isObjectsRequestActual=!1},t.prototype.update=function(t,e){this._started&&(this._isObjectsRequestActual?this._isObjectsRequestActual=!1:(this._objects[t.id]=t,this._onObjectUpdated(t,e)))},t.prototype.partialUpdate=function(t,e){if(this._started)if(this._isObjectsRequestActual)this._isObjectsRequestActual=!1;else{var i,o;Object(a.isObject)(t)?(i=t.id,o=t):(i=t,o=Object(n.ensure)(e));var r=this._objects[i];r&&(Object.assign(r,o),this.partialUpdateDelegate.fire(r,o))}},t.prototype.fullUpdate=function(){this._started&&(this._isObjectsRequestActual?this._isObjectsRequestActual=!1:this._ordersPromise=this._requestObjects())},
t.prototype.getObjects=function(){return this._ordersPromise||Promise.resolve(Object.values(this._objects))},t.prototype._onObjectUpdated=function(t,e){this.updateDelegate.fire(t,e)},t.prototype._onAllObjectsUpdated=function(){var t=this;this._objectsCache().forEach((function(e){return t.updateDelegate.fire(e,!0)}))},t.prototype._objectsCache=function(){return Object.values(this._objects)},t.prototype._requestObjects=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(e){switch(e.label){case 0:t=[],e.label=1;case 1:return this._isObjectsRequestActual=!0,[4,this._getter()];case 2:t=e.sent(),e.label=3;case 3:if(!this._isObjectsRequestActual)return[3,1];e.label=4;case 4:return this._objects=Object(l.objectsArrayToMap)(t,"id"),this._ordersPromise=null,this._isObjectsRequestActual=!1,this._onAllObjectsUpdated(),[2,t]}}))}))},t}(),h=i("txPx"),p=i("d13A"),_=function(t){function e(e,i){var o=t.call(this,e)||this;return o._brokerConfigGetter=i,o}return Object(o.__extends)(e,t),e.prototype._onObjectUpdated=function(e,i){this._patchTrades(this._objectsCache().filter((function(t){return t.symbol===e.symbol&&0!==t.qty})),e,i),t.prototype._onObjectUpdated.call(this,e,i)},e.prototype._onAllObjectsUpdated=function(){this._patchTrades(this._objectsCache().filter((function(t){return 0!==t.qty}))),t.prototype._onAllObjectsUpdated.call(this)},e.prototype._patchTrades=function(e,i,o){for(var r=this._brokerConfigGetter(),n=0,s=(r.requiresFIFOCloseTrades?r.fifoOnlyForSameQty?y:b:f)(e);n<s.length;n++){var a=s[n];i!==a&&t.prototype._onObjectUpdated.call(this,a,o)}},e}(d);function f(t){for(var e=[],i=0,o=t;i<o.length;i++){var r=o[i];r.canBeClosed||(r.canBeClosed=!0,e.push(r))}return e}function b(t){for(var e={},i=0,o=t;i<o.length;i++){void 0===(c=e[(h=o[i]).symbol])&&(c={oldest:null,all:[]},e[h.symbol]=c),(null===c.oldest||c.oldest.date>h.date)&&(c.oldest=h),c.all.push(h)}for(var r=[],s=0,a=Object.keys(e);s<a.length;s++)for(var c,u=a[s],l=0,d=(c=Object(n.ensureDefined)(e[u])).all;l<d.length;l++){var h=d[l],p=c.oldest===h,_=p!==h.canBeClosed;h.canBeClosed=p,_&&r.push(h)}return r}function y(t){for(var e={},i=0,o=t;i<o.length;i++){var r=e[(m=o[i]).symbol];void 0===r&&(r={},e[m.symbol]=r);var s=r[m.qty];void 0===s&&(s={oldest:null,all:[]},r[m.qty]=s),(null===s.oldest||s.oldest.date>m.date)&&(s.oldest=m),s.all.push(m)}for(var a=[],c=0,u=Object.keys(e);c<u.length;c++)for(var l=u[c],d=Object(n.ensureDefined)(e[l]),h=0,p=Object.keys(d);h<p.length;h++)for(var _=p[h],f=Object(n.ensureDefined)(d[_]),b=0,y=f.all;b<y.length;b++){var m=y[b],g=f.oldest===m,v=g!==m.canBeClosed;m.canBeClosed=g,v&&a.push(m)}return a}var m=i("Lj6W");var g=Object(h.getLogger)("Trading.BrokerConnectionAdapter");function v(t){Object(n.assert)("object"!=typeof t,"Expected not an object")}function k(){return!0}var w,P=function(){function t(t,e,i,o,r,n){var s=this;this.connectionStatusUpdate=new u.a,this.executionUpdate=new u.a,this.tradingOperationFinished=new u.a,this.currentAccountUpdate=new u.a,
this.orderDialogOptionsUpdate=new u.a,this.positionDialogOptionsUpdate=new u.a,this._brokerPlan=null,this._subscriptions={},this._lastFireResult={},this._fakeDomeSubscriptions={},this._formattersCache={},this._spreadFormattersCache={},this._quantityFormattersCache={},this._tradesCache=null,this._profitLossEmitters={},this._fakePositionUpdateDelegate=null,this._realtimeSubscriptionState=[],this._loggedInManually=!1,this._pendingSubscriptions=[],this.config=Object.assign({},t.configFlags),this._brokerMetainfo=this._patchMetainfo(t),this._brokerPlan=n||null,this._brokerConnection=e,this._host=i,this._tradingStat=r,i.setBrokerConnectionAdapter(this),this._initializeConnectProtection(),this._positionsCache=e.positions?new d((function(){return e.positions?e.positions():Promise.resolve([])})):null,this._tradesCache=e.trades?new _((function(){return e.trades?e.trades():Promise.resolve([])}),(function(){return s.config})):null,this._ordersCache=new d((function(){return e.orders()}));var a=function(t){1===t?(null!==s._positionsCache&&s._positionsCache.start(),s._ordersCache.start(),s._tradesCache&&s._tradesCache.start()):(null!==s._positionsCache&&s._positionsCache.stop(),s._ordersCache.stop(),s._tradesCache&&s._tradesCache.stop())};this.connectionStatusUpdate.subscribe(null,a),a(this.connectionStatus()),t.configFlags.supportPLUpdate||(this._brokerConnection.subscribePL=function(t){s._profitLossEmitters[t]=s._createProfitLossEmitter(t)},this._brokerConnection.unsubscribePL=function(t){var e=s._profitLossEmitters[t];e&&(e.stop(),s._profitLossEmitters[t]=null)}),this._originalDOMESubscriptionMethods={subscribeDOME:e.subscribeDOME,unsubscribeDOME:e.unsubscribeDOME};this.connectionStatusUpdate.subscribe(null,(function(t){if(1===t){var e=!s._brokerMetainfo.configFlags.supportLevel2Data;s._brokerConnection.subscribeDOME=e?function(t){s._fakeSubscribeDOME(t)}:s._originalDOMESubscriptionMethods.subscribeDOME,s._brokerConnection.unsubscribeDOME=e?function(t){s._fakeUnsubscribeDOME(t)}:s._originalDOMESubscriptionMethods.unsubscribeDOME}})),t.configFlags.supportPositions||(this._fakePositionUpdateDelegate=new u.a),this._brokerRealtimeAdapter=o}return t.prototype.tryRestoreSession=function(){if(this._brokerConnection.tryRestoreSession)return this._brokerConnection.tryRestoreSession()},Object.defineProperty(t.prototype,"orderUpdate",{get:function(){return this._ordersCache.updateDelegate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionUpdate",{get:function(){return null===this._fakePositionUpdateDelegate?Object(n.ensure)(this._positionsCache).updateDelegate:this._fakePositionUpdateDelegate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tradeUpdate",{get:function(){return Object(n.ensure)(this._tradesCache).updateDelegate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orderPartialUpdate",{get:function(){return this._ordersCache.partialUpdateDelegate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionPartialUpdate",{get:function(){
return null===this._fakePositionUpdateDelegate?Object(n.ensure)(this._positionsCache).partialUpdateDelegate:this._fakePositionUpdateDelegate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tradePartialUpdate",{get:function(){return Object(n.ensure)(this._tradesCache).partialUpdateDelegate},enumerable:!1,configurable:!0}),t.prototype.onOrderUpdate=function(t){this._ordersCache.update(t)},t.prototype.onOrderPartialUpdate=function(t,e){this._ordersCache.partialUpdate(t,e)},t.prototype.onPositionUpdate=function(t,e){if(Object(n.assert)(!!this.config.supportPositions,"Broker doesn`t support positions"),0===t.qty){var i=this._lastFireResult[t.symbol];i&&delete i.PL}Object(n.ensure)(this._positionsCache).update(t,e)},t.prototype.onPositionPartialUpdate=function(t,e){Object(n.assert)(!!this.config.supportPositions,"Broker doesn`t support positions"),Object(n.ensure)(this._positionsCache).partialUpdate(t,e)},t.prototype.onTradeUpdate=function(t,e){if(Object(n.assert)(!!this.config.supportTrades,"Broker doesn`t support trades"),0===t.qty){var i=this._lastFireResult[t.symbol];i&&delete i.TradePL}Object(n.ensure)(this._tradesCache).update(t,e)},t.prototype.onTradePartialUpdate=function(t,e){Object(n.ensure)(this._tradesCache).partialUpdate(t,e)},t.prototype.onCurrentAccountChanged=function(){null!==this._positionsCache&&this._positionsCache.fullUpdate(),this._ordersCache.fullUpdate(),this._tradesCache&&this._tradesCache.fullUpdate();var t=this.currentAccount();this.currentAccountUpdate.fire(t)},t.prototype.patchConfig=function(t){Object(m.migrateConfigFlags)(t),Object.assign(this.config,t),Object.assign(this._brokerMetainfo.configFlags,t),this._brokerMetainfo=this._patchMetainfo(this._brokerMetainfo)},t.prototype.patchOrderDialogOptions=function(t){void 0===this._brokerMetainfo.orderDialogOptions&&(this._brokerMetainfo.orderDialogOptions={}),Object.assign(this._brokerMetainfo.orderDialogOptions,t),this.orderDialogOptionsUpdate.fire(t)},t.prototype.patchPositionDialogOptions=function(t){void 0===this._brokerMetainfo.positionDialogOptions&&(this._brokerMetainfo.positionDialogOptions={}),Object.assign(this._brokerMetainfo.positionDialogOptions,t),this.positionDialogOptionsUpdate.fire(t)},t.prototype.chartContextMenuActions=function(t,e){return this._brokerConnection.chartContextMenuActions(t,e)},t.prototype.buttonDropdownActions=function(){return this._host.buttonDropdownActions()},t.prototype.connectionStatus=function(){return this._brokerConnection.connectionStatus()},t.prototype.isConnected=function(){return 1===this._brokerConnection.connectionStatus()},t.prototype.signIn=function(t,e,i){return Object(h.getLogger)("Trading."+this._brokerMetainfo.id+".Connection").logNormal("Try to login with username: "+t),this._loggedInManually=!0,this._brokerConnection.signIn(t,e,i)},t.prototype.loggedInManually=function(){return this._loggedInManually},t.prototype.disconnect=function(t){void 0===t&&(t=!1);try{return this._brokerConnection.disconnect(t)}catch(e){g.logWarn("Failed to disconnect")}},
t.prototype.currentAccount=function(){return this._brokerConnection.currentAccount?this._brokerConnection.currentAccount():""},t.prototype.currentAccountType=function(){return this._brokerConnection.currentAccountType?this._brokerConnection.currentAccountType():void 0},t.prototype.metainfo=function(){return this._brokerMetainfo},t.prototype.brokerPlan=function(){return this._brokerPlan},t.prototype.bro=function(){return this._brokerConnection},t.prototype.fireSubscription=function(t,e,i,o){if(void 0===this._lastFireResult[e]&&(this._lastFireResult[e]={Realtime:null,PL:null,Equity:null,DOME:null,TradePL:null,PipValue:null,MarginAvailable:null,CryptoBalance:null}),Object(n.ensure)(this._lastFireResult[e])[t]={data:i,time:Date.now()},void 0!==this._subscriptions[e]){var r=Object(n.ensure)(this._subscriptions[e]);Object(n.ensure)(r[t]).forEach((function(t){return t(e,i,o)}))}},t.prototype.positions=function(t){return this.config.supportPositions?(this._makeSureBrokerIsConnected(),this._positions().then((function(e){return e.filter((function(e){return void 0===t||e.symbol===t}))}))):Promise.resolve([])},t.prototype.disconnectWarningMessage=function(){return this._brokerConnection.disconnectWarningMessage?this._brokerConnection.disconnectWarningMessage():null},t.prototype.trades=function(t){return this._makeSureBrokerIsConnected(),Object(n.assert)(!!this.config.supportTrades,"Broker doesn`t support trades"),this._trades().then((function(e){return e.filter((function(e){return void 0===t||e.symbol===t}))}))},t.prototype.positionById=function(t){return this._brokerConnection.positionById?this._brokerConnection.positionById(t):this.positions().then((function(e){return e.find((function(e){return e.id===t}))})).then((function(t){return t}))},t.prototype.tradeById=function(t){return Object(n.assert)(!!this.config.supportTrades,"Broker doesn`t support trades"),this.trades().then((function(e){return e.find((function(e){return e.id===t}))})).then((function(t){return Object(n.ensure)(t)}))},t.prototype.orders=function(t){return this._makeSureBrokerIsConnected(),this._orders().then((function(e){return e.filter((function(e){return void 0===t||e.symbol===t}))}))},t.prototype.ordersHistory=function(){return this._makeSureBrokerIsConnected(),this.config.supportOrdersHistory&&this._brokerConnection.ordersHistory?this._brokerConnection.ordersHistory():Promise.resolve([])},t.prototype.executions=function(t){return this._makeSureBrokerIsConnected(),this._brokerConnection.executions(t)},t.prototype.orderById=function(t){return this._makeSureBrokerIsConnected(),this._brokerConnection.orders().then((function(e){return e.find((function(e){return e.id===t}))}))},t.prototype.accountManagerInfo=function(){return this._brokerConnection.accountManagerInfo()},t.prototype.isTradable=function(t){var e=this;return this._makeSureBrokerIsConnected(),this._brokerConnection.isTradable(t).then((function(i){return"object"!=typeof i&&(i={tradable:i}),i.tradable||void 0!==i.reason||(i.reason=window.t("Symbol {symbol} cannot be traded through {broker}.").format({
symbol:t,broker:e._brokerMetainfo.title})),i}))},t.prototype.formatter=function(t,e){return void 0===e&&(e=!0),this._makeSureBrokerIsConnected(),this._formattersCache[t]||(this._formattersCache[t]=this._brokerConnection.formatter&&this._brokerConnection.formatter(t,e)||this._host.defaultFormatter(t,e)),Object(p.a)(this._formattersCache[t],1e4,"formatter not received")},t.prototype.spreadFormatter=function(t){return this._makeSureBrokerIsConnected(),this._spreadFormattersCache[t]||(this._spreadFormattersCache[t]=this._brokerConnection.spreadFormatter&&this._brokerConnection.spreadFormatter(t)||this._host.defaultFormatter(t,!1)),Object(p.a)(this._spreadFormattersCache[t],1e4,"spreadFormatter not received")},t.prototype.quantityFormatter=function(t){return this._makeSureBrokerIsConnected(),this._quantityFormattersCache[t]||(this._quantityFormattersCache[t]=this._brokerConnection.quantityFormatter&&this._brokerConnection.quantityFormatter(t)||this._host.quantityFormatter()),Object(p.a)(this._quantityFormattersCache[t],1e4,"quantityFormatter not received")},t.prototype.placeOrder=function(t,e){var i=this;return this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.placeOrder(t),!0,window.t("Order rejected"),(function(){Object(n.ensureNotNull)(i._tradingStat).trackOrderPlaced(t),i._host.trackEvent("","SilentMode",i._host.silentOrdersPlacement().value()?"On":"Off")}))},t.prototype.previewOrder=function(t){if(!this.config.supportOrderPreview||!this._brokerConnection.previewOrder)throw new Error("Order preview is not supported");return this._brokerConnection.previewOrder(t)},t.prototype.modifyOrder=function(t){return this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.modifyOrder(t),!0,window.t("Failed to modify order"))},t.prototype.cancelOrder=function(t){return v(t),this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.cancelOrder(t),!0,window.t("Failed to cancel order"))},t.prototype.cancelOrders=function(t,e,i){return this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.cancelOrders(t,e,i),!0,window.t("Failed to cancel one or more orders"))},t.prototype.closePosition=function(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var i,r,s,a=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return v(t),this._makeSureBrokerIsConnected(),Object(n.assert)(void 0===e||!!this.config.supportPartialClosePosition,"Broker doesn`t support partial position closing"),r=n.ensureDefined,[4,this.positionById(t)];case 1:return 0===(i=r.apply(void 0,[o.sent()])).qty?(this._host.showNotification(window.t("Failed to close the position"),window.t("The position you are trying to close has been already closed."),0),[2,!1]):void 0===e||e<=Math.abs(i.qty)?this.config.supportClosePosition&&this._brokerConnection.closePosition?[2,this.processErrors(this._brokerConnection.closePosition(t,e),!0,window.t("Failed to close position"))]:(s=function(t,e){return{symbol:e.symbol,type:2,side:1===e.side?-1:1,qty:Math.abs(t),
seenPrice:null}}(null!=e?e:Math.abs(i.qty),i),[2,this.processErrors(this._brokerConnection.placeOrder(s),!0,window.t("Failed to close position"),(function(){return Object(n.ensureNotNull)(a._tradingStat).trackOrderPlaced(s)}))]):(this._host.showNotification(window.t("Failed to close the position"),window.t("The position you are trying to close has been changed."),0),[2,!1])}}))}))},t.prototype.closeTrade=function(t,e){var i;return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return v(t),this._makeSureBrokerIsConnected(),Object(n.assert)(!!this.config.supportTrades,"Broker doesn`t support trades"),Object(n.assert)(void 0===e||null!==(i=this.config.supportPartialCloseTrade)&&void 0!==i&&i,"Broker doesn`t support partial position closing"),s=n.ensureDefined,[4,this.tradeById(t)];case 1:if(0===(r=s.apply(void 0,[o.sent()])).qty)return this._host.showNotification(window.t("Failed to close the position"),window.t("The position you are trying to close has been already closed."),0),[2,!1];if(void 0===e||e<=Math.abs(r.qty)){if(this._brokerConnection.closeTrade)return[2,this.processErrors(this._brokerConnection.closeTrade(t,e),!0,window.t("Failed to close position"))];throw new Error("Method closeTrade is not implemented")}return this._host.showNotification(window.t("Failed to close the position"),window.t("The position you are trying to close has been changed."),0),[2,!1]}}))}))},t.prototype.reversePosition=function(t){var e=this;if(v(t),this._makeSureBrokerIsConnected(),this.config.supportMultiposition&&!this.config.supportNativeReversePosition)throw new Error("Cannot reverse position on multiposition acount");return this.config.supportNativeReversePosition&&this._brokerConnection.reversePosition?this.processErrors(this._brokerConnection.reversePosition(t),!0,window.t("Failed to reverse position")):this.positionById(t).then((function(t){var i,o=Object(n.ensureDefined)(t);return e.processErrors((i={qty:2*Math.abs(o.qty),side:1===o.side?-1:1,symbol:o.symbol,brokerSymbol:o.brokerSymbol,type:2,seenPrice:null},e.placeOrder(i)),!0,window.t("Failed to reverse position"),(function(){return Object(n.ensureNotNull)(e._tradingStat).trackOrderPlaced()}))}))},t.prototype.editPositionBrackets=function(t,e,i){if(this._makeSureBrokerIsConnected(),this._brokerConnection.editPositionBrackets)return this.processErrors(this._brokerConnection.editPositionBrackets(t,e,i),!0,$.t("Failed to modify Stop Loss / Take Profit"));throw new Error("Method editPositionBrackets is not implemented")},t.prototype.editTradeBrackets=function(t,e){if(this._makeSureBrokerIsConnected(),Object(n.assert)(!!this.config.supportTradeBrackets,"Broker doesn`t support brackets on trades"),this._brokerConnection.editTradeBrackets)return this.processErrors(this._brokerConnection.editTradeBrackets(t,e),!0,$.t("Failed to modify Stop Loss / Take Profit"));throw new Error("Method editTradeBrackets is not implemented")},t.prototype.subscribeRealtime=function(t,e){
return Object(o.__awaiter)(this,void 0,void 0,(function(){var i,r,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return this._makeSureBrokerIsConnected(),i={symbol:t,listener:e,provider:0},this._realtimeSubscriptionState.push(i),[4,this.symbolInfo(t)];case 1:return r=o.sent(),-1===(s=this._realtimeSubscriptionState.findIndex((function(i){return i.symbol===t&&i.listener===e})))?[2]:void 0!==r.hasQuotes&&!1===r.hasQuotes?(this._realtimeSubscriptionState[s].provider=1,[2,Object(n.ensure)(this._brokerRealtimeAdapter).subscribeRealtime(t,e)]):(this._realtimeSubscriptionState[s].provider=2,[2,this._addSubscription("Realtime",t,e)])}}))}))},t.prototype.quotesSnapshot=function(t){var e=this,i=null;return Object(p.a)(new Promise((function(o){var r=function(t,n){i=n,n&&(n.ask||n.bid)&&(e.unsubscribeRealtime(t,r),o(n))};e.subscribeRealtime(t,r)})),1e4,"quotesSnapshot not received").catch((function(t){if(null!==i)return i;throw t}))},t.prototype.subscribeDOME=function(t,e){return this._makeSureBrokerIsConnected(),this._addSubscription("DOME",t,e)},t.prototype.subscribePipValue=function(t,e){return this._makeSureBrokerIsConnected(),this._addSubscription("PipValue",t,e)},t.prototype.subscribePL=function(t,e){return this._makeSureBrokerIsConnected(),this._addSubscription("PL",t,e)},t.prototype.subscribeTradePL=function(t,e){return this._makeSureBrokerIsConnected(),this._addSubscription("TradePL",t,e)},t.prototype.subscribeCryptoBalance=function(t,e){return this._makeSureBrokerIsConnected(),this._addSubscription("CryptoBalance",t,e)},t.prototype.subscribeEquity=function(t){return this._makeSureBrokerIsConnected(),this._addSubscription("Equity","Equity",t)},t.prototype.subscribeMarginAvailable=function(t){return this._makeSureBrokerIsConnected(),this._addSubscription("MarginAvailable","MarginAvailable",t)},t.prototype.unsubscribeRealtime=function(t,e){var i=this._realtimeSubscriptionState.findIndex((function(i){return i.symbol===t&&i.listener===e}));-1!==i&&(1===this._realtimeSubscriptionState[i].provider?Object(n.ensure)(this._brokerRealtimeAdapter).unsubscribeRealtime(t,e):this._removeSubscription("Realtime",t,e),this._realtimeSubscriptionState.splice(i,1))},t.prototype.unsubscribeDOME=function(t,e){this._removeSubscription("DOME",t,e)},t.prototype.unsubscribePipValue=function(t,e){this._removeSubscription("PipValue",t,e)},t.prototype.unsubscribePL=function(t,e){this._removeSubscription("PL",t,e)},t.prototype.unsubscribeTradePL=function(t,e){this._removeSubscription("TradePL",t,e)},t.prototype.unsubscribeCryptoBalance=function(t,e){this._removeSubscription("CryptoBalance",t,e)},t.prototype.unsubscribeEquity=function(t){this._removeSubscription("Equity","Equity",t)},t.prototype.unsubscribeMarginAvailable=function(t){this._removeSubscription("MarginAvailable","MarginAvailable",t)},t.prototype.accountMetainfo=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e,i;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.accountsMetainfo()];case 1:if(t=o.sent(),
e=this.currentAccount(),void 0===(i=t.find((function(t){return t.id===e}))))throw new Error("accountMetainfo not received");return[2,i]}}))}))},t.prototype.accountsMetainfo=function(){return Object(p.a)(this._brokerConnection.accountsMetainfo(),1e4,"accountsMetainfo not received")},t.prototype.setCurrentAccount=function(t){if(void 0===this._brokerConnection.setCurrentAccount)throw new Error(this._brokerMetainfo.title+" doesn't support sub-accounts");this._brokerConnection.setCurrentAccount(t)},t.prototype.symbolInfo=function(t){return Object(p.a)(this._brokerConnection.symbolInfo(t),1e4,"symbolInfo not received")},t.prototype.bugReportInfo=function(){var t=this;function e(t){return JSON.parse(JSON.stringify(t))}function i(t){if("object"!=typeof t)return t;if(Object(a.isArray)(t))return t.map(i);var e={};for(var o in t)"object"!=typeof t[o]&&(e[o]=t[o]);return e}return Promise.all([this.orders(),this.positions(),this.config.supportTrades?this.trades():Promise.resolve([])]).then((function(o){return{activeBroker:t.metainfo().title,orders:i(e(o[0])),positions:i(e(o[1])),trades:i(e(o[2])),silentOrdersPlacement:t._host.silentOrdersPlacement().value(),floatingPanel:Object(n.ensureNotNull)(t._host.sellBuyButtonsVisibility()).value(),account:t.currentAccount(),accountType:t.currentAccountType(),lastUpdates:t._lastFireResult,time:Date.now(),brokerSpecific:t._brokerConnection.bugReportInfo?t._brokerConnection.bugReportInfo():null}}))},t.prototype.processErrors=function(t,e,i,o){var n=this;if(!Object(a.isPromise)(t))throw new Error("Broker incorrectly implements API, should return Promise");return t.then(o).then(k).catch((function(t){var o="";return"string"==typeof t?o=t:"object"==typeof t&&"string"==typeof t.message&&(o=t.message),e&&r.enabled("trading_notifications")?(0!==o.length&&("."!==o.slice(-1)&&(o+="."),o+=" "),o+=window.t("To learn more, please contact your broker."),n._host.showNotification(i||"",o,0)):g.logWarn(t),Promise.resolve(!1)})).then((function(t){return n.tradingOperationFinished.fire(t),t}))},t.prototype.setDurations=function(t){this._brokerMetainfo.durations=t.slice()},t.prototype.setSymbolSearchId=function(t){this._brokerMetainfo.symbolSearchId=t},t.prototype.getRealtimeDataCheckParams=function(){return this._brokerConnection.getRealtimeDataCheckParams?this._brokerConnection.getRealtimeDataCheckParams():{}},t.prototype.getVerifyLiveAccountParams=function(){if(void 0===this._brokerConnection.getVerifyLiveAccountParams)throw new Error("Method getVerifyLiveAccountParams for broker "+this._brokerMetainfo.id+" is not implemented");return this._brokerConnection.getVerifyLiveAccountParams()},t.prototype.unhideSymbolSearchGroups=function(){return this._brokerConnection.unhideSymbolSearchGroups?this._brokerConnection.unhideSymbolSearchGroups():[]},t.prototype.destroy=function(){void 0!==this._brokerConnection.destroy&&this._brokerConnection.destroy()},t.prototype.currenBroker=function(){return this._brokerMetainfo.id},t.prototype._initializeConnectProtection=function(){var t=this,e=null
;this.connectionStatusUpdate.subscribe(null,(function(i){if(e&&(clearTimeout(e),e=null),2===i){var o=Object(l.isOAuthAuthType)(t.config.authorizationType)?18e4:6e4;e=setTimeout((function(){t._host.selectBroker(),t._host.showNotification(window.t("Authorization Error"),window.t("The connection attempt failed. Please try again later."))}),o)}}))},t.prototype._fakeSubscribeDOME=function(t){var e=this;this._fakeDomeSubscriptions[t]=function(t,i){var o=i.ask||i.trade,r=i.bid||i.trade,n={snapshot:!0,asks:o?[{price:o,volume:i.ask_size||1/0}]:[],bids:r?[{price:r,volume:i.bid_size||1/0}]:[]};e._host.domeUpdate(t,n)},this.subscribeRealtime(t,this._fakeDomeSubscriptions[t])},t.prototype._fakeUnsubscribeDOME=function(t){this.unsubscribeRealtime(t,this._fakeDomeSubscriptions[t])},t.prototype._createProfitLossEmitter=function(t){return new s(t,this,this._host)},t.prototype._patchMetainfo=function(t){var e=JSON.parse(JSON.stringify(t));return e.configFlags.supportNativeReversePosition=!this.config.supportMultiposition||this.config.supportNativeReversePosition,e.configFlags.supportClosePosition=!0,e.configFlags.supportPLUpdate=!0,e},t.prototype._addSubscription=function(t,e,i){this._pendingSubscriptions.push({brokerMethodName:t,symbol:e,listener:i});var o=this._lastFireResult[e];if(void 0!==o&&void 0!==o[t]&&null!==o[t]&&i(e,o[t].data),this._removePendingSubscription({brokerMethodName:t,symbol:e,listener:i})){void 0===this._subscriptions[e]&&(this._subscriptions[e]={Realtime:[],PL:[],Equity:[],DOME:[],TradePL:[],PipValue:[],MarginAvailable:[],CryptoBalance:[]});var r=Object(n.ensure)(this._subscriptions[e]),s=r[t].length>0;if(r[t].push(i),!s&&(r[t].length>0||"CryptoBalance"===t)){var a="subscribe"+t;this._brokerConnection[a]&&this._brokerConnection[a](e)}}},t.prototype._removePendingSubscription=function(t){var e=this._pendingSubscriptions.findIndex((function(e){return e.symbol===t.symbol&&e.brokerMethodName===t.brokerMethodName&&e.listener===t.listener}));return-1!==e&&(this._pendingSubscriptions.splice(e,1),!0)},t.prototype._removeSubscription=function(t,e,i){if(!this._removePendingSubscription({brokerMethodName:t,symbol:e,listener:i})&&void 0!==this._subscriptions[e]){var o=Object(n.ensure)(this._subscriptions[e]),r=o[t].indexOf(i);if(r>-1&&o[t].splice(r,1),0===o[t].length){var s="unsubscribe"+t;this._brokerConnection[s]&&this._brokerConnection[s](e)}}},t.prototype._positions=function(){return this._positionsCache?this._positionsCache.getObjects():Promise.resolve([])},t.prototype._trades=function(){return this._tradesCache?this._tradesCache.getObjects():Promise.resolve([])},t.prototype._orders=function(){return this._ordersCache.getObjects()},t.prototype._makeSureBrokerIsConnected=function(){Object(n.assert)(1===this.connectionStatus(),"Broker is not connected")},t}(),O=i("1rjR"),B=i("QBLL"),S=i("C9TK"),C=i("hY0g"),T=i.n(C),E=i("Vdly"),j=i.n(E),I=i("jCNj"),D=i("zXvd"),A=i("cUJV"),N=i("5XxY"),L=i("IWXC"),M=Object(h.getLogger)("Trading.CredentialsWebStorage"),R=function(){function t(t){this._storage=t}
return t.prototype.setItem=function(t,e){try{var i=Object(a.isObject)(e)?JSON.stringify(e):String(e);this._storage.setItem(t,i)}catch(o){M.logError("Unable to save credentials using key "+t+": "+o.message)}},t.prototype.getItem=function(t,e){void 0===e&&(e=null);var i=e,o=this._storage.getItem(t);if(null===o)return i;try{i=JSON.parse(o)}catch(r){i=o}return i},t.prototype.removeItem=function(t){this._storage.removeItem(t)},t}(),V=function(t){function e(){return t.call(this,localStorage)||this}return Object(o.__extends)(e,t),e}(R),U=function(t){function e(){return t.call(this,sessionStorage)||this}return Object(o.__extends)(e,t),e}(R);!function(t){t[t.LocalStorage=0]="LocalStorage",t[t.SessionStorage=1]="SessionStorage"}(w||(w={}));var q=function(){function t(t,e){void 0===e&&(e=w.LocalStorage),this._brokerId=t.toLowerCase(),this._storageProvider=e===w.LocalStorage?new V:new U}return t.prototype.save=function(t,e){this._storageProvider.setItem(this._brokerId+"."+t,e)},t.prototype.load=function(t,e){return this._storageProvider.getItem(this._brokerId+"."+t,e)},t.prototype.clear=function(t){this._storageProvider.removeItem(this._brokerId+"."+t)},t}(),F=i("kcTO"),x=function(){function t(t,e){this._setDefaultDropdownActionsBound=this._setDefaultDropdownActions.bind(this),this._trading=t,this._metainfo=e,this._setDefaultDropdownActionsBound=this._setDefaultDropdownActions.bind(this),this._defaultDropdownActions=!0,this._credentialsStorage=new q(this._metainfo.id),this._setDefaultDropdownActions(),null!==this._trading&&(Object(n.ensureNotNull)(this.sellBuyButtonsVisibility()).subscribe(this._setDefaultDropdownActionsBound),Object(n.ensureNotNull)(this.orderPanelVisibility()).subscribe(this._setDefaultDropdownActionsBound),Object(n.ensureNotNull)(this.domPanelVisibility()).subscribe(this._setDefaultDropdownActionsBound))}return t.prototype.getLogger=function(){return Object(h.getLogger)("Trading."+this._metainfo.id)},t.prototype.translate=function(t){return t},t.prototype.setBrokerConnectionAdapter=function(t){this._adapter=t},t.prototype.patchConfig=function(t){this._adapter.patchConfig(t)},t.prototype.showOrderDialog=function(t,e){return Object(n.ensureNotNull)(this._trading).orderViewController().showOrderView(this._adapter,t,e)},t.prototype.showPositionBracketsDialog=function(t,e,i){return Object(n.ensureNotNull)(this._trading).orderViewController().showPositionView(this._adapter,t,e,i)},t.prototype.showCancelOrderDialog=function(t,e){var i=this;return O.a.get().open(t).then((function(t){t&&i._adapter.processErrors(e(),!0,$.t("Failed to cancel order"))}))},t.prototype.showCancelMultipleOrdersDialog=function(t,e,i,o){var r=this;return O.a.get().multiple(t,e,i).then((function(t){t&&r._adapter.processErrors(o(),!0,$.t("Failed to cancel one or more orders"))}))},t.prototype.showCancelBracketsDialog=function(t,e){var i=this;return B.a.get().open(t).then((function(t){t&&i._adapter.processErrors(e(),!0,$.t("Failed to cancel brackets"))}))},t.prototype.showCancelMultipleBracketsDialog=function(t,e){var i=this
;return B.a.get().multiple(t).then((function(t){t&&i._adapter.processErrors(e(),!0,$.t("Failed to cancel brackets"))}))},t.prototype.showReversePositionDialog=function(t,e){return Object(S.a)(t,Object(n.ensureNotNull)(this._trading).showErrorNotification,e)},t.prototype.showMessageDialog=function(t,e){N.a.show(t,e)},t.prototype.setDurations=function(t){this._adapter.setDurations(t)},t.prototype.patchOrderDialogOptions=function(t){this._adapter.patchOrderDialogOptions(t)},t.prototype.patchPositionDialogOptions=function(t){this._adapter.patchPositionDialogOptions(t)},t.prototype.setSymbolSearchId=function(t){this._adapter.setSymbolSearchId(t)},t.prototype.activateBottomWidget=function(){return null!==this._trading?this._trading.toggleTradingWidget():Promise.reject("Activate bottom widget failed: trading is not defined")},t.prototype.trackEvent=function(t,e,i){null!==this._trading&&this._trading.trackEvent(t,e,i)},t.prototype.defaultFormatter=function(t,e){return Object(L.getQuoteSessionInstance)("simple").formatter(t,e)},t.prototype.numericFormatter=function(t){return Promise.resolve(new D.NumericFormatter(t))},t.prototype.quantityFormatter=function(t){return Promise.resolve(new A.QuantityFormatter(t))},t.prototype.selectBroker=function(){null!==this._trading&&this._trading.selectBroker(null)},t.prototype.showTradingProperties=function(){null!==this._trading&&this._trading.showTradingProperties()},t.prototype.symbolSnapshot=function(t){return Object(L.getQuoteSessionInstance)("full").snapshot(t)},t.prototype.suggestedQty=function(){return Object(n.ensureNotNull)(this._trading).suggestedQty()},t.prototype.silentOrdersPlacement=function(){return Object(n.ensureNotNull)(this._trading).noConfirmEnabled},t.prototype.sellBuyButtonsVisibility=function(){return null!==this._trading&&r.enabled("buy_sell_buttons")?this._trading.showSellBuyButtons:null},t.prototype.domPanelVisibility=function(){return null!==this._trading?this._trading.domPanelVisibility():null},t.prototype.orderPanelVisibility=function(){return null!==this._trading?this._trading.orderPanelVisibility():null},t.prototype.showPricesWithZeroVolume=function(){return Object(n.ensureNotNull)(this._trading).showPricesWith().zeroVolume},t.prototype.showNotification=function(t,e,i){void 0===i&&(i=0),null!==this._trading&&(0===i?this._trading.showErrorNotification(t,e):this._trading.showSuccessNotification(t,e))},t.prototype.connectionStatusUpdate=function(t,e){this._adapter.connectionStatusUpdate.fire(t,e),1===t&&this._setDefaultDropdownActions()},t.prototype.orderUpdate=function(t){this._adapter.onOrderUpdate(t)},t.prototype.positionUpdate=function(t,e){this._adapter.onPositionUpdate(t,e)},t.prototype.tradeUpdate=function(t,e){this._adapter.onTradeUpdate(t,e)},t.prototype.orderPartialUpdate=function(t,e){this._adapter.onOrderPartialUpdate(t,e)},t.prototype.positionPartialUpdate=function(t,e){this._adapter.onPositionPartialUpdate(t,e)},t.prototype.tradePartialUpdate=function(t,e){this._adapter.onTradePartialUpdate(t,e)},t.prototype.executionUpdate=function(t){
this._adapter.executionUpdate.fire(t)},t.prototype.currentAccountUpdate=function(){this._adapter.onCurrentAccountChanged()},t.prototype.realtimeUpdate=function(t,e){this._adapter.fireSubscription("Realtime",t,e)},t.prototype.domeUpdate=function(t,e){this._adapter.fireSubscription("DOME",t,e)},t.prototype.pipValueUpdate=function(t,e){this._adapter.fireSubscription("PipValue",t,e)},t.prototype.plUpdate=function(t,e){this._adapter.fireSubscription("PL",t,e)},t.prototype.tradePLUpdate=function(t,e){this._adapter.fireSubscription("TradePL",t,e)},t.prototype.equityUpdate=function(t){this._adapter.fireSubscription("Equity","Equity",t)},t.prototype.marginAvailableUpdate=function(t){this._adapter.fireSubscription("MarginAvailable","MarginAvailable",t)},t.prototype.cryptoBalanceUpdate=function(t,e){this._adapter.fireSubscription("CryptoBalance",t,e)},t.prototype.setButtonDropdownActions=function(t){null!==this._trading&&this._defaultDropdownActions&&(this._defaultDropdownActions=!1,Object(n.ensureNotNull)(this.sellBuyButtonsVisibility()).unsubscribe(this._setDefaultDropdownActionsBound),Object(n.ensureNotNull)(this.orderPanelVisibility()).unsubscribe(this._setDefaultDropdownActionsBound),Object(n.ensureNotNull)(this.domPanelVisibility()).unsubscribe(this._setDefaultDropdownActionsBound)),this._buttonDropdownActions=l.convertActionDescriptionsToPopupMenuDescriptions(t)},t.prototype.buttonDropdownActions=function(){return this._buttonDropdownActions},t.prototype.defaultContextMenuActions=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return null!==this._trading?(t=this._trading).defaultContextMenuActions.apply(t,e):Promise.resolve([])},t.prototype.defaultDropdownMenuActions=function(t){return null!==this._trading?this._trading.defaultDropdownMenuActions(t):[]},Object.defineProperty(t.prototype,"factory",{get:function(){return{createDelegate:function(){return new u.a},createWatchedValue:function(t){return new T.a(t)},createPriceFormatter:function(t,e,i,o){return new F.PriceFormatter(t,e,i,o)}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){var t=this;return{save:function(e,i){return j.a.setJSON(t._metainfo.id+"."+e,i)},load:function(e,i){return j.a.getJSON(t._metainfo.id+"."+e,i)},clear:function(e,i){return j.a.remove(t._metainfo.id+"."+e,i)}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"credentialsStorage",{get:function(){var t=this;return{save:function(e,i){return t._credentialsStorage.save(e,i)},load:function(e,i){return t._credentialsStorage.load(e,i)},clear:function(e){return t._credentialsStorage.clear(e)}}},enumerable:!1,configurable:!0}),t.prototype.createMapper=function(t){return{tvToBroker:function(t){return t},brokerToTv:function(t){return t}}},t.prototype.createMapperSync=function(t,e){var i=Promise.resolve();return{ready:function(){return i},tvToBroker:function(t){return t},brokerToTv:function(t){return t}}},t.prototype.convertTimezone=function(t,e,i){var o=I.get_timezone(e),r=I.get_timezone(i),n=I.cal_to_utc(o,t)
;return I.utc_to_cal(r,n)},t.prototype.language=function(){return window.language},t.prototype.getUserSpecificHash=function(){return window.user.private_channel||""},t.prototype.activateFXCMCFD=function(){j.a.setValue("fxcm_cfd",!0)},t.prototype.showDataWarningDialog=function(t,e,i){null!==this._trading&&N.a.show(e,i,(function(e){j.a.setValue(t,e)}))},t.prototype._setDefaultDropdownActions=function(){null!==this._trading&&this._defaultDropdownActions&&(this._buttonDropdownActions=l.convertActionDescriptionsToPopupMenuDescriptions(this.defaultDropdownMenuActions()))},t}(),Q=i("U/Is"),W=i("E9hm");i.d(e,"addBroker",(function(){return K})),i.d(e,"brokersList",(function(){return G})),i.d(e,"createBrokerConnection",(function(){return z}));var H=[];function K(t,e){t.configFlags=Object(W.a)(t.configFlags),H.push({metainfo:t,createBrokerFunction:e})}function G(){return H.map((function(t){return t.metainfo}))}function z(t,e,i){return new Promise((function(o){var r=H.filter((function(t){return t.metainfo.id===e}))[0],n=new x(t,r.metainfo);r.createBrokerFunction(n,(function(e){var s=new Q.a(r.metainfo.id);o(new P(r.metainfo,e,n,s,t&&t.tradingStat(),i))}))}))}},N8pX:function(t,e,i){t.exports={wrapper:"wrapper-5xpFx6a0",column:"column-3kQxstaD",button:"button-38v414pK",sellButton:"sellButton-10BFFA8V",buyButton:"buyButton-2iXIWbwn",highButtons:"highButtons-3LT7iDtG",withoutBg:"withoutBg-1-yXoW7u",lastCharSup:"lastCharSup-s7mvzQye",spreadQtyWrapper:"spreadQtyWrapper-2JNciA9_",spread:"spread-1n3Ytru8",withoutQty:"withoutQty-3QBZGJie",qty:"qty-10Yvbssx",loader:"loader-wlUaa8hg",loading:"loading-FjlaozRw",buttonText:"buttonText-1vopxN9j",touchMode:"touchMode-akjMUe2p",buttons:"buttons-3NsbIAqS"}},QBLL:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));i("HbRj"),i("YFKU");var o=i("hHwE"),r={get:function(){return this},open:function(t){var e=window.t("Cancel Bracket"),i="<p>"+window.t("Are you sure you want to cancel {0}bracket?").format(t?t+" ":"")+"</p>";return Object(o.a)(e,i)},multiple:function(t){var e=window.t("Cancel Brackets"),i="<p>"+window.t("Are you sure you want to cancel {0}brackets?").format(t?t+" ":"")+"</p>";return Object(o.a)(e,i)}}},X8qL:function(t,e,i){},fBig:function(t,e,i){t.exports={loader:"loader-1ON1rkY9",loaderItem:"loaderItem-6asdclOe","loader-animation":"loader-animation-1vbmOmyN",shown:"shown-1QFCxvPl",touchMode:"touchMode-I-CBM3V3"}},hHwE:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i("HbRj"),i("YFKU");function o(t,e,o,r){return new Promise((function(n,s){Promise.all([i.e(40),i.e("dialogs-core"),i.e(49),i.e(36),i.e("create-dialog")]).then(function(s){var a=(0,i("YDhE").createDialog)({title:t,content:e,width:500,type:"modal",closeOnOutsideClick:!1,draggable:!1,destroyOnClose:!0,addClass:"tv-text",actions:[{name:"no",text:r||window.t("No"),type:"default",method:"close"},{name:"yes",text:o||window.t("Yes"),type:"primary",method:"close",key:13}]});a.on("action:yes",(function(){n(!0)})),a.on("destroy",(function(){n(!1)})),a.open(),a.setZIndex(200)}.bind(null,i)).catch(i.oe)}))}},
"pJ/4":function(t,e,i){"use strict";var o=i("OekH"),r=o.CONNECTSTATUSES,n=o.SIDE,s=o.ORDERTYPE,a=o.ORDERSTATUS,c=o.TICKETFOCUS,u=o.PARENTTYPE,l=i("kcTO").PriceFormatter,d=i("cUJV").QuantityFormatter,h=i("7KDR").Action,p=i("4qhP"),_=i("txPx").getLogger("Trading.ChartWidgetController"),f=i("Ialn"),b=i("Eyy1").ensureNotNull,y=i("8Wzo").StopType;var m=function(t,e){this._chartModel=t,this._trading=e,this._trading.onConnectionStatusChange.subscribe(this,this.onStatusChanged),this._formatter=new l,this._quantityFormatter=new d,this._ordersInModify={},this._tradesMode=!1,this._ordersMap={};var i=t.mainSeries();i.dataEvents().symbolResolved().subscribe(this,this.onSymbolChanged),i.dataEvents().symbolError().subscribe(this,this.onSymbolChanged),this.onStatusChanged(),this.onSymbolChanged()};m.prototype.destroy=function(){this.reset(),this._trading.onConnectionStatusChange.unsubscribe(this,this.onStatusChanged);var t=this._chartModel.mainSeries();t.dataEvents().symbolResolved().unsubscribe(this,this.onSymbolChanged),t.dataEvents().symbolError().unsubscribe(this,this.onSymbolChanged)},m.prototype.paneViews=function(t){return[]},m.prototype.labelPaneViews=function(t){return[]},m.prototype.priceAxisViews=function(t,e){return[]},m.prototype.priceScale=function(){return null},m.prototype.updateAllViews=function(){},m.prototype.broker=function(){return this._trading.activeBroker()},m.prototype.removeObjects=function(){for(var t in this._orders)this._orders[t].mainTool._adapter.remove(),this._orders[t].addTool&&this._orders[t].addTool._adapter.remove();this._orders={},this._positions={}},m.prototype.updateAllWhenLoaded=function(){this._scheduledUpdate||(this._chartModel.mainSeries().data().isEmpty()?(this._scheduledUpdate=!0,this._chartModel.mainSeries().dataEvents().completed().subscribe(this,this.updateAll,!0)):this.updateAll())},m.prototype.updateAll=function(){var t=this;(this.removeObjects(),this._scheduledUpdate=!1,this._symbol)&&(this._broker&&this._broker.connectionStatus()===r.CONNECTED&&((this._tradesMode?this._broker.trades(this._symbol):this._broker.positions(this._symbol)).then((function(e){e.forEach((function(e){t.onPositionUpdate(e)}))})),this._broker.orders(this._symbol).then((function(e){e.forEach((function(e){t._ordersMap[e.id]=e})),e.forEach((function(e){t.onOrderUpdate(e)}))}))))},m.prototype.onSymbolChanged=function(t){this._symbol=void 0!==t?t.pro_name||t.full_name:this._chartModel.mainSeries().proSymbol(),this._updateAll()},m.prototype._updateAll=function(){this.removeObjects(),this._symbol&&this._broker&&this._broker.connectionStatus()===r.CONNECTED&&(this.updateAllWhenLoaded(),this.updateFormatters())},m.prototype._computeTradesMode=function(){if(!this._broker)return!1;var t=this._broker.metainfo().configFlags;return!!t.supportTrades&&(!t.supportPositionBrackets&&!!t.supportCloseTrade)},m.prototype.updateFormatters=function(){if(this._symbol&&this._broker){var t=this,e=this._broker.formatter(this._symbol),i=this._broker.quantityFormatter(this._symbol);Promise.all([e,i]).then((function(e){t._formatter=e[0],
t._quantityFormatter=e[1],t.updateAllWhenLoaded()}))}},m.prototype.onStatusChanged=function(){var t=this._trading.activeBroker()&&this._trading.activeBroker().connectionStatus()===r.CONNECTED;this._broker===this._trading.activeBroker()&&t||(this._broker&&this.reset(),t&&(this._broker=this._trading.activeBroker(),this._broker.currentAccountUpdate.subscribe(this,this._updateAll),this._tradesMode=this._computeTradesMode(),this._tradesMode?this._broker.tradeUpdate.subscribe(this,m.prototype.onPositionUpdate):this._broker.positionUpdate.subscribe(this,m.prototype.onPositionUpdate),this._broker.orderUpdate.subscribe(this,m.prototype.onOrderUpdate),this.updateFormatters(),this._updateAll()))},m.prototype.reset=function(){this.removeObjects(),this._broker&&(this._broker.currentAccountUpdate.unsubscribe(this,this._updateAll),this._tradesMode?this._broker.tradeUpdate.unsubscribe(this,m.prototype.onPositionUpdate):this._broker.positionUpdate.unsubscribe(this,m.prototype.onPositionUpdate),this._broker.orderUpdate.unsubscribe(this,m.prototype.onOrderUpdate)),this._broker=null,this._formatter=new l},m.prototype.redraw=function(){var t=this._chartModel,e=t.paneForSource(t.mainSeries());t.updatePane(e)},m.prototype.profitState=function(t){var e=Math.round(100*t)/100;return e>0?"positive":e<0?"negative":"neutral"},m.prototype.onPositionUpdate=function(t){if(t.symbol===this._symbol){var e=t.id;this._positions[e]&&!t.qty&&delete this._positions[e],_.logDebug("TRADING. Update position. Symbol:"+t.symbol+" , qty:"+t.qty),t.qty&&(this._positions[e]||(this._positions[e]=t),this.redraw())}},m.prototype.sideToText=p.sideToText,m.prototype.orderText=function(t){if(t.parentId){var e=this._ordersMap[t.parentId];if(t.parentType!==u.ORDER||e&&function(t,e){if(t.side===e.side)return!1;var i=t.limitPrice||t.stopPrice,o=e.limitPrice||e.stopPrice;if(t.side===n.BUY){if(e.type===s.LIMIT&&o<i||e.type===s.STOP&&o>i)return!1}else if(e.type===s.LIMIT&&o>i||e.type===s.STOP&&o<i)return!1;return!0}(e,t)){if(t.type===s.STOP)return t.stopType===y.TrailingStop?$.t("TRAILING STOP"):$.t("STOP LOSS");if(t.type===s.LIMIT)return $.t("TAKE PROFIT")}}return(this.sideToText(t.side)+" "+p.orderTypeToText(t.type)).toUpperCase()},m.prototype.getNestedOrders=function(t){return this._broker.orders().then((function(e){var i=e.find((function(e){return e.id===t}));if(void 0===i)return[];if(i.parentId){var o=e.find((function(t){return t.id===i.parentId}));return e.filter((function(t){return t.parentId===i.parentId})).concat(o)}return e.filter((function(t){return t.parentId===i.id})).concat(i)})).then((function(t){return t.filter(Boolean).map((function(t){return t.id}))}))},m.prototype._performNestedOrdersOperation=function(t,e){this.getNestedOrders(t).then(function(t){t.forEach((function(t){this._orders[t]&&(this._orders[t].mainTool._adapter[e](),this._orders[t].addTool&&this._orders[t].addTool._adapter[e]())}),this)}.bind(this))},m.prototype.blockNestedOrders=function(t){this._performNestedOrdersOperation(t,"block")},m.prototype.unblockNestedOrders=function(t){
this._performNestedOrdersOperation(t,"unblock")},m.prototype.onOrderUpdate=function(t){if(this._ordersMap[t.id]=t,this._ordersInModify[t.id])this._ordersInModify[t.id]=t;else if(t.symbol===this._symbol&&t.type!==s.MARKET){var e=this,i=t.id,o="Chart Order";if(t.status!==a.WORKING&&t.status!==a.INACTIVE)this._orders[i]&&(this._orders[i].mainTool._adapter.remove(),this._orders[i].addTool&&this._orders[i].addTool._adapter.remove(),delete this._orders[i]);else{var r=0;switch(t.type){case s.LIMIT:r=t.limitPrice;break;default:r=t.stopPrice}if(!this._orders[i]){var l=this._chartModel,d=l.paneForSource(l.mainSeries());isNumber(r)||_.logError("order price is not defined");var p=l.createLineTool(d,{price:r,index:0},"LineToolOrder");if(this._orders[i]={mainTool:p},t.type===s.STOPLIMIT){var m=t.limitPrice,g=l.createLineTool(d,{price:m,index:0},"LineToolOrder");this._orders[i].addTool=g}}this._orders[i].addTool&&t.type!==s.STOPLIMIT&&(this._orders[i].mainTool._adapter.remove(),this._orders[i].mainTool=this._orders[i].addTool,delete this._orders[i].addTool);var v=function(i,o,r){if(i.parentId&&i.stopType===y.TrailingStop){var a,l=e._ordersMap[i.parentId]||e._positions[i.parentId];Promise.all([e.broker().symbolInfo(e._symbol),e.broker().quotesSnapshot(e._symbol)]).then((function(t){var e=t[0],o=t[1];a=i.parentType!==u.ORDER?l.side===n.BUY?o.bid:o.ask:l.type===s.STOP?l.stopPrice:l.limitPrice,i.trailingStopPips=((i.stopPrice||i.limitPrice)-a)/e.pipSize*(l.side===n.BUY?-1:1)}))}r=r||{};e._ordersInModify[t.id]=t,e.blockNestedOrders(i.id);var d=null;t.type!==s.STOPLIMIT||r.limitPrice||(d=c.STOPPRICE),t.type!==s.STOPLIMIT||r.stopPrice||(d=c.LIMITPRICE),b(e._trading.brokerCommandsUI()).modifyOrder(i,r.silent,d).catch((function(){})).then((function(){if(!1===e._orders.hasOwnProperty(i.id))e.redraw(),delete e._ordersInModify[t.id];else{e.unblockNestedOrders(i.id);var o=e._ordersInModify[t.id];delete e._ordersInModify[t.id],e.onOrderUpdate(o)}}))};if(this._orders[i]){var k=this._orders[i].mainTool._adapter,w=t.status!==a.WORKING,P=t.stopType!==y.TrailingStop||e._trading.activeBroker().metainfo().configFlags.supportTrailingStop;if(k.setPrice(r).setText(this.orderText(t)).setMode(t.type===s.LIMIT?"limit":t.type===s.STOP?"stop":"").setActive(!w).setDirection(t.side===n.BUY?"buy":"sell").setQuantity(f.forceLTRStr(this._quantityFormatter.format(t.qty-(t.filledQty||0)))).setEditable(P).setCancellable(!0).onContextMenu((function(){var i=[];if(e._trading.activeBroker().metainfo().configFlags.supportModifyOrder){var o=new h({label:window.t("Modify Order..."),onExecute:function(){e._trading.trackEvent("Chart Order Context Menu","Edit Order"),v(t)}});i.push(o)}var r=new h({label:window.t("Cancel Order"),onExecute:function(){e._trading.trackEvent("Chart Order Context Menu","Cancel Order"),b(e._trading.brokerCommandsUI()).cancelOrder(t.id)}});return i.push(r),i})).onCancel((function(){e._trading.trackEvent(o,"Cancel Order"),b(e._trading.brokerCommandsUI()).cancelOrder(t.id)})),
this._trading.activeBroker().metainfo().configFlags.supportModifyOrder&&(k.onModify((function(){e._trading.trackEvent(o,"Edit Order"),v(t)})),k.onMove((function(i){e._trading.trackEvent(o,"Move Order");var r=TradingView.clone(t),n=k.getPrice();r.stopPrice?r.stopPrice=n:r.limitPrice&&(r.limitPrice=n),v(r,0,{silent:!0,stopPrice:Boolean(r.stopPrice)})}))),this._orders[i].addTool){m=t.limitPrice;var O=this._orders[i].addTool._adapter;O.setPrice(m).setQuantity(t.qty).setEditable(!0).setCancellable(!0).setText(this.orderText(t)).setMode(t.type===s.LIMIT?"limit":t.type===s.STOP?"stop":"").setActive(!0).setDirection(t.side===n.BUY?"buy":"sell").setQuantity(t.qty),this._trading.activeBroker().metainfo().configFlags.supportModifyOrder&&(O.onModify((function(){e._trading.trackEvent(o,"Edit Order"),v(t,0,{limitPrice:!0})})),O.onMove((function(){e._trading.trackEvent(o,"Move Order");var i=TradingView.clone(t);i.limitPrice=O.getPrice(),v(i,0,{silent:!0,limitPrice:!0})})))}}}}},t.exports=m},qBrV:function(t,e,i){"use strict";function o(t,e){null===t.firstChild?t.textContent=e:t.firstChild.nodeValue=e}i.d(e,"a",(function(){return o}))},vOQ2:function(t,e,i){"use strict";var o;i.d(e,"d",(function(){return o})),i.d(e,"a",(function(){return r})),i.d(e,"c",(function(){return n})),i.d(e,"b",(function(){return s})),function(t){t.DomPanel="domPanel",t.OrderPanel="orderPanel"}(o||(o={}));var r=400,n=296,s=451}}]);