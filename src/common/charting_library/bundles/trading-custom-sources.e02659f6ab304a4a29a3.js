(window.webpackJsonp=window.webpackJsonp||[]).push([["trading-custom-sources"],{"//HS":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i("jFln");function o(t,e,i,o,n,r,a){t.save(),t.strokeStyle=o;var c=t.lineWidth%2?.5:0;t.translate(e+c,i+c),n&&t.rotate(Math.PI),s.drawArrow(t,0,0,0,r,a),t.restore()}},EgV8:function(t,e,i){"use strict";i.r(e);var s=i("Kxc7"),o=i("Eyy1"),n=i("Y7w9"),r=i("XPit"),a=i("k9/m"),c=i("ogJP"),h=i("VdBB"),u=i("//HS"),l=function(){function t(){this._data={points:[],arrowHeight:0}}return t.prototype.setData=function(t){this._data=t},t.prototype.hitTest=function(t){for(var e=0,i=this._data.points;e<i.length;e++){var s=i[e],o=Math.round(s.x),n=Math.round(s.y),r=void 0,a=void 0;if(s.arrowUp?(r=n,a=n+this._data.arrowHeight):(r=n-this._data.arrowHeight,a=n),t.x>=o-2&&t.x<=o+2&&t.y>=r&&t.y<=a&&""!==s.tooltip)return new h.HitTestResult(h.HitTestResult.CUSTOM,{tooltip:{text:s.tooltip,rect:{x:o,y:r,w:2,h:a-r}}})}return null},t.prototype.draw=function(t,e){var i=e.pixelRatio;t.save(),t.lineWidth=Math.max(1,Math.floor(t.lineWidth*i));for(var s=Math.round(this._data.arrowHeight*i),o=Math.round(2*i),n=0,r=this._data.points;n<r.length;n++){var a=r[n],c=Math.round(a.x*i),h=Math.round(a.y*i);Object(u.a)(t,c,h,a.arrowColor,!a.arrowUp,s,o)}t.restore()},t}(),d={x:void 0,arrowUp:{y:void 0,color:"#4094e8"},arrowDown:{y:void 0,color:"#e75656"}},_=function(){function t(t,e){this._invalidated=!0,this._points=[],this._renderer=new l,this._chartModel=t,this._source=e}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer},t.prototype._updateImpl=function(){this._points=[],this._renderer.setData({points:[],arrowHeight:0});var t=this._chartModel.timeScale().visibleBarsStrictRange();if(null!==t){var e=this._source.points();if(0!==e.length){var i=Object(n.lowerbound)(e,t.firstBar(),(function(t,e){return t.index<e}),0),s=Object(n.upperbound)(e,t.lastBar(),(function(t,e){return e.index>t}),i);if(!(i>=s)){for(var r=new Map,a=i;a<s;a++){var h=e[a],u=r.get(h.index)||Object(c.clone)(d);if(void 0===u.x){var l=this._getXCoordinate(h.index);if(null===l)continue;u.x=l}var _=h.isBuyDirection?"arrowUp":"arrowDown",p=h.isBuyDirection?1:-1,f=u[_].y;if(void 0===f){var b=this._getYCoordinate(h.index,h.isBuyDirection);if(null===b)continue;u[_].y=b+11*p}else u[_].y=f+19*p;r.set(h.index,u),this._points.push({x:Object(o.ensureDefined)(u.x),y:Object(o.ensureDefined)(u[_].y),arrowUp:h.isBuyDirection,arrowColor:u[_].color,tooltip:h.tooltip})}this._renderer.setData({points:this._points,arrowHeight:8})}}}},t.prototype._getXCoordinate=function(t){var e=this._chartModel.mainSeries().bars().lastIndex();return null===e||t>e?null:this._chartModel.timeScale().indexToCoordinate(t)},t.prototype._getYCoordinate=function(t,e){var i=null,s=this._chartModel.mainSeries(),o=s.priceSource(),n=null!==o?o:e?"low":"high",c=Object(r.barFunction)(n),h=s.nearestData(t,a.PlotRowSearchMode.NearestLeft);if(void 0!==h){var u=c(h.value)
;if(!Number.isNaN(u)){var l=s.firstValue();null!==l&&(i=this._chartModel.mainSeries().priceScale().priceToCoordinate(u,l))}}return i},t}();i.d(e,"ExecutionsSource",(function(){return p}));var p=function(){function t(t,e,i,s){this._paneViews=[],this._executionsPointsManager=s,this._executionsPointsManager.existingPointsChanged().subscribe(this,this.updateAllViews),this._showExecutions=i,this._paneViews.push(new _(t,this))}return t.prototype.destroy=function(){this._executionsPointsManager.existingPointsChanged().unsubscribeAll(this),this._executionsPointsManager.destroy(),this._showExecutions.destroy()},t.prototype.points=function(){return this._executionsPointsManager.existingPoints()},t.prototype.updateAllViews=function(){if(this._showExecutions.value())for(var t=0,e=this._paneViews;t<e.length;t++){e[t].update()}},t.prototype.paneViews=function(t){return t.containsMainSeries()?window.TradingView.printing&&!s.enabled("snapshot_trading_drawings")?[]:this._showExecutions.value()?this._paneViews:[]:[]},t.prototype.labelPaneViews=function(t){return[]},t.prototype.priceScale=function(){return null},t.prototype.priceAxisViews=function(t,e){return[]},t}()},J1Ip:function(t,e,i){"use strict";i.r(e);var s=i("Eyy1"),o=i("QfUd"),n=i("GOhO"),r=i("mrSG"),a=i("kcTO"),c=i("Kxc7"),h=i("Cf1E"),u=i("txPx"),l=i("9XXR"),d=i("Ialn"),_=i("aO4+"),p=i("VdBB"),f=i("u+0B"),b=i("ikwP"),y=i("gAom"),v=i("jFln"),x=i("XlJ7"),m=i("//HS");function w(t,e,i,s,o,n,r,a,c,h){void 0===c&&(c=!1),void 0===h&&(h=!1),t.save(),t.fillStyle=r,t.fillRect(e,i,s,o),t.fillStyle=a,t.fillRect(e,i,s,n),t.fillRect(e,i+o-n,s,n),c||t.fillRect(e,i,n,o),h||t.fillRect(e+s-n,i,n,o),t.restore()}function P(t,e,i,s,o,n,r,a){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=r,t.font=a,t.fillText(e,i+o/2,s+n/2),t.restore()}var g=window.t("Protect Position..."),S=window.t("Reverse Position"),C=window.t("Close Position");var O=function(){function t(){this._textWidthCache=new f.TextWidthCache,this._cache={top:0,bottom:0,left:0,right:0,bodyRight:0,quantityRight:0,reverseButtonRight:0},this._data=null,this._font=null,this._height=null,this._prevPixelRatio=null}return t.prototype.setData=function(t){var e=null!==this._data&&this._data.fontSize||null;this._data=t,null!==this._data&&e!==this._data.fontSize&&this._resetHeightAndTextCache()},t.prototype.hitTest=function(t){if(null===this._data)return null;if(t.y<this._cache.top||t.y>this._cache.bottom||t.x<this._cache.left||this._cache.right<t.x)return null;if(this._data.disabled)return new p.HitTestResult(p.HitTestResult.CUSTOM,{});var e=this._data.callbacks.onContextMenu;return t.x>=this._cache.bodyRight&&t.x<this._cache.quantityRight&&void 0!==this._data.callbacks.onModify?new p.HitTestResult(p.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:e,clickHandler:this._data.callbacks.onModify,tapHandler:this._data.callbacks.onModify,tooltip:{text:g,rect:{x:this._cache.bodyRight,y:this._cache.top,w:this._cache.quantityRight-this._cache.bodyRight,h:this._cache.bottom-this._cache.top}}
}):t.x>=this._cache.quantityRight&&t.x<this._cache.reverseButtonRight&&void 0!==this._data.callbacks.onReverse?new p.HitTestResult(p.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:e,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:S,rect:{x:this._cache.quantityRight,y:this._cache.top,w:this._cache.reverseButtonRight-this._cache.quantityRight,h:this._cache.bottom-this._cache.top}}}):t.x>=this._cache.reverseButtonRight&&t.x<this._cache.right&&void 0!==this._data.callbacks.onClose?new p.HitTestResult(p.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:e,clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{text:C,rect:{x:this._cache.reverseButtonRight,y:this._cache.top,w:this._cache.right-this._cache.reverseButtonRight,h:this._cache.bottom-this._cache.top}}}):(t.y>=this._cache.top||t.y<=this._cache.bottom||t.x>=this._cache.left||t.x<=this._cache.right)&&this._data.callbacks.onContextMenu?new p.HitTestResult(p.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:e}):null},t.prototype.draw=function(t,e){if(null!==this._data){var i,s=e.pixelRatio;this._prevPixelRatio!==s&&(this._resetHeightAndTextCache(),this._prevPixelRatio=s),null===this._height&&(this._font=Object(x.makeFont)(this._data.fontSize,"Verdana","","bold"),this._height=(i=this._data.fontSize,Math.max(22,1+i+10)));var o=Math.ceil(this._height/2);if(!(this._data.y<-o||this._data.y>e.cssHeight+o)){var n=this._bodyWidth(t),r=this._quantityWidth(t),a=this._data.callbacks.onReverse?this._height:0,c=this._data.callbacks.onClose?this._height:0,h=n+r+a+c,u=e.cssWidth-h,l=Math.max(this._data.line.width/100*e.cssWidth,1);this._cache.top=this._data.y-o,this._cache.bottom=this._cache.top+this._height,this._cache.right=Math.round(e.cssWidth-Math.min(u,l)),this._cache.left=this._cache.right-h,this._cache.bodyRight=this._cache.left+n,this._cache.quantityRight=this._cache.bodyRight+r,this._cache.reverseButtonRight=this._cache.quantityRight+a;var d=Math.round(this._data.y*s),_=Math.round(this._cache.top*s),p=Math.round(this._cache.right*s),f=Math.round(this._cache.left*s),b=Math.round(this._height*s),y=Math.max(1,Math.floor(1*s));this._drawLines(t,s,f,p,d,Math.ceil(e.physicalWidth));var v=Math.round(n*s);0!==n&&(this._drawBody(t,f,_,v,b,y),this._drawBodyText(t,s,this._cache.left,this._cache.top,n,this._height));var m=Math.round(r*s),w=f+v;0!==r&&(this._drawQuantity(t,w,_,m,b,y),this._drawQuantityText(t,s,this._cache.bodyRight,this._cache.top,r,this._height));var P=Math.round(a*s),g=w+m;0!==a&&this._drawReverseButton(t,s,g,_,P,b,y);var S=g+P;if(0!==c){var C=Math.round(c*s);this._drawCloseButton(t,s,S,_,C,b,y)}}}},t.prototype._drawLines=function(t,e,i,o,n,r){var a=Object(s.ensureNotNull)(this._data).line;t.save(),t.strokeStyle=a.color,t.lineWidth=Math.max(1,Math.floor(a.thickness*e)),Object(v.setLineStyle)(t,a.style),Object(y.drawHorizontalLine)(t,n,o,r),a.extend&&Object(y.drawHorizontalLine)(t,n,0,i),t.restore()},
t.prototype._drawBody=function(t,e,i,o,n,r){var a=Object(s.ensureNotNull)(this._data).body;w(t,e,i,o,n,r,a.backgroundColor,a.borderColor,!1,!0)},t.prototype._drawBodyText=function(t,e,i,o,n,r){var a=this,c=Object(s.ensureNotNull)(this._data).body;Object(b.drawScaled)(t,e,(function(){return P(t,c.text,i,o,n,r,c.textColor,Object(s.ensureNotNull)(a._font))}))},t.prototype._drawQuantity=function(t,e,i,o,n,r){var a=Object(s.ensureNotNull)(this._data).qty;w(t,e,i,o,n,r,a.backgroundColor,a.borderColor)},t.prototype._drawQuantityText=function(t,e,i,o,n,r){var a=this,c=Object(s.ensureNotNull)(this._data).qty;Object(b.drawScaled)(t,e,(function(){return P(t,c.text,i,o,n,r,c.textColor,Object(s.ensureNotNull)(a._font))}))},t.prototype._drawReverseButton=function(t,e,i,o,n,r,a){var c=Object(s.ensureNotNull)(this._data).reverseButton;t.save(),w(t,i,o,n,r,a,c.backgroundColor,c.borderColor,!0),t.save();var h=Math.round(2*e),u=Math.round(10*e),l=Math.round(i+(n-6*e)/2),d=Math.round(l+6*e),_=Math.round(o+6*e),p=_+u,f=c.iconColor;t.lineWidth=a,Object(m.a)(t,l,_,f,!1,u,h),Object(m.a)(t,d,p,f,!0,u,h),t.restore(),this._drawDisabledArea(t,i,o,n,r,a),t.restore()},t.prototype._drawCloseButton=function(t,e,i,o,n,r,a){var c=Object(s.ensureNotNull)(this._data).closeButton;t.save(),w(t,i,o,n,r,a,c.backgroundColor,c.borderColor,!0),t.save(),t.lineWidth=a,t.strokeStyle=c.iconColor;var h=i+n,u=o+r,l=Math.round((n-8*e)/2),d=Math.round((r-8*e)/2);Object(v.drawPoly)(t,[new _.Point(i+l,o+d),new _.Point(h-l,u-d)],!0),Object(v.drawPoly)(t,[new _.Point(h-l,o+d),new _.Point(i+l,u-d)],!0),t.restore(),this._drawDisabledArea(t,i,o,n,r,a),t.restore()},t.prototype._drawDisabledArea=function(t,e,i,o,n,r){Object(s.ensureNotNull)(this._data).disabled&&(t.fillStyle="rgba(140, 140, 140, 0.75)",t.fillRect(e,i+r,o-r,n-2*r))},t.prototype._bodyWidth=function(t){var e=Object(s.ensureNotNull)(this._data);t.save(),t.font=Object(s.ensureNotNull)(this._font);var i=Math.ceil(this._textWidthCache.measureText(t,e.body.text));return t.restore(),Math.round(10+i)},t.prototype._quantityWidth=function(t){var e=Object(s.ensureNotNull)(this._data);t.save(),t.font=Object(s.ensureNotNull)(this._font);var i=Math.ceil(this._textWidthCache.measureText(t,e.qty.text));return t.restore(),Math.round(Math.max(Object(s.ensureNotNull)(this._height),10+i))},t.prototype._resetHeightAndTextCache=function(){this._font=null,this._height=null,this._textWidthCache.reset()},t}();var M=function(){function t(t,e){this._invalidated=!0,this._renderer=new O,this._chartModel=t,this._source=e}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer},t.prototype._updateImpl=function(){this._renderer.setData(null);var t=this._chartModel.mainSeries(),e=t.firstValue();if(null!==e){var i=this._source.price();if(null!==i){var s,o,n,r=t.priceScale().priceToCoordinate(i,e),a=this._source.isBuyDirection()?"rgb(64,148, 232)":"rgb(231, 86, 86)",c={}
;this._source.supportReverse()&&(c.onReverse=this._source.onReverse.bind(this._source)),this._source.supportClose()&&(c.onClose=this._source.onClose.bind(this._source)),this._source.supportModify()&&(c.onModify=this._source.onModify.bind(this._source)),this._source.hasContextMenu()&&(c.onContextMenu=this._source.onContextMenu.bind(this._source)),this._renderer.setData({y:r,disabled:this._source.isBlocked(),callbacks:c,line:{thickness:this._source.lineWidth(),width:this._source.lineLength(),style:this._source.lineStyle(),color:a,extend:this._source.isLineExtended()},body:{text:(n=this._source.pl(),null===n?"position":Object(d.startWithLTR)(Object(l.splitThousands)((Math.round(100*n)/100||0).toFixed(2)," "))),textColor:(o=this._source.profitState(),"neutral"===o?"rgb(100, 100, 100)":"negative"===o?"rgb(231, 86, 86)":"rgb(38, 140, 2)"),borderColor:a,backgroundColor:"rgba(255, 255, 255, 0.75)"},qty:{text:(s=this._source.qty(),null===s?"0":Object(l.splitThousands)(s," ")),textColor:"rgba(255, 255, 255, 1)",borderColor:a,backgroundColor:a},reverseButton:{borderColor:a,backgroundColor:"rgba(255, 255, 255, 0.75)",iconColor:a},closeButton:{borderColor:a,backgroundColor:"rgba(255, 255, 255, 0.75)",iconColor:a},fontSize:9})}}},t}(),k=i("KcY8"),A=i("Tmoa"),E=function(t){function e(e,i){var s=t.call(this)||this;return s._model=e,s._source=i,s}return Object(r.__extends)(e,t),e.prototype._updateRendererData=function(t,e,i){if(t.visible=!1,this._source.showProperty().value()){var s=this._model.mainSeries(),o=s.priceScale(),n=s.firstValue();if(null!==n){var r=this._source.price();if(null!==r){var a=this._source.isBuyDirection()?"rgb(64,148, 232)":"rgb(231, 86, 86)";i.background=a,i.borderColor=a,i.color=Object(A.colorFromBackground)(a),i.coordinate=o.priceToCoordinate(r,n),t.text=this._formatPrice(r),t.visible=!0}}}},e.prototype._formatPrice=function(t){return this._source.formatter().format(t)},e}(k.a),j=Object(u.getLogger)("Trading.Positions"),T=function(){function t(t,e,i,s,o){this._paneViews=[],this._priceAxisViews=[],this._formatter=new a.PriceFormatter,this._data=null,this._isBlocked=!1,this._isActualSymbol=!1,this._model=t,this._mainSeries=t.mainSeries(),this._showPositions=e,this._lineProperties=i,this._callbacks=o,this._positionDataSpawn=s.spawn(),this._positionDataSpawn.subscribe(this._updateData.bind(this),{callWithLast:!0}),this._paneViews.push(new M(t,this)),this._priceAxisViews.push(new E(t,this));var n=this._mainSeries.dataEvents();n.symbolResolved().subscribe(this,this._updateActualSymbolAndFormatter),n.symbolError().subscribe(this,this._updateActualSymbolAndFormatter),this._updateActualSymbolAndFormatter()}return t.prototype.destroy=function(){this._showPositions.destroy(),this._positionDataSpawn.destroy();var t=this._mainSeries.dataEvents();t.symbolResolved().unsubscribeAll(this),t.symbolError().unsubscribeAll(this)},t.prototype.price=function(){return Object(s.ensureNotNull)(this._data).price},t.prototype.qty=function(){return Object(s.ensureNotNull)(this._data).qtyBySide},t.prototype.formatter=function(){
return this._formatter},t.prototype.showProperty=function(){return this._showPositions},t.prototype.lineWidth=function(){return this._lineProperties.width.value()},t.prototype.lineLength=function(){return this._lineProperties.length.value()},t.prototype.lineStyle=function(){return this._lineProperties.style.value()},t.prototype.isLineExtended=function(){return this._lineProperties.extend.value()},t.prototype.isBuyDirection=function(){return 1===Object(s.ensureNotNull)(this._data).side},t.prototype.isBlocked=function(){return this._isBlocked},t.prototype.supportReverse=function(){return Object(s.ensureNotNull)(this._data).supportReverse},t.prototype.onReverse=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("reversePosition",!0)];case 1:return t.sent(),[2]}}))}))},t.prototype.supportClose=function(){return Object(s.ensureNotNull)(this._data).supportClose},t.prototype.onClose=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("closePosition",!0)];case 1:return t.sent(),[2]}}))}))},t.prototype.supportModify=function(){return Object(s.ensureNotNull)(this._data).supportBrackets},t.prototype.onModify=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("modifyPosition",!1)];case 1:return t.sent(),[2]}}))}))},t.prototype.hasContextMenu=function(){return this.supportModify()||this.supportClose()||this.supportClose()},t.prototype.onContextMenu=function(t){if(null!==this._data){var e={};this.supportClose()&&(e.closePosition=this._callbacks.closePosition),this.supportReverse()&&(e.reversePosition=this._callbacks.reversePosition),this.supportModify()&&(e.modifyPosition=this._callbacks.modifyPosition),Object(s.ensureDefined)(this._callbacks.showContextMenu)(this._data.id,e,t)}},t.prototype.pl=function(){return Object(s.ensureNotNull)(this._data).pl},t.prototype.profitState=function(){return Object(s.ensureNotNull)(this._data).profitState},t.prototype.priceScale=function(){return this._mainSeries.priceScale()},t.prototype.updateAllViews=function(){if(this._showPositions.value()){for(var t=0,e=this._paneViews;t<e.length;t++){e[t].update()}for(var i=0,s=this._priceAxisViews;i<s.length;i++){s[i].update()}}},t.prototype.paneViews=function(t){return this._isPositionShouldBeShown(t)?this._paneViews:[]},t.prototype.labelPaneViews=function(t){return[]},t.prototype.priceAxisViews=function(t,e){return this._isPositionShouldBeShown(t)?this._priceAxisViews:[]},t.prototype._isPositionShouldBeShown=function(t){return!!this._isActualSymbol&&(!!t.containsMainSeries()&&(!(window.TradingView.printing&&!c.enabled("snapshot_trading_drawings"))&&this._showPositions.value()))},t.prototype._doActionWithBlock=function(t,e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i
;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:if(void 0===this._callbacks[t]||null===this._data)return[2];e&&this._setIsBlocked(!0),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,Object(s.ensureDefined)(this._callbacks[t])("Chart Position",this._data.id)];case 2:return o.sent(),[3,5];case 3:return i=o.sent(),j.logWarn("Try to "+t+", but got error: "+Object(h.a)(i)),[3,5];case 4:return e&&this._setIsBlocked(!1),[7];case 5:return[2]}}))}))},t.prototype._updateData=function(t){this._data=t,this.updateAllViews()},t.prototype._updateActualSymbolAndFormatter=function(){var t=this._mainSeries.symbolInfo();null===t?(this._isActualSymbol=!1,this._formatter=new a.PriceFormatter(100,1,!1)):(this._isActualSymbol=this._mainSeries.symbolSameAsCurrent(Object(s.ensureNotNull)(this._data).symbol),this._formatter=new a.PriceFormatter(t.pricescale,t.fractional?t.minmov:1,t.fractional,t.minmove2)),this.updateAllViews()},t.prototype._setIsBlocked=function(t){this._isBlocked=t,this.updateAllViews(),this._model.updateSource(this)},t}();function R(t,e,i,s){t.addCustomSource("position"+e,(function(t){var e=t.properties().childs().tradingProperties.childs(),o=Object(n.b)(t.isInReplay.bind(t),t.onInReplayStateChanged()),r=Object(n.a)((function(t,e){return e}),o,e.showPositions),a={width:e.lineWidth,length:e.lineLength,style:e.lineStyle,extend:e.extendLeft};return new T(t,r,a,i,s)}))}var V=i("ogJP"),B=i("7KDR"),N=i("5VQP");function D(t,e,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o;return Object(r.__generator)(this,(function(n){return o=function(t,e){var i=[];void 0!==e.modifyPosition&&i.push(new B.Action({label:H,statName:"Modify Position",onExecute:function(){return Object(s.ensureDefined)(e.modifyPosition)("Chart Position Context Menu",t)}}));void 0!==e.closePosition&&i.push(new B.Action({label:F,statName:"Close Position",onExecute:function(){return Object(s.ensureDefined)(e.closePosition)("Chart Position Context Menu",t)}}));void 0!==e.reversePosition&&i.push(new B.Action({label:L,statName:"Reverse Position",onExecute:function(){return Object(s.ensureDefined)(e.reversePosition)("Chart Position Context Menu",t)}}));return i}(t,e),[2,N.ContextMenuManager.createMenu(o,{}).then((function(t){return t.show(i),t}))]}))}))}var H=window.t("Protect Position..."),F=window.t("Close Position"),L=window.t("Reverse Position");i.d(e,"PositionsManager",(function(){return W}));var W=function(){function t(t,e,i){var s=this;this._positionsData=new Map,this._positionsService=t,this._chartWidgetCollection=e,this._brokerCommandsUIGetter=i.brokerCommandsUI,this._trackEvent=i.trackEvent,this._addPositionSources(this._positionsService.positions()),this._positionsService.positionUpdate().subscribe(this,(function(t){return s._addPositionSources([t])})),this._positionsService.positionsRemoved().subscribe(this,this._removePositionSources)}return t.prototype.destroy=function(){this._positionsService.positionUpdate().unsubscribeAll(this),this._positionsService.positionsRemoved().unsubscribeAll(this),
this._positionsData.clear()},t.prototype._addPositionSources=function(t){for(var e=0,i=t;e<i.length;e++){var s=i[e],n=s.id,r=Object(V.clone)(s),a=this._positionsData.get(n);if(void 0===a){a=new o.a(r);var c={};c.reversePosition=this._reversePosition.bind(this),c.closePosition=this._closePosition.bind(this),c.modifyPosition=this._modifyPosition.bind(this),c.showContextMenu=this._showPositionContextMenu.bind(this),R(this._chartWidgetCollection,n,a,c),this._positionsData.set(n,a)}else a.setValue(r)}},t.prototype._removePositionSources=function(t){for(var e=0,i=t;e<i.length;e++){var s=i[e];o=this._chartWidgetCollection,n=s,o.removeCustomSource("position"+n),this._positionsData.delete(s)}var o,n},t.prototype._reversePosition=function(t,e){return this._trackEvent(t,"Reverse Position"),Object(s.ensureNotNull)(this._brokerCommandsUIGetter()).reversePosition(e)},t.prototype._closePosition=function(t,e){this._trackEvent(t,"Close Position");var i=Object(s.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?i.closeTrade(e):i.closePosition(e)},t.prototype._modifyPosition=function(t,e){this._trackEvent(t,"Edit Position");var i=Object(s.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?Object(s.ensureDefined)(i.editTradeBrackets).call(i,e):i.editPositionBrackets(e,{})},t.prototype._showPositionContextMenu=function(t,e,i){return D(t,e,i)},t}()},KSBC:function(t,e,i){"use strict";i.r(e),i.d(e,"ExecutionsPointsManager",(function(){return a}));var s=i("Y7w9"),o=i("aIyQ"),n=i.n(o);function r(t){return void 0!==t.index}var a=function(){function t(t,e,i){this._points=[],this._existingExecutionPointsCache=null,this._offsetOfFirstExistingPoint=null,this._existingPointsChanged=new n.a,this._pointsets=[],this._pointsetManagerFactory=e,this._firstSeriesTimePointWV=i,this._firstSeriesTimePointWV.subscribe(this._updateExistingPoints.bind(this)),this._executionsService=t,this._addPoints(this._executionsService.executions()),this._executionsService.executionsAdded().subscribe(this,this._addPoints),this._executionsService.executionsCleared().subscribe(this,this._clearPoints)}return t.prototype.destroy=function(){this._clearPoints(),this._firstSeriesTimePointWV.destroy(),this._executionsService.executionsAdded().unsubscribeAll(this),this._executionsService.executionsCleared().unsubscribeAll(this),this._executionsService.destroy()},t.prototype.existingPoints=function(){return null===this._offsetOfFirstExistingPoint?[]:(null===this._existingExecutionPointsCache&&(this._existingExecutionPointsCache=this._points.slice(this._offsetOfFirstExistingPoint).filter(r)),this._existingExecutionPointsCache)},t.prototype.existingPointsChanged=function(){return this._existingPointsChanged},t.prototype._onExistingStartPointChanged=function(){this._existingExecutionPointsCache=null,this._existingPointsChanged.fire(this.existingPoints())},t.prototype._addPoints=function(t){if(0!==t.length){var e=function(t){return t.map((function(t){return{time_t:Math.round(t.time/1e3),
index:void 0,isBuyDirection:1===t.side,tooltip:t.tooltip}}))}(t);e.sort((function(t,e){return t.time_t-e.time_t}));var i=0,o=this._points.length>0;o&&(i=Object(s.upperbound)(this._points,e[0].time_t,(function(t,e){return e.time_t>t}),0)),this._points=this._points.slice(0,i).concat(e).concat(this._points.slice(i));var n=this._firstSeriesTimePointWV.value();null!==this._offsetOfFirstExistingPoint&&null!==n&&e[0].time_t<n?this._offsetOfFirstExistingPoint=this._offsetOfFirstExistingPoint+e.length:((null===this._offsetOfFirstExistingPoint||e[0].time_t<this._points[this._offsetOfFirstExistingPoint].time_t)&&(this._offsetOfFirstExistingPoint=this._calcOffsetOfFirstExistingPoint()),null!==this._offsetOfFirstExistingPoint&&(o?i>=this._offsetOfFirstExistingPoint&&this._sendPointsToServer(i,i+e.length):this._sendPointsToServer(this._offsetOfFirstExistingPoint,this._points.length)))}},t.prototype._updateExistingPoints=function(){var t=this._calcOffsetOfFirstExistingPoint();null!==t&&(null===this._offsetOfFirstExistingPoint&&(this._offsetOfFirstExistingPoint=this._points.length),t<this._offsetOfFirstExistingPoint&&(this._sendPointsToServer(t,this._offsetOfFirstExistingPoint),this._offsetOfFirstExistingPoint=t))},t.prototype._clearPoints=function(){for(var t=0,e=this._pointsets;t<e.length;t++){var i=e[t];i.onUpdate().unsubscribeAll(this),i.destroy()}this._pointsets=[],this._points=[],this._offsetOfFirstExistingPoint=null,this._onExistingStartPointChanged()},t.prototype._sendPointsToServer=function(t,e){var i=this._points.slice(t,e).map((function(t){return{time_t:t.time_t,offset:0}}));if(0!==i.length){var s=this._pointsetManagerFactory(i);null!==s&&(s.onUpdate().subscribe(this,this._updatePointsFromServer),this._pointsets.push(s))}},t.prototype._updatePointsFromServer=function(t){if(null!==this._offsetOfFirstExistingPoint){for(var e=Object(s.lowerbound)(this._points,t[0].time_t,(function(t,e){return t.time_t<e}),this._offsetOfFirstExistingPoint),i=Math.max(this._offsetOfFirstExistingPoint,e),o=0,n=t;o<n.length;o++)for(var r=n[o],a=i;a<this._points.length&&(i=a,!(this._points[a].time_t>r.time_t));a++)this._points[a].time_t===r.time_t&&(this._points[a].index=r.index);this._onExistingStartPointChanged()}},t.prototype._calcOffsetOfFirstExistingPoint=function(){var t=this._firstSeriesTimePointWV.value();return null===t?null:Object(s.upperbound)(this._points,t,(function(t,e){return e.time_t>t}),0,this._offsetOfFirstExistingPoint||this._points.length)},t}()},bydf:function(t,e,i){"use strict";i.r(e);var s=i("Eyy1"),o=i("ogJP"),n=i("KtbP"),r=i("mrSG"),a=function(t){function e(e,i,s){var o=t.call(this)||this;return o._model=e,o._source=i,o._priceType=s,o}return Object(r.__extends)(e,t),e.prototype._value=function(){var t=this._model.mainSeries(),e=t.priceScale(),i=t.firstValue();if(null===i)return{noData:!0};var s=this._source.getPrice(this._priceType);if(null===s)return{noData:!0};var o=e.priceToCoordinate(s,i);return{noData:!1,floatCoordinate:o,coordinate:o,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",text:"",index:0}},
e.prototype._priceLineColor=function(t){var e=this._source.properties().childs();return 0===this._priceType?e.bidLineColor.value():e.askLineColor.value()},e.prototype._lineWidth=function(){return this._source.properties().childs().lineWidth.value()},e.prototype._lineStyle=function(){return this._source.properties().childs().lineStyle.value()},e.prototype._isVisible=function(){return this._source.properties().childs().visible.value()},e}(i("TmNs").PriceLineAxisView),c=i("YFKU"),h=function(t){function e(e,i,s){var o=t.call(this)||this;return o._model=e,o._source=i,o._priceType=s,o}return Object(r.__extends)(e,t),e.prototype._updateRendererData=function(t,e,i){if(t.visible=!1,e.visible=!1,this._model.properties().scalesProperties.showBidAskLabels.value()){var s=this._model.mainSeries(),o=s.priceScale(),n=s.firstValue();if(null!==n){var r=this._source.getPrice(this._priceType);if(null!==r){t.visible=!0,e.visible=!0,t.text=o.formatPriceAbsolute(r),e.text=0===this._priceType?Object(c.t)("Bid"):Object(c.t)("Ask"),i.coordinate=o.priceToCoordinate(r,n);var a=this._source.properties().childs();i.background=0===this._priceType?a.bidLineColor.value():a.askLineColor.value()}}}},e}(i("KcY8").a),u=i("2ijp"),l=i("VdBB"),d=function(t){function e(e,i,s,o){var n=t.call(this)||this;n._model=e,n._source=i,n._priceType=s;var r={doubleClickHandler:o,doubleTapHandler:o};return n._lineRenderer.setHitTest(new l.HitTestResult(l.HitTestResult.CUSTOM,r)),n}return Object(r.__extends)(e,t),e.prototype._updateImpl=function(){var t=this._lineRendererData;t.visible=!1;var e=this._source.properties().childs();if(e.visible.value()){var i=this._model.mainSeries(),s=i.priceScale(),o=i.firstValue();if(null!==o){var n=this._source.getPrice(this._priceType);null!==n&&(t.visible=!0,t.y=s.priceToCoordinate(n,o),t.linestyle=e.lineStyle.value(),t.linewidth=e.lineWidth.value(),t.color=0===this._priceType?e.bidLineColor.value():e.askLineColor.value())}}},e}(u.a);i.d(e,"BidAsk",(function(){return _}));var _=function(){function t(t,e,i){this._ask=null,this._bid=null,this._symbol=null,this._model=t,this._realtimeProvider=e,this._bidLinesPaneView=new d(t,this,0,i),this._askLinesPaneView=new d(t,this,1,i),this._bidPriceAxisView=new h(t,this,0),this._askPriceAxisView=new h(t,this,1),this._regularPriceAxisViews=[this._bidPriceAxisView,this._askPriceAxisView],this._bidLabelPaneView=new n.PanePriceAxisView(this._bidPriceAxisView,t.mainSeries(),t),this._askLabelPaneView=new n.PanePriceAxisView(this._askPriceAxisView,t.mainSeries(),t),this._bidPriceLineAxisView=new a(t,this,0),this._askPriceLineAxisView=new a(t,this,1),this._externalPriceAxisViews=[this._bidPriceLineAxisView,this._askPriceLineAxisView],this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this);var s=t.mainSeries().dataEvents();s.symbolResolved().subscribe(this,this._createTradedSymbol),s.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol()}return t.prototype.destroy=function(){var t=this._model.mainSeries().dataEvents();t.symbolResolved().unsubscribeAll(this),
t.symbolError().unsubscribeAll(this),this._clearTradedSymbol()},t.prototype.paneViews=function(t){return this._isMainSourcePane(t)?[this._bidLinesPaneView,this._askLinesPaneView]:[]},t.prototype.labelPaneViews=function(t){return this._isMainSourcePane(t)?[this._bidLabelPaneView,this._askLabelPaneView]:[]},t.prototype.priceAxisViews=function(t,e){return this._isMainSourcePane(t)?t.findTargetPriceAxisViews(this,e,this._regularPriceAxisViews,this._externalPriceAxisViews,!0):[]},t.prototype.priceScale=function(){return this._model.mainSeries().priceScale()},t.prototype.updateAllViews=function(){this._bidLinesPaneView.update(),this._askLinesPaneView.update(),this._bidPriceAxisView.update(),this._askPriceAxisView.update(),this._bidPriceLineAxisView.update(),this._askPriceLineAxisView.update(),this._bidLabelPaneView.update(),this._askLabelPaneView.update()},t.prototype.getPrice=function(t){return 1===t?this._ask:this._bid},t.prototype.properties=function(){return this._model.mainSeries().properties().bidAsk},t.prototype._createTradedSymbol=function(){var t,e,i=(t=this._model.mainSeries(),null===(e=t.symbolInfo())?t.proSymbol():e.pro_name||e.full_name||e.name||null);i!==this._symbol&&(this._clearTradedSymbol(),null!==i&&this._initTradedSymbol(i))},t.prototype._initTradedSymbol=function(t){this._symbol=t,this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler)},t.prototype._clearTradedSymbol=function(){this._ask=null,this._bid=null,null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(Object(s.ensureNotNull)(this._symbol),this._updateRealtimeDataHandler),this._symbol=null)},t.prototype._updateRealtimeData=function(t,e,i){var s=e.ask,n=e.bid;s===n?(this._ask=null,this._bid=null):(Object(o.isNumber)(s)&&(this._ask=s),Object(o.isNumber)(n)&&(this._bid=n)),(this._model.mainSeries().properties().bidAsk.visible.value()||this._model.properties().scalesProperties.showBidAskLabels.value())&&(this.updateAllViews(),this._model.updateSource(this))},t.prototype._isMainSourcePane=function(t){return this._model.paneForSource(this._model.mainSeries())===t},t}()},"fA+p":function(t,e,i){"use strict";i.r(e),i.d(e,"ExecutionsService",(function(){return l}));var s=i("mrSG"),o=i("Eyy1"),n=i("ogJP"),r=i("kcTO"),a=i("2TBc"),c=i("aIyQ"),h=i.n(c),u=i("4qhP"),l=function(t){function e(e,i,s){var o=t.call(this,e)||this;return o._allExecutionsID=new Set,o._executions=[],o._executionsAdded=new h.a,o._executionsCleared=new h.a,o._formatter=new r.PriceFormatter,o._symbol="",o._dataEvents=i,o._getSymbolName=s,o._initialized=!0,o._tryToStart(),o}return Object(s.__extends)(e,t),e.prototype.destroy=function(){this.stopService()},e.prototype.formatter=function(){return this._formatter},e.prototype.executions=function(){return this._executions},e.prototype.executionsAdded=function(){return this._executionsAdded},e.prototype.executionsCleared=function(){return this._executionsCleared},e.prototype.startService=function(){this._canBeStarted=!0,this._tryToStart()},e.prototype.stopService=function(){this._canBeStarted=!1,
this._isStarted&&this._stop()},e.prototype._tryToStart=function(){Object(o.assert)(!this._isStarted,"Execution's service has already started"),this._canBeStarted&&this._initialized&&this._start()},e.prototype._start=function(){Object(o.assert)(!this._isStarted,"Execution's service has already started"),this._isStarted=!0,this._dataEvents.symbolResolved().subscribe(this,this._createExecutions),this._dataEvents.symbolError().subscribe(this,this._createExecutions),this._createExecutions()},e.prototype._stop=function(){this._isStarted=!1,this._clearExecutions(),Object(o.ensure)(this.activeBroker()).executionUpdate.unsubscribeAll(this),this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this)},e.prototype._createExecutions=function(){this._clearExecutions(),this._symbol=this._getSymbolName(),this._symbol&&this._requestFormatterAndExecutions()},e.prototype._clearExecutions=function(){this._allExecutionsID=new Set,this._executions=[],this._executionsCleared.fire()},e.prototype._requestFormatterAndExecutions=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,e,i=this;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return(t=this.activeBroker())&&this._symbol?[4,t.isTradable(this._symbol)]:[2];case 1:return s.sent().tradable?(e=this._symbol,Promise.all([t.formatter(this._symbol,!1),t.executions(this._symbol)]).then((function(s){var o=s[0],r=s[1];i._symbol===e&&(i._formatter=o,i._executions=r.map((function(t){return i._createExecutionData(t)})).filter(n.notNull),i._executionsAdded.fire(i._executions),t.executionUpdate.unsubscribeAll(i),t.executionUpdate.subscribe(i,i._addExecution))})),[2]):[2]}}))}))},e.prototype._addExecution=function(t){var e=this._createExecutionData(t);null!==e&&this._executionsAdded.fire([e])},e.prototype._createExecutionData=function(t){return t.symbol!==this._symbol||this._allExecutionsID.has(t.id)?null:(this._allExecutionsID.add(t.id),Object(s.__assign)(Object(s.__assign)({},t),{tooltip:Object(u.executionText)(t,this._formatter)}))},e}(a.a)}}]);