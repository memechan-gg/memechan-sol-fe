(window.webpackJsonp=window.webpackJsonp||[]).push([["dome-panel"],{"/MDk":function(e,t,i){},"07Ph":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomeData=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i("F/Al"),s=i("OekH"),a=i("zXvd"),o=i("ivNn");var l=i("hY0g");t.DomeData=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._handlers=t||{},this._showPricesWith=i,this.autoCenterRequired=new l(!1),this.height=0,this.topIndex=NaN,this._$container=null,this._$listContainer=null,this._symbolData=null,this._lastPriceIndex=NaN,this._viewAllocated=null,this._viewPool=null,this._invalidatedAsk={},this._invalidatedBid={},this._invalidatedPriceHighlight={},this._invalidatedMax=!1,this._invalidatedBestAskOrBid=!1,this._invalidatedOrders={},this._dynamicModeState=!1,this._numericFormatter=new a.NumericFormatter,this._showPricesWith.zeroVolume.subscribe(this.scheduleRepaint.bind(this)),this._showPricesWith.spread.subscribe(this.scheduleRepaint.bind(this)),this.reset()}return n(e,[{key:"reset",value:function(){this.topIndex=NaN,this._symbolData=null,this._lastPriceIndex=NaN,this.resetData(),this.resetView(),this.resetOrders(),this.resetOrderGhost(),this.resetPosition(),this.autoCenterRequired.setValue(!1)}},{key:"resetData",value:function(){if(this._bids={},this._asks={},this._recalcMaxVolume(),this._recalcBestWorstBid(),this._recalcBestWorstAsk(),this._viewAllocated)for(var e in this._viewAllocated)this._invalidatedAsk[e]=!0,this._invalidatedBid[e]=!0;$(this._$offscreenArrowHigher).addClass("js-hidden"),$(this._$offscreenArrowLower).addClass("js-hidden"),this._offscreenPriceHigher=!1,this._offscreenPriceLower=!1,this.scheduleRepaint()}},{key:"resetOrders",value:function(){if(this._orders)for(var e in this._orders)this._invalidatedOrders[e]=!0;this._orders={},this.scheduleRepaint()}},{key:"resetPosition",value:function(){this._invalidatedPriceHighlight[this._positionIndex]=!0,this._positionIndex=NaN,this._positionQty=0,this.scheduleRepaint()}},{key:"resetView",value:function(){if(this._viewAllocated&&this._viewPool)for(var e in this._viewAllocated)this._viewAllocated[e].$element.detach(),this._viewPool.free(this._viewAllocated[e]),delete this._viewAllocated[e];this._$listContainer&&this._$listContainer.empty(),this.setDragShield(!1),this.scheduleRepaint()}},{key:"setSymbolInfo",value:function(e){var t=e.minTick,i=e.priceFormatter,n=e.volumeFormatter,r=e.quantityFormatter,s=e.qtyProperties;this._symbolData={minTick:t,priceFormatter:i,volumeFormatter:n,quantityFormatter:r,qtyProperties:s}}},{key:"setContainer",value:function(e){if(this._$container!==e){this._$container&&(this.resetView(),this._$container.empty()),this._$container=e;var t=e.prop("ownerDocument");this._containerWnd=t&&t.defaultView,
this._viewPool=new r.DomeRowViewPool(e,this._handlers),this._viewAllocated={},this._$listContainer=$("<div>",e).addClass("tv-dome-widget-main__anchor").appendTo(e),this._$offscreenArrowHigher=$("<span>",e).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--higher js-hidden").html(i("pG/X")).appendTo(e),this._$offscreenArrowLower=$("<span>",e).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--lower js-hidden").html(i("zIOD")).appendTo(e),this._$dragShield=$("<div>",e).addClass("tv-dome-widget-main__drag-shield js-hidden").appendTo(e),this._repaintScheduled=!1,this.scheduleRepaint()}}},{key:"setHeight",value:function(e){e!==this.height&&(this.height=e,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"shiftTopIndexRelativeToIndex",value:function(e,t){var i=this.correctIndex(e,t);this._setTopIndex(i)}},{key:"handlerKey",value:function(e){var t=this.topIndex;this._canIndexBeDisplayed(t)||(t=this.correctIndex(t,-1));var i=this.correctIndex(t,1-this.height);if(isFinite(i))for(var n=this._viewAllocated,r=i;r<=t;r++)if(this._canIndexBeDisplayed(r)){var s=n[r];s&&s.handlerKey(e)}}},{key:"_setTopIndex",value:function(e){e!==this.topIndex&&(this.topIndex=e,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"_canIndexBeDisplayed",value:function(e){var t=this._showPricesWith.zeroVolume.value(),i=this._showPricesWith.spread.value();if(t&&!this.isSpread(e))return!0;if(i&&this.isSpread(e))return!0;var n=e===this._lastPriceIndex,r=e===this._positionIndex,s=void 0!==this._bids[e]||void 0!==this._asks[e],a=e<=this._worstBidIndex||this._worstAskIndex<=e,o=this._orders[e]||[],l=this._orderGhost&&this._orderGhost.index===e;return r||n||l||a||s||0!==o.length}},{key:"correctIndex",value:function(e,t){if(!isFinite(e))return e;if(this._showPricesWith.zeroVolume.value()&&this._showPricesWith.spread.value())return e+t;var i=t>0?1:-1,n=0,r=1;for(t=Math.abs(t);n<t;++r)this._canIndexBeDisplayed(e+i*r)&&(n+=1);return e+i*(r-1)}},{key:"_getGapMiddleIndex",value:function(){var e=this._bestAskIndex,t=this._bestBidIndex;return isFinite(e)||(e=t),isFinite(t)||(t=e),(t+e)/2}},{key:"_autoCenterTargetTopIndex",value:function(){return this.correctIndex(Math.floor(this._getCenterIndex()),Math.floor(this.height/2))}},{key:"_getCenterIndex",value:function(){var e=this._getGapMiddleIndex();return isFinite(e)?e:isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN}},{key:"centerOnLast",value:function(){this.autoCenterRequired.setValue(!1);var e=this._autoCenterTargetTopIndex();isFinite(e)&&this._setTopIndex(e)}},{key:"guessOrderType",value:function(e,t){var i=this.priceToIndex(e);if(isFinite(e)&&(t===s.SIDE.BUY||t===s.SIDE.SELL)){var n=this._bestAskIndex,r=this._bestBidIndex;return isFinite(n)||(n=r+1),isFinite(r)||(r=n-1),isFinite(n)||isFinite(r)||(n=r=this._lastPriceIndex),t===s.SIDE.BUY?i<n?s.ORDERTYPE.LIMIT:s.ORDERTYPE.STOP:i>r?s.ORDERTYPE.LIMIT:s.ORDERTYPE.STOP}}},{key:"indexToPrice",
value:function(e){return e*this._symbolData.minTick}},{key:"priceToIndex",value:function(e){return this._symbolData?Math.round(e/this._symbolData.minTick):void 0}},{key:"_recalcMaxVolume",value:function(){var e=0;for(var t in this._asks)e=Math.max(this._asks[t],e);for(var i in this._bids)e=Math.max(this._bids[i],e);e!==this._currentVolumeMax&&(this._currentVolumeMax=e,this._invalidatedMax=!0)}},{key:"_recalcBestWorstBid",value:function(){var e=-1/0,t=1/0;for(var i in this._bids)+i>e&&(e=+i),+i<t&&(t=+i);this._bestBidIndex!==e&&(this._invalidatedBestAskOrBid=!0),this._bestBidIndex=e,this._worstBidIndex=t}},{key:"_recalcBestWorstAsk",value:function(){var e=1/0,t=-1/0;for(var i in this._asks)+i<e&&(e=+i),+i>t&&(t=+i);this._bestAskIndex!==e&&(this._invalidatedBestAskOrBid=!0),this._bestAskIndex=e,this._worstAskIndex=t}},{key:"updateData",value:function(e){var t=!1;if(e.snapshot){var i=0===Object.keys(this._asks).length&&0===Object.keys(this._bids).length;t=!this._showPricesWith.zeroVolume.value()&&!this._showPricesWith.spread.value()&&i,this.resetData()}if(e.bids){for(var n=0;n<e.bids.length;n++){var r=this.priceToIndex(e.bids[n].price),s=e.bids[n].volume;(this._bids[r]||0)!==s&&(s>0?this._bids[r]=s:delete this._bids[r],this._invalidatedBid[r]=!0)}this._recalcBestWorstBid()}if(e.asks){for(var a=0;a<e.asks.length;a++){var o=this.priceToIndex(e.asks[a].price),l=e.asks[a].volume;(this._asks[o]||0)!==l&&(l>0?this._asks[o]=l:delete this._asks[o],this._invalidatedAsk[o]=!0)}this._recalcBestWorstAsk()}this._recalcMaxVolume(),t?this.centerOnLast():this.checkAutoCenter(),this._dynamicModeState&&this.centerOnLast(),this.scheduleRepaint()}},{key:"updateOrders",value:function(e){this.resetOrders();for(var t=0;t<e.length;t++){var i=e[t];if(null!=i.stopPrice){var n=this.priceToIndex(i.stopPrice);this._orders[n]||(this._orders[n]=[]),this._orders[n].push({order:i,pricePropertyName:"stopPrice"}),this._invalidatedOrders[n]=!0}if(null!=i.limitPrice){var r=this.priceToIndex(i.limitPrice);this._orders[r]||(this._orders[r]=[]),this._orders[r].push({order:i,pricePropertyName:"limitPrice"}),this._invalidatedOrders[r]=!0}}this.scheduleRepaint()}},{key:"updateLast",value:function(e){var t=this.priceToIndex(e);t!==this._lastPriceIndex&&(this._invalidatedPriceHighlight[this._lastPriceIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._lastPriceIndex=t,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"updatePosition",value:function(e){if(e&&e.qty){var t=this.priceToIndex(e.avgPrice),i=Math.abs(e.qty)*(e.side===s.SIDE.BUY?1:-1);this._positionIndex===t&&this._positionQty===i||(this._invalidatedPriceHighlight[this._positionIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._positionIndex=t,this._positionQty=i,this.scheduleRepaint())}else this.resetPosition()}},{key:"resetOrderGhost",value:function(){this._orderGhost&&(this._invalidatedOrders[this._orderGhost.index]=!0,this._invalidatedOrders[this._orderGhost.originIndex]=!0,this._orderGhost=null,this.scheduleRepaint())}},{key:"setOrderGhost",value:function(e){
var t=e.order,i=e.pricePropertyName,n=e.price;this.resetOrderGhost();var r=this.priceToIndex(n);isFinite(r)&&(this._orderGhost={ghost:!0,order:t,pricePropertyName:i,index:r,originIndex:this.priceToIndex(t[i])},this._invalidatedOrders[r]=!0,this.scheduleRepaint())}},{key:"setDragShield",value:function(e){this._$dragShield&&this._$dragShield.toggleClass("js-hidden",!e)}},{key:"scheduleRepaint",value:function(){var e=this;this._repaintScheduled||this._symbolData&&(this._containerWnd&&this._containerWnd.requestAnimationFrame?this._containerWnd.requestAnimationFrame((function(){return e.repaint()})):window.setTimeout((function(){return e.repaint()}),0),this._repaintScheduled=!0)}},{key:"formatVolume",value:function(e){var t=this._symbolData&&this._symbolData.qtyProperties.step;if(e<995&&t<1){var i=(0,o.fixComputationError)(1/t),n=this._numericFormatter.format(Math.round(e*i)/i),r=4+Math.log10(i),s=r>8?r:8;return String(n).slice(0,s)}return this._symbolData.volumeFormatter.format(e).slice(0,8)}},{key:"repaint",value:function(){if(this._repaintScheduled=!1,this._$listContainer&&this._symbolData){var e=this.topIndex;this._canIndexBeDisplayed(e)||(e=this.correctIndex(e,-1));var t=this.correctIndex(e,1-this.height);if(isFinite(t)){for(var i=this._viewAllocated,n=Object.keys(this._viewAllocated),r=n.length;r--;){var a=n[r],o=+a;(o>e||o<t||!this._canIndexBeDisplayed(o))&&(i[a].$element.detach(),this._viewPool.free(i[a]),delete i[a])}for(var l=t;l<=e;l++)if(this._canIndexBeDisplayed(l)){var d=!1,u=i[l];u||(u=this._viewPool.allocate(),i[l]=u,d=!0);var c=this._orderGhost;if(d){var h=this.indexToPrice(l);u.updateIndex(l),u.updatePrice(h),u.updatePriceText(this._symbolData.priceFormatter.format(h))}if((d||this._invalidatedBestAskOrBid)&&u.paintPrice(this.typePrice(l)),(d||this._invalidatedAsk[l])&&(this._asks[l]&&this._asks[l]!==1/0?u.updateAskVolume(this.formatVolume(this._asks[l])):u.updateAskVolume(""),u.updateAskLabels(l<this._bestAskIndex)),(d||this._invalidatedBid[l])&&(this._bids[l]&&this._bids[l]!==1/0?u.updateBidVolume(this.formatVolume(this._bids[l])):u.updateBidVolume(""),u.setHigherThanBid(l>this._bestBidIndex)),(d||this._invalidatedAsk[l]||this._invalidatedMax)&&u.updateAskMeter(this._asks[l]===1/0?100:this._asks[l]/this._currentVolumeMax||0),(d||this._invalidatedBid[l]||this._invalidatedMax)&&u.updateBidMeter(this._bids[l]===1/0?100:this._bids[l]/this._currentVolumeMax||0),d||this._invalidatedPriceHighlight[l]){var _=l===this._lastPriceIndex,p=l===this._positionIndex?this._positionQty:0;u.updatePriceHighlight(_,p)}if(d||this._invalidatedOrders[l]){var v=this._orders[l]||[],m=void 0,f=void 0;this._orderGhost&&(c.index===l&&(c.originIndex!==l?v=v.concat(c):f=c.order.id),c.index!==l&&c.originIndex!==l||(m=c.order.side));for(var y=0;y<v.length;y++){var g=v[y],b=g.order,k=b.filledQty||0;switch(g.inactive=b.status!==s.ORDERSTATUS.WORKING||b.type===s.ORDERTYPE.STOPLIMIT&&"limitPrice"===g.pricePropertyName,b.type){case s.ORDERTYPE.MARKET:g.typeText=$.t("Market"),g.type="market";break;case s.ORDERTYPE.LIMIT:
g.typeText=b.parentId?$.t("TakeProfit"):$.t("Limit"),g.type="limit";break;case s.ORDERTYPE.STOP:g.typeText=b.parentId?$.t("StopLoss"):$.t("Stop",{context:"order"}),g.type="stop";break;case s.ORDERTYPE.STOPLIMIT:g.typeText=$.t("StopLimit"),g.type="stoplimit";break;default:g.typeText=""}g.qty=this._symbolData.quantityFormatter.format(b.qty-k),g.buy=b.side===s.SIDE.BUY,g.noCollapse=b.side===m,g.highlighted=null!=f&&b.id===f&&c.pricePropertyName===g.pricePropertyName}u.hideLabels(),u.updateOrders(v)}if(d){var w=this.correctIndex(l,-1);i[w]?u.$element.insertBefore(i[w].$element):u.$element.appendTo(this._$listContainer)}}if(isFinite(this._lastPriceIndex)){var P=this._lastPriceIndex>e,T=this._lastPriceIndex<t;P!==this._offscreenPriceHigher&&(this._offscreenPriceHigher=P,this._$offscreenArrowHigher.toggleClass("js-hidden",!P)),T!==this._offscreenPriceLower&&(this._offscreenPriceLower=T,this._$offscreenArrowLower.toggleClass("js-hidden",!T))}for(var x in this._invalidatedMax=!1,this._invalidatedBestAskOrBid=!1,this._invalidatedBid)delete this._invalidatedBid[x];for(var C in this._invalidatedAsk)delete this._invalidatedAsk[C];for(var S in this._invalidatedPriceHighlight)delete this._invalidatedPriceHighlight[S];for(var I in this._invalidatedOrders)delete this._invalidatedOrders[I]}}}},{key:"typePrice",value:function(e){return e>=this._bestAskIndex?"ask":e<=this._bestBidIndex?"bid":void 0}},{key:"toggleDynamicModeState",value:function(){return this._dynamicModeState=!this._dynamicModeState,this._dynamicModeState}},{key:"getDynamicModeState",value:function(){return this._dynamicModeState}},{key:"checkAutoCenter",value:function(){isFinite(this.topIndex)||this.centerOnLast();var e=this.topIndex,t=this.correctIndex(this.topIndex,1-this.height),i=void 0;i=isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN;var n=void 0;isFinite(this._bestAskIndex)?n=this._bestAskIndex:isFinite(this._bestBidIndex)?n=this._bestBidIndex:isFinite(this._lastPriceIndex)?i=this._lastPriceIndex:n=NaN;var r=!1;(n+3>e||i-3<t)&&this.topIndex!==this._autoCenterTargetTopIndex()&&(r=!0),this.autoCenterRequired.setValue(r)}},{key:"isSpread",value:function(e){return this._bestAskIndex>e&&e>this._bestBidIndex}}]),e}()},"0W35":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("mrSG");n.__exportStar(i("OGHR"),t),n.__exportStar(i("O6kz"),t)},"4eeX":function(e,t,i){},"77R2":function(e,t,i){},"7R8i":function(e,t,i){},BB8A:function(e,t,i){},E9Pn:function(e,t,i){},"F/Al":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomeRowViewPool=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i("/3z9"),s=i("OekH");function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}
i("/MDk");var o={limitOrder:window.t("Limit"),stopOrder:window.t("Stop")},l=(t.DomeRowViewPool=function(){function e(t,i){a(this,e),this._pool=[];var n=t.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument,this._handlers=i||{},this._ordersPool=new d(t,this._handlers),this._useCssTransform="transform"in this._document.createElement("span").style}return n(e,[{key:"allocate",value:function(){return this._pool.length?this._pool.pop():new l(this._document,this._ordersPool,this._handlers,this._useCssTransform)}},{key:"free",value:function(e){e.destroy(),this._pool.push(e)}}]),e}(),function(){function e(t,i,n,l){var d=this;a(this,e),this._useCssTransform=l,this._ordersPool=i,this._handlers=n,this._allocatedOrderViews=[];var u=t.createElement("div");u.setAttribute("class","tv-dome-widget-main__row");var c=t.createElement("span");c.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--price");var h=t.createElement("span");h.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--sell");var _=t.createElement("span");_.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--buy");var p=t.createElement("span");p.setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--sell");var v=t.createElement("span");v.setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--buy");var m=t.createElement("span");m.setAttribute("class","tv-dome-widget-main__value-readout");var f=t.createElement("span");f.setAttribute("class","tv-dome-widget-main__value-readout");var y=t.createTextNode(""),g=t.createTextNode(""),b=t.createTextNode("");this._useCssTransform&&(p.style.width=v.style.width="100%",p.style.transform=v.style.transform="scale(0, 1)");var k=t.createElement("span");k.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-buy");var w=t.createElement("span");w.textContent=o.limitOrder,w.setAttribute("class","tv-dome-widget-main__label"),k.appendChild(w);var P=t.createElement("span");P.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-sell");var T=t.createElement("span");T.textContent=o.limitOrder,T.setAttribute("class","tv-dome-widget-main__label"),P.appendChild(T),u.appendChild(h),u.appendChild(_),u.appendChild(c),u.appendChild(k),u.appendChild(P),c.appendChild(b),h.appendChild(p),_.appendChild(v),h.appendChild(m),_.appendChild(f),m.appendChild(y),f.appendChild(g),this._priceCell=c,this._priceText=b,this._askText=y,this._bidText=g,this._askMeter=p,this._bidMeter=v,this._ordersBuy=k,this._ordersSell=P,this._orderBuyLabel=w,this._orderSellLabel=T,this._isHigherThanBestBid=!1,this._isLowerThanBestAsk=!1,this._orderType=s.ORDERTYPE.LIMIT,n&&n.bidAskClick&&(h.addEventListener("click",(function(e){return d._handlerCellClick(s.SIDE.SELL,e)}),!1),_.addEventListener("click",(function(e){return d._handlerCellClick(s.SIDE.BUY,e)}),!1)),n&&n.bidAskContextMenu&&(h.addEventListener("contextmenu",(function(e){n.bidAskContextMenu.call(null,e,{
price:d._price,side:s.SIDE.SELL})}),!1),_.addEventListener("contextmenu",(function(e){n.bidAskContextMenu.call(null,e,{price:d._price,side:s.SIDE.BUY})}),!1)),h.addEventListener("mouseover",(function(e){T.textContent=(0,r.modifiersFromEvent)(e)===r.Modifiers.Mod?o.stopOrder:o.limitOrder,T.style.visibility="visible"}),!1),h.addEventListener("mouseout",(function(){T.style.visibility="hidden"}),!1),_.addEventListener("mouseover",(function(e){w.textContent=(0,r.modifiersFromEvent)(e)===r.Modifiers.Mod?o.stopOrder:o.limitOrder,w.style.visibility="visible"}),!1),_.addEventListener("mouseout",(function(){w.style.visibility="hidden"}),!1),this.$element=$(u)}return n(e,[{key:"_handlerCellClick",value:function(e,t){var i=(0,r.modifiersFromEvent)(t);[r.Modifiers.None,r.Modifiers.Mod].includes(i)&&this._handlers.bidAskClick.call(null,t,{price:this._price,side:e,type:i===r.Modifiers.Mod?s.ORDERTYPE.STOP:s.ORDERTYPE.LIMIT})}},{key:"_updateLabelColor",value:function(e,t){var i=e.classList;if(i)i.toggle("tv-dome-widget-main__label--active",t);else{var n="tv-dome-widget-main__label";t&&(n+=" tv-dome-widget-main__label--active"),e.setAttribute("class",n)}}},{key:"_isActive",value:function(e){var t=this._orderType===s.ORDERTYPE.STOP;return t&&!e||!t&&e}},{key:"updatePriceText",value:function(e){this._priceText.nodeValue=e}},{key:"updateBidVolume",value:function(e){this._bidText.nodeValue=e||""}},{key:"updateAskVolume",value:function(e){this._askText.nodeValue=e||""}},{key:"updateBidMeter",value:function(e){var t=Math.min(Math.max(e,0),1)||0;this._useCssTransform?this._bidMeter.style.transform="scale("+t+", 1)":this._bidMeter.style.width=100*t+"%"}},{key:"updateAskMeter",value:function(e){var t=Math.min(Math.max(e,0),1)||0;this._useCssTransform?this._askMeter.style.transform="scale("+t+", 1)":this._askMeter.style.width=100*t+"%"}},{key:"updatePriceHighlight",value:function(e,t){var i=this._priceCell.classList;if(i)i.toggle("tv-dome-widget-main__value--highlighted",e),i.toggle("tv-dome-widget-main__value--long-position",t>0),i.toggle("tv-dome-widget-main__value--short-position",t<0);else{var n="tv-dome-widget-main__value tv-dome-widget-main__value--price";e&&(n+=" tv-dome-widget-main__value--highlighted"),t>0?n+=" tv-dome-widget-main__value--long-position":t<0&&(n+=" tv-dome-widget-main__value--short-position"),this._priceCell.setAttribute("class",n)}}},{key:"setHigherThanBid",value:function(e){this._isHigherThanBestBid=e,this._updateLabelColor(this._orderBuyLabel,this._isActive(e))}},{key:"updateAskLabels",value:function(e){this._isLowerThanBestAsk=e,this._updateLabelColor(this._orderSellLabel,this._isActive(e))}},{key:"handlerKey",value:function(e){var t=(0,r.modifiersFromEvent)(e)===r.Modifiers.Mod;this._orderType=t?s.ORDERTYPE.STOP:s.ORDERTYPE.LIMIT,this._orderSellLabel.textContent=t?o.stopOrder:o.limitOrder,this._orderBuyLabel.textContent=t?o.stopOrder:o.limitOrder,this._updateLabelColor(this._orderBuyLabel,this._isActive(this._isHigherThanBestBid)),
this._updateLabelColor(this._orderSellLabel,this._isActive(this._isLowerThanBestAsk))}},{key:"updateIndex",value:function(e){this._index=e}},{key:"updatePrice",value:function(e){this._price=e}},{key:"hideLabels",value:function(){this._orderBuyLabel.style.visibility="hidden",this._orderSellLabel.style.visibility="hidden"}},{key:"updateOrders",value:function(e){for(;this._allocatedOrderViews.length>e.length;)this._ordersPool.free(this._allocatedOrderViews.pop());for(;this._allocatedOrderViews.length<e.length;)this._allocatedOrderViews.push(this._ordersPool.allocate());for(var t=!1,i=!1,n=e.length;n-- >0;){var r=e[n],s=this._allocatedOrderViews[n],a=!r.noCollapse&&(r.buy?t:i);s.updateOrderData(r.order,r.pricePropertyName),s.updateQty(r.qty),s.updateTypeText(r.typeText),s.updateClassName(r.buy,a,r.type,r.inactive,r.ghost,r.highlighted),r.buy?(this._ordersBuy.appendChild(s.element),t=!0):(this._ordersSell.insertBefore(s.element,this._ordersSell.firstChild),i=!0)}}},{key:"destroy",value:function(){var e=this._allocatedOrderViews.length;if(e>0){for(var t=0;t<e;t++)this._ordersPool.free(this._allocatedOrderViews[t]);this._allocatedOrderViews.length=0}}},{key:"paintPrice",value:function(e){var t=this.$element.context.classList;t.toggle("tv-dome-widget-main__value--color-ask","ask"===e),t.toggle("tv-dome-widget-main__value--color-bid","bid"===e)}}]),e}()),d=function(){function e(t,i){a(this,e),this._pool=[],this._handlers=i;var n=t.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument}return n(e,[{key:"allocate",value:function(){return this._pool.length?this._pool.pop():new u(this._document,this._handlers)}},{key:"free",value:function(e){e.destroy(),this._pool.push(e)}}]),e}(),u=function(){function e(t,n){var r=this;a(this,e);var s=t.createElement("div");s.setAttribute("class","tv-dome-widget-main__order tv-dome-widget-order");var o=t.createElement("div");o.innerHTML=i("BhuR"),o.setAttribute("class","tv-dome-widget-order__close");var l=t.createElement("span");l.setAttribute("class","tv-dome-widget-order__qty");var d=t.createTextNode(""),u=t.createElement("span");u.setAttribute("class","tv-dome-widget-order__type");var c=t.createTextNode("");s.appendChild(o),s.appendChild(l),l.appendChild(d),s.appendChild(u),u.appendChild(c),n&&n.closeButtonClick&&o.addEventListener("click",(function(e){n.closeButtonClick.call(null,e,{order:r._order})}),!1),n&&n.qtyClick&&l.addEventListener("click",(function(e){n.qtyClick.call(null,e,{order:r._order})}),!1),n&&n.orderMousedown&&l.addEventListener("mousedown",(function(e){n.orderMousedown.call(null,e,{order:r._order,pricePropertyName:r._pricePropertyName})}),!1),this.element=s,this._closeButton=o,this._qtyText=d,this._typeText=c}return n(e,[{key:"updateQty",value:function(e){this._qtyText.nodeValue=e||""}},{key:"updateTypeText",value:function(e){this._typeText.nodeValue=e||""}},{key:"updateClassName",value:function(e,t,i,n,r,s){var a="tv-dome-widget-main__order tv-dome-widget-order";t&&(a+=" tv-dome-widget-main__order--collapsed"),
e&&(a+=" tv-dome-widget-order--buy"),i&&(a+=" tv-dome-widget-order--type-"+i),n&&(a+=" tv-dome-widget-order--inactive"),r&&(a+=" tv-dome-widget-order--ghost"),s&&(a+=" tv-dome-widget-order--highlighted"),this.element.setAttribute("class",a)}},{key:"updateOrderData",value:function(e,t){this._order=e,this._pricePropertyName=t}},{key:"destroy",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this._order=null}}]),e}()},F0Qt:function(e){e.exports=JSON.parse('{"wrapper":"wrapper-21v50zE8","input":"input-24iGIobO","box":"box-3574HVnv","icon":"icon-2jsUbtec","noOutline":"noOutline-3VoWuntz","check":"check-382c8Fu1","dot":"dot-3gRd-7Qt"}')},Ft8G:function(e,t,i){},HSHW:function(e,t,i){},JnVP:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.pieChartD=function(e){var t="M 0 0";return e>0&&(e>=1?t="M 0 -1":t+="L 0 -1",e>.5&&(t+="A 1 1 0 0 1 0 1"),t+="A 1 1 0 0 1 "+Math.sin(2*e*Math.PI)+" "+-Math.cos(2*e*Math.PI)+"Z"),t}},KFNk:function(e,t,i){},MPK3:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="#A7B7C0" fill-rule="evenodd" clip-rule="evenodd" d="M13 10H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1zM5 8a3 3 0 0 0-3 3v4a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-4a3 3 0 0 0-3-3H5z"/><circle stroke="#A7B7C0" cx="9" cy="13" r=".5"/><path fill="#A7B7C0" fill-rule="evenodd" stroke="#A7B7C0" clip-rule="evenodd" d="M9 2.1a2.8 2.8 0 0 0-2.86 2.72V9H5V4.82C5 2.7 6.8 1 9 1s4 1.7 4 3.82V9h-1.14V4.82A2.8 2.8 0 0 0 9 2.09z"/></svg>'},NbG7:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return s}));var n=i("q1tI"),r={showRelativePriceControl:!0,showCurrencyRiskInQty:!0,showPercentRiskInQty:!0,showBracketsInCurrency:!0,showBracketsInPercent:!0,showOrderPreview:!0},s=n.createContext({value:r,setValue:function(e){console.warn("unable to modify order ticket settings because context.setValue is not defined")}})},O6kz:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeSwitchGroupItem=void 0;var n=i("mrSG"),r=i("q1tI"),s=i("17x9");t.makeSwitchGroupItem=function(e){var t;return(t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._onChange=function(t){e.context.switchGroupContext.getOnChange()(t)},e._onUpdate=function(t){t.includes(e.props.value)&&e.forceUpdate()},e}return n.__extends(i,t),i.prototype.componentDidMount=function(){this.context.switchGroupContext.subscribe(this._onUpdate)},i.prototype.render=function(){return r.createElement(e,n.__assign({},this.props,{name:this._getName(),onChange:this._onChange,checked:this._isChecked()}))},i.prototype.componentWillUnmount=function(){this.context.switchGroupContext.unsubscribe(this._onUpdate)},i.prototype._getName=function(){return this.context.switchGroupContext.getName()},i.prototype._isChecked=function(){return this.context.switchGroupContext.getValues().includes(this.props.value)},i}(r.PureComponent)).contextTypes={
switchGroupContext:s.any.isRequired},t}},OGHR:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchGroup=void 0;var n=i("mrSG"),r=i("q1tI"),s=i("17x9"),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subscriptions=new Set,t._getName=function(){return t.props.name},t._getValues=function(){return t.props.values},t._getOnChange=function(){return t.props.onChange},t._subscribe=function(e){t._subscriptions.add(e)},t._unsubscribe=function(e){t._subscriptions.delete(e)},t}return n.__extends(t,e),t.prototype.getChildContext=function(){return{switchGroupContext:{getName:this._getName,getValues:this._getValues,getOnChange:this._getOnChange,subscribe:this._subscribe,unsubscribe:this._unsubscribe}}},t.prototype.render=function(){return this.props.children},t.prototype.componentDidUpdate=function(e){this._notify(this._getUpdates(this.props.values,e.values))},t.prototype._notify=function(e){this._subscriptions.forEach((function(t){return t(e)}))},t.prototype._getUpdates=function(e,t){return n.__spreadArrays(t,e).filter((function(i){return t.includes(i)?!e.includes(i):e.includes(i)}))},t.childContextTypes={switchGroupContext:s.any.isRequired},t}(r.PureComponent);t.SwitchGroup=a},"P4l+":function(e,t,i){},PVgW:function(e,t,i){"use strict";i.r(t);i("P5fv"),i("si6p");var n=i("ogJP"),r=i("R4+T");function s(e){return e=Math.abs(e),!Object(n.isInteger)(e)&&e>1&&(e=parseFloat(e.toString().replace(/^.+\./,"0."))),0<e&&e<1?Math.pow(10,function(e){var t=String(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(null===t)return 0;var i=t[1]?t[1].length:0,n=t[2]?parseInt(t[2],0):0;return Math.max(0,i-n)}(e)):1}function a(e,t){e.trigger("tvticker-beforechange");var i=e.data("TVTicker"),r=i&&i.step,a=0;a=i.parser?i.parser(e.val()):Object(n.isInteger)(r)?parseInt(e.val(),10):parseFloat(e.val()),isNaN(a)&&(a=0);var o=s(r),l=t(a,Math.max(o,s(a)));i.formatter&&(l=i.formatter(l)),e.val(l),e.change()}function o(e){var t=e.data("TVTicker"),i=t&&t.step,n=t&&t.max;a(e,(function(e,t){var r=(Math.round(e*t)+Math.round(i*t))/t;return null!=n&&n<r&&(r=e),r}))}function l(e){var t=e.data("TVTicker"),i=t&&t.step,n=t&&t.min;a(e,(function(e,t){var r=(Math.round(e*t)-Math.round(i*t))/t;return null!=n&&r<n&&(r=e),r}))}$.fn.TVTicker=function(e){return void 0===e&&(e={}),this.each((function(){var t=!1,i=$(this),n=i.data("TVTicker");if(n?t=!0:n={step:Number(i.data("step"))||1},"step"in e&&(n.step=Number(e.step)||n.step),"min"in e&&(n.min=e.min),"max"in e&&(n.max=e.max),"formatter"in e&&(n.formatter=e.formatter),"parser"in e&&(n.parser=e.parser),i.data("TVTicker",n),!t){var s=$('<div class="tv-ticker">').appendTo(i.parent()),a=$('<div class="tv-ticker__btn tv-ticker__btn--up">').html(r).appendTo(s),d=$('<div class="tv-ticker__btn tv-ticker__btn--down">').html(r).appendTo(s);s.on("mousedown",(function(e){e.preventDefault(),i.focus()})),a.click((function(){i.is(":disabled")||o(i)})),d.click((function(){i.is(":disabled")||l(i)})),i.keydown((function(e){
i.is(":disabled")||(38===e.keyCode?a.addClass("i-active"):40===e.keyCode&&d.addClass("i-active"))})),i.keyup((function(e){i.is(":disabled")||(38===e.keyCode?(o(i),a.removeClass("i-active")):40===e.keyCode&&(l(i),d.removeClass("i-active")))})),i.mousewheel((function(e){e.deltaY*(e.deltaFactor/100)>0?a.click():d.click()}))}}))}},QAe6:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("q1tI"),r=function(e){var t=Object(n.useState)(e.value()),i=t[0],r=t[1];return Object(n.useEffect)((function(){var t=function(e){return r(e)};return e.subscribe(t),function(){return e.unsubscribe(t)}}),[e]),[i,function(t){return e.setValue(t)}]}},"R4+T":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 8" width="16" height="8"><path fill="currentColor" d="M0 1.475l7.396 6.04.596.485.593-.49L16 1.39 14.807 0 7.393 6.122 8.58 6.12 1.186.08z"/></svg>'},SScx:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomePanel=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i("OekH"),s=i("tjRS"),a=i("N22A"),o=(i("JWMC"),u(i("i8i4"))),l=u(i("q1tI")),d=i("rwBf");function u(e){return e&&e.__esModule?e:{default:e}}i("Ft8G");var c=i("hY0g"),h=i("PT1i").linking;t.DomePanel=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.widget=null,this._resizerBridge=t.resizerBridge,this._height=this._resizerBridge.height,this._innerHeight=new c,this._widgetBody=new c,this._height.subscribe((function(e){i._innerHeight.setValue(Math.max(e-42,0))}),{callWithLast:!0}),this._visible=new c(!1),this._close=function(){},this.trading=(0,a.tradingService)();var n=h.proSymbol.value(),o=this.trading.activeBroker()&&this.trading.activeBroker().metainfo().title;this._symbol=new c({symbol:n||"",exchange:o||""});var l=function(){var e=i.trading.activeBroker(),t=void 0;if(e&&e.connectionStatus()===r.CONNECTSTATUSES.CONNECTED&&!e.metainfo().configFlags.supportDOM){var n=document.querySelector(".tv-dome-panel__content");if(null!==document.querySelector(".tv-dome-panel__disabled")||null==n)return;var s=document.createElement("span");return t=document.createElement("div"),s.classList.add("tv-dome-panel__disabled-warning"),s.innerText=window.t("The DOM window is currently unavailable for this broker"),t.classList.add("tv-dome-panel__disabled"),t.appendChild(s),void n.insertBefore(t,n.firstChild)}(t=document.querySelector(".tv-dome-panel__disabled"))&&t.parentNode&&t.parentNode.removeChild(t)},d=function(e){e?i._body.append(i._header).append(i._container):($(".tv-dome-header",i._body).detach(),$(".tv-dome-panel",i._body).detach()),i._displayHeader(e)};this.trading.onConnectionStatusChange.subscribe(null,l),this._visible.subscribe(l),l(),this._visible.when((function(){i._updateSymbol(h.proSymbol.value()),
i._resizerBridge.container.subscribe((function(e){i._body=$(".trading-panel-content",e),i._createLayout(),i.trading.onBrokerChange.subscribe(i,(function(){return i._updateSymbol(h.proSymbol.value())})),h.proSymbol.spawn().subscribe((function(e){return i._updateSymbol(e)})),l()}),{callWithLast:!0}),i.widget=new s.DomeWidget({body:i._widgetBody,height:i._innerHeight,visible:i._visible}),i._visible.subscribe(d),i._displayHeader(!0)}))}return n(e,[{key:"setCloseHandler",value:function(e){this._close=e}},{key:"setVisibility",value:function(e){this._visible.setValue(e)}},{key:"_displayHeader",value:function(e){this._header&&(e?o.default.render(l.default.createElement(d.HeaderDome,{symbol:this._symbol,closePanel:this._close,domeSettings:this.trading.showPricesWith(),delayedData:this.widget.delayedData}),this._header.get(0)):o.default.unmountComponentAtNode(this._header.get(0)))}},{key:"_createLayout",value:function(){var e=$("<div>",this._body).addClass("tv-dome-header").appendTo(this._body);this._header=e;var t=$("<div>",this._body).addClass("tv-dome-panel");this._container=t;var i=$("<div>",t).addClass("tv-dome-panel__content").appendTo(t);return t.on("contextmenu",(function(e){$(e.target).is("input, textarea")||e.preventDefault()})),this._body.append(t),this._widgetBody.setValue(i),i}},{key:"_updateSymbol",value:function(e){var t=e,i=this.trading.activeBroker()&&this.trading.activeBroker().metainfo().title;this._symbol.setValue({symbol:t||"",exchange:i||""})}}]),e}()},ZYdM:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomeCalcBlock=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i("PVgW");var r=i("OekH"),s=i("zXvd"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("Vdly")),o=i("8wgr");i("4eeX"),i("KFNk");t.DomeCalcBlock=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._handlers=t||{},this._numericFormatter=new s.NumericFormatter,this._nodes={},this._uiState={plViewType:a.getJSON(o.settingsKeys.PROFIT_VIEW_TYPE,0)},this.reset(),this._numFormatter0=new s.NumericFormatter(0),this._numFormatter1=new s.NumericFormatter(1)}return n(e,[{key:"reset",value:function(){this._position=void 0,this._pl=void 0,this._lastPrice=void 0,this._bid=void 0,this._ask=void 0,this._symbolData=null,this.updateQty(1),this._positionInvalidated=!0,this._plInvalidated=!0,this._lastInvalidated=!0,this.scheduleRepaint()}},{key:"setBrokerConfigFlags",value:function(e){var t=e.calculatePLUsingLast;this._calculatePLUsingLast=t}},{key:"setSymbolInfo",value:function(e){var t=this,i=e.minTick,n=e.pipSize,r=e.priceFormatter,s=e.volumeFormatter,a=e.qtyProperties;this._symbolData={minTick:i,pipSize:n,priceFormatter:r,volumeFormatter:s},
this._$qty.TVTicker({min:a.min,step:a.step,max:a.max,format:function(e){return t._numericFormatter.format(e)}})}},{key:"updatePosition",value:function(e){this._position=e,this._position||(this._pl=void 0),this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"updatePL",value:function(e){this._pl=e,this._position&&(this._plInvalidated=!0,this.scheduleRepaint())}},{key:"updateLast",value:function(e,t,i){this._lastPrice=e,this._bid=t,this._ask=i,this._position&&0!==this._uiState.plViewType&&(this._plInvalidated=!0,this.scheduleRepaint())}},{key:"bid",value:function(){return this._bid}},{key:"ask",value:function(){return this._bid}},{key:"updateQty",value:function(e){var t=this._numericFormatter.format(e),i=this._nodes.$qty;i&&i.val()!==t&&(this._suggestedQty=e,i.val(t))}},{key:"getQty",value:function(){var e=parseFloat(this._nodes.$qty.val());return!isFinite(e)||e<0?NaN:e}},{key:"setContainer",value:function(e){var t=this;if(this._nodes.$container)for(var i in this._nodes.$container.empty(),this._nodes)delete this._nodes[i];if(delete this._plDirectionCache,delete this._plTextCache,e){e.empty().addClass("tv-dome-calc-block").html('<div class="tv-dome-widget-calculator tv-dome-calc-block"><div class="tv-dome-calc-block__wrap"><div class="tv-dome-calc-block__qty-wrap"><input class="tv-dome-calc-block__qty tv-text-input js-qty"></div><span class="tv-dome-calc-block__position js-position"></span><span class="tv-dome-calc-block__pl js-pl"></span></div></div>');var n=e.prop("ownerDocument"),r=n.createTextNode(""),s=n.createTextNode(""),l=this._$qty=e.find(".js-qty").val(this._qty||1).addClass("apply-common-tooltip").attr("title",$.t("Quantity")),d=e.find(".js-position").addClass("apply-common-tooltip").attr("title",$.t("Position")).append(s),u=e.find(".js-pl").addClass("apply-common-tooltip").attr("title",$.t("Profit/Loss")).append(r);this._nodes={$container:e,$qty:l,$position:d,$pl:u,plText:r,positionText:s},d.on("click",(function(e){e.preventDefault();var i=Math.abs(t._position&&t._position.qty);i>0&&isFinite(i)&&(t.updateQty(i),l.trigger("change"))})),l.on("change",(function(e){t._handlers&&t._handlers.qtyChange&&(l.val(l.val().replace(/[^\d.]+/g,"")||t._suggestedQty||"1"),t._handlers.qtyChange.call(null,e,{qty:t.getQty()}))})),l.on("keypress",(function(e){e.charCode&&/[^\d.]/.test(String.fromCharCode(e.charCode))&&e.preventDefault()})),this._handlers&&this._handlers.qtyInput&&l.on("input",(function(e){t._handlers.qtyInput.call(null,e,{qty:t.getQty()})})),u.on("click",(function(e){e.preventDefault(),t._uiState.plViewType=-~t._uiState.plViewType%3,t._plInvalidated=!0,a.setValue(o.settingsKeys.PROFIT_VIEW_TYPE,t._uiState.plViewType),t.scheduleRepaint()})),l.TVTicker({min:1,step:1})}this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"scheduleRepaint",value:function(){var e=this;this._repaintScheduled||(window.requestAnimationFrame?window.requestAnimationFrame((function(){return e.repaint()})):window.setTimeout((function(){return e.repaint()}),0),
this._repaintScheduled=!0)}},{key:"repaint",value:function(){this._repaintScheduled=!1;var e=this._nodes;if(e.$container){if(this._positionInvalidated){this._positionInvalidated=!1;var t=this._position&&this._position.qty||0;if(0===t)e.positionText.nodeValue=$.t("Flat");else{var i=Math.abs(t),n=void 0;n=this._symbolData&&this._symbolData.volumeFormatter?this._symbolData.volumeFormatter.format(i):i+"",e.positionText.nodeValue=n}var s=!!this._position&&-1===this._position.side,a=!!this._position&&1===this._position.side;e.$position.toggleClass("tv-dome-calc-block__position--short",s).toggleClass("tv-dome-calc-block__position--long",a)}if(this._plInvalidated){this._plInvalidated=!1;var o=0,l="",d=NaN;if(this._position){var u=this._lastPrice,c=this._position.side===r.SIDE.SELL;this._calculatePLUsingLast||(u=c?this._ask:this._bid),o=(d=(u-this._position.avgPrice)*(c?-1:1))<0?-1:1}if(2===this._uiState.plViewType){var h=NaN;this._position&&(h=d/this._position.avgPrice),l=isFinite(h)?(100*h).toFixed(2)+"%":"%"}else if(1===this._uiState.plViewType){var _=NaN;if(this._position&&this._symbolData){var p=this._symbolData,v=p.pipSize,m=p.minTick;_=(isFinite(v)&&v!==m?this._numFormatter1:this._numFormatter0).format(d/(v||m))}l=isFinite(_)?$.t("{0} pips").format(_):$.t("Pips")}else l=this._position&&isFinite(this._pl)?this._pl.toFixed(2):$.t("P/L");this._plTextCache!==l&&(e.plText.nodeValue=l,this._plTextCache=l),this._plDirectionCache!==o&&(e.$pl.toggleClass("tv-dome-calc-block__pl--loss",o<0).toggleClass("tv-dome-calc-block__pl--profit",o>0),this._plDirectionCache=o)}}}}]),e}()},Zzxg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedCheckbox=t.Checkbox=void 0;var n=i("mrSG"),r=i("q1tI"),s=i("TSYQ"),a=i("0W35"),o=i("vCF3"),l=i("qibD");i("E9Pn");var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e,t,i=s(this.props.className,l.checkbox,((e={})[l.reverse]=Boolean(this.props.labelPositionReverse),e[l.baseline]=Boolean(this.props.labelAlignBaseline),e)),a=s(l.label,((t={})[l.disabled]=this.props.disabled,t)),d=null;return this.props.label&&(d=r.createElement("span",{className:a},this.props.label)),r.createElement("label",{className:i},r.createElement(o.CheckboxInput,n.__assign({},this.props)),d)},t.defaultProps={value:"on"},t}(r.PureComponent);t.Checkbox=d,t.GroupedCheckbox=a.makeSwitchGroupItem(d)},aJjg:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 11 9" width="11" height="9" fill="none"><path stroke-width="2" d="M0.999878 4L3.99988 7L9.99988 1"/></svg>'},d7ok:function(e,t,i){},eE7d:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="#A7B7C0" fill-rule="evenodd" clip-rule="evenodd" d="M13 10H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1zM5 8a3 3 0 0 0-3 3v4a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-4a3 3 0 0 0-3-3H5z"/><circle fill="#A7B7C0" cx="9" cy="13" r="1"/><path fill="#A7B7C0" fill-rule="evenodd" stroke="#A7B7C0" clip-rule="evenodd" d="M9 2.1a2.8 2.8 0 0 0-2.86 2.72V9H5V4.82C5 2.7 6.8 1 9 1a3.96 3.96 0 0 1 3.9 3h-1.17A2.85 2.85 0 0 0 9 2.1z"/></svg>'},en3B:function(e,t,i){"use strict";i.d(t,"h",(function(){return r})),i.d(t,"i",(function(){return s})),i.d(t,"g",(function(){return a})),i.d(t,"a",(function(){return o})),i.d(t,"k",(function(){return l})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"l",(function(){return c})),i.d(t,"j",(function(){return h})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return m})),i.d(t,"m",(function(){return f}));var n,r,s,a,o,l,d,u,c,h,_,p,v=i("q1tI");!function(e){e[e.Wait=0]="Wait",e[e.Active=1]="Active",e[e.Editing=2]="Editing",e[e.Preview=3]="Preview"}(r||(r={})),function(e){e[e.Creating=0]="Creating",e[e.Placed=1]="Placed"}(s||(s={})),function(e){e.Popup="popup",e.Panel="panel"}(a||(a={})),function(e){e[e.StopLoss=0]="StopLoss",e[e.TakeProfit=1]="TakeProfit",e[e.TrailingStop=2]="TrailingStop"}(o||(o={})),function(e){e[e.Stop=0]="Stop",e[e.Limit=1]="Limit"}(l||(l={})),function(e){e[e.TakeProfit=75]="TakeProfit",e[e.StopLoss=25]="StopLoss"}(d||(d={})),function(e){e.Price="Price",e.Pips="Pips",e.Money="Money",e.Percent="Percent"}(u||(u={})),function(e){e.Units="Units",e.RiskInCurrency="RiskInCurrency",e.RiskInPercent="RiskInPercent",e.BaseCurrency="BaseCurrency",e.QuoteCurrency="QuoteCurrency"}(c||(c={})),function(e){e.Absolute="Absolute",e.Relative="Relative"}(h||(h={})),function(e){e[e.Minus=189]="Minus",e[e.NumMinus=109]="NumMinus",e[e.FirefoxMinus=173]="FirefoxMinus"}(_||(_={})),function(e){e[e.Plus=187]="Plus",e[e.NumPlus=107]="NumPlus",e[e.FirefoxPlus=61]="FirefoxPlus"}(p||(p={}));var m=v.createContext({resizerWidth:null,mode:a.Panel,supportTrailingStop:!1}),f=((n={})[1]=window.t("Limit"),n[2]=window.t("Market"),n[3]=window.t("Stop"),n[4]=window.t("Stop Limit"),n)},fV0y:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i("mrSG").__exportStar(i("Zzxg"),t)},mIGQ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.Timer=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._delay=t,this._doneCb=i,this._progressCb=n}return n(e,[{key:"run",value:function(){var e=this;if(!this._timeoutId){var t=Date.now?Date.now():+new Date
;this._expiresAt=t+this._delay,this._timeoutId=window.setTimeout((function(){e.abort(),e._doneCb()}),this._delay),this._trackProgressScheduled||this._trackProgress()}}},{key:"revert",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this.run())}},{key:"abort",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this._expiresAt=void 0,this._progressCb&&this._progressCb(void 0))}},{key:"_trackProgress",value:function(){var e=this;if(this._trackProgressScheduled=!1,this._progressCb&&this._timeoutId){var t=Date.now?Date.now():+new Date,i=1-(this._expiresAt-t)/this._delay;i=Math.max(Math.min(i,1),0),this._progressCb(i),this._wnd&&this._wnd.requestAnimationFrame?this._wnd.requestAnimationFrame((function(){e._trackProgress()})):window.setTimeout((function(){e._trackProgress()}),40),this._trackProgressScheduled=!0}}},{key:"setWindow",value:function(e){this._wnd=e}}]),e}()},"pG/X":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 7a1 1 0 0 1-1-1c0-.276.1-.538.28-.72l5-5C5.463.1 5.725 0 6 0c.276 0 .538.1.72.28l5 5c.18.182.28.444.28.72a1 1 0 0 1-1 1c-.276 0-.538-.1-.72-.28L6 2.437l-4.28 4.28C1.537 6.9 1.275 7 1 7z"/></svg>'},qibD:function(e){e.exports=JSON.parse('{"checkbox":"checkbox-3xZUD-2M","reverse":"reverse-3xeTx96y","label":"label-cyItEVpF","baseline":"baseline-6TXKro4X"}')},rwBf:function(e,t,i){"use strict";i.r(t),i.d(t,"HeaderDome",(function(){return c}));var n=i("q1tI"),r=i("vqb8"),s=i("QAe6"),a=i("1J84"),o=i("KMt6"),l=window.t("Show zero trade volume prices"),d=window.t("Show prices between the best bid/ask"),u=window.t("You are seeing delayed data in the DOM. You need to get the data from your broker, if you want to see it real-time.");function c(e){var t=Object(r.a)({watchedValue:e.symbol}),i=Object(r.a)({watchedValue:e.delayedData}),c=Object(s.a)(e.domeSettings.zeroVolume),h=c[0],_=c[1],p=Object(s.a)(e.domeSettings.spread),v=p[0],m=p[1];return n.createElement(o.a,{title:t.symbol,description:t.exchange&&", "+t.exchange,hasDelayedWarning:i,hasCloseButton:!0,close:e.closePanel,delayedWarningMessage:u},n.createElement(a.a,{label:l,isChecked:h,onClick:function(){return _(!h)}}),n.createElement(a.a,{label:d,isChecked:v,onClick:function(){return m(!v)}}))}},tjRS:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.DomeWidget=void 0;var n,r=i("14Xm"),s=(n=r)&&n.__esModule?n:{default:n},a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(l){r=!0,s=l}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}
return e},l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i("77R2");var d=i("N22A"),u=i("OekH"),c=i("07Ph"),h=i("ZYdM"),_=i("kcTO"),p=i("nEwK"),v=i("JnVP"),m=i("mIGQ"),f=i("9pog"),y=i("Eyy1"),g=i("/DW5"),b=i("7KDR"),k=i("5VQP"),w=i("4qhP");function P(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,i){return function n(r,s){try{var a=t[r](s),o=a.value}catch(l){return void i(l)}if(!a.done)return Promise.resolve(o).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(o)}("next")}))}}i("7R8i"),i("HSHW"),i("BB8A"),i("d7ok");var T=i("PT1i").linking;t.DomeWidget=function(){function t(i){var n=this,r=i.body,s=i.height,a=i.visible;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.delayedData=new e(!1),this._height=s,this._visible=a,this._symbolData=null,this._supportedOrderTypes=[u.ORDERTYPE.MARKET],this._trading=(0,d.tradingService)(),this._realtimeProvider=this._trading.realtimeProvider();var o=this._handlers(),l={zeroVolume:this._trading.showPricesWith().zeroVolume.readonly(),spread:this._trading.showPricesWith().spread.readonly()};this._data=new c.DomeData(o,l),this._calcData=new h.DomeCalcBlock(o),this._uiState={},this._timerLockState={},this._timer=new m.Timer(2e3,(function(){n._data.centerOnLast()}),(function(e){n._updateTimerUi(e)})),this._data.autoCenterRequired.subscribe((function(e){n._mergeTimerLockState({autoCenterRequired:e})})),r.subscribe((function(e){return n._recreateLayout(e)}),{callWithLast:!0}),this._height.subscribe((function(){return n._calculateLayout()})),T.proSymbol.subscribe((function(){return n._onStateChange()})),this._realtimeProvider.onStatusChanged.subscribe(null,(function(){return n._onStateChange()})),a.subscribe((function(){return n._onStateChange()})),this._onStateChange()}var n,r;return l(t,[{key:"_recreateLayout",value:function(e){this._$container&&this._$container.off().empty(),this._$container=e,this._createCalculatorBlock(),this._createLegendBlock(),this._createMainBlock(),this._createNavBlock(),this._createActionsBlock(),this._syncActionButtons(),this._calculateLayout()}},{key:"_createMainBlock",value:function(){var e=this,t=$("<div>",this._$container).addClass("tv-dome-widget-main");t.appendTo(this._$container),this._$warning=$("<div>",this._$container).addClass("tv-dome-panel__warning i-hidden").text($.t("No data")).appendTo(t),this._data.setContainer(t);var i=0;t.on("mousewheel",(function(t){if(t.preventDefault(),!e._data.getDynamicModeState()&&(i+=t.deltaY*t.deltaFactor/100,Math.abs(i)>=1)){var n=i%1;e.uiScroll(i-n),i=n}}));var n=!1;t.on("touchstart mousedown",(function(i){if(!n){var r="mousedown"!==i.type;if(r||1===(i.buttons||i.which)){var s=e._data.topIndex;if(isFinite(s))if(!i.touches||1===i.touches.length)if($(i.target).closest(".tv-dome-widget-main__value--price").eq(0).size()){n=!0
;var a=function(e){return e.originalEvent.touches&&e.originalEvent.touches[0]&&e.originalEvent.touches[0].pageY||e.originalEvent.pageY||0},o=a(i),l=t.parents("html").eq(0),d=function t(){l.off("mouseup mousedown touchend touchstart touchcancel",t),l.off("mousemove touchmove",u),n=!1,e._data.setDragShield(!1),e._mergeTimerLockState({scroll:!1})},u=function(t){if(t.preventDefault(),!e._data.getDynamicModeState()){if(!r&&1!==(t.buttons||t.which))return void d();var i=a(t)-o,n=Math.round(i/20);n&&(e._data.setDragShield(!0),e._mergeTimerLockState({scroll:!0})),e._data.shiftTopIndexRelativeToIndex(s,n)}};l.on(r?"touchmove":"mousemove",u),l.on(r?"touchend":"mouseup",d),r&&l.on("touchcancel",d),setTimeout((function(){n&&l.on(r?"touchstart":"mousedown",d)}),0)}}}})),t.on("dblclick",(function(t){$(t.target).closest(".tv-dome-widget-main__value--price").eq(0).size()&&e.uiCenter()})),this._$mainBlock=t;var r=this._$container.get(0),s=void 0;(s=r.nodeType===Node.DOCUMENT_NODE?r:r.ownerDocument).addEventListener("keydown",(function(t){return e._data.handlerKey(t)}),!1),s.addEventListener("keyup",(function(t){return e._data.handlerKey(t)}),!1)}},{key:"_createActionsBlock",value:function(){var e=this,t=this._$container,i=(0,g.hotKeySerialize)({keys:["Shift","B"],text:"{0} + {1}"}),n=(0,g.hotKeySerialize)({keys:["Shift","S"],text:"{0} + {1}"}),r=window.t("Set DAY Time In Force for the order"),s=window.t("Set GTC Time In Force for the order"),a=window.t("Cancel all the orders for the current symbol"),o=window.t("Close the position"),l=window.t("Reverse the position")
;this._$actionsBlock=$("<div>",t).addClass("tv-dome-widget-actions").html('<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--primary tv-button--size_small js-buy-mkt apply-common-tooltip" data-tooltip-hotkey="'+i+'">Buy Market</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--danger tv-button--size_small js-sell-mkt apply-common-tooltip" data-tooltip-hotkey="'+n+'">Sell Market</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-buttons-group tv-buttons-group--primary tv-buttons-group--size-small">\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__button tv-buttons-group__option tv-buttons-group__option--padding_small js-day apply-common-tooltip" title="'+r+'"><span class="tv-buttons-group__option--content apply-overflow-tooltip">DAY</span></div>\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__button tv-buttons-group__option tv-buttons-group__option--padding_small js-gtc apply-common-tooltip" title="'+s+'"><span class="tv-buttons-group__option--content apply-overflow-tooltip">GTC</span></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-flatten apply-common-tooltip" title="'+o+'">Flatten</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-clear apply-common-tooltip" title="'+a+'">CXL All</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-reverse apply-common-tooltip" title="'+l+'">Reverse</div>\n\t\t\t\t</div>'),this._actionButtons={$buyMarket:this._$actionsBlock.find(".js-buy-mkt").on("click",(function(t){t.preventDefault(),e.uiPlaceOrder({side:u.SIDE.BUY,type:u.ORDERTYPE.MARKET})})),$sellMarket:this._$actionsBlock.find(".js-sell-mkt").on("click",(function(t){t.preventDefault(),e.uiPlaceOrder({side:u.SIDE.SELL,type:u.ORDERTYPE.MARKET})})),$day:this._$actionsBlock.find(".js-day").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("DAY")+"</span>").on("click",(function(t){t.preventDefault(),e._uiState.isTradable&&(e._trackEvent("Select DAY"),e._mergeUiState({gtcOrder:!1}))})),$gtc:this._$actionsBlock.find(".js-gtc").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("GTC")+"</span>").on("click",(function(t){t.preventDefault(),e._uiState.isTradable&&(e._trackEvent("Select GTC"),e._mergeUiState({gtcOrder:!0}))})),$flatten:this._$actionsBlock.find(".js-flatten").text($.t("Flatten")).on("click",(function(t){t.preventDefault(),e.uiClosePosition()})),$clear:this._$actionsBlock.find(".js-clear").text($.t("CXL All")).on("click",(function(t){t.preventDefault(),e.uiCancelAllOrders()})),$reverse:this._$actionsBlock.find(".js-reverse").text($.t("Reverse")).on("click",(function(t){t.preventDefault(),e.uiReversePosition()}))},
this._$actionsBlock.appendTo(this._$container)}},{key:"_createCalculatorBlock",value:function(){this._$calculatorBlock=$("<div>",this._$container).addClass("tv-dome-widget-actions").appendTo(this._$container),this._calcData.setContainer(this._$calculatorBlock)}},{key:"_createLegendBlock",value:function(){var e=this._$container,t=$("<div>",this._$container).addClass("tv-dome-widget-legend");$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--buy").text($.t("Buy")).appendTo(t),$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--price").text($.t("Price")).appendTo(t),$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--sell").text($.t("Sell")).appendTo(t),this._$legendBlock=t,t.appendTo(this._$container)}},{key:"_createNavBlock",value:function(){var e=this,t=this._$container,n={on:i("MPK3"),off:i("eE7d")},r=$("<div>",t).addClass("tv-dome-widget-nav").html('<div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-ask js-clear-ask">'+i("BhuR")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-up js-scroll-up">'+i("pG/X")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--price"><svg class="tv-dome-widget-nav__timer" viewBox="-1 -1 2 2" width="2" height="2"><path d="M 0,0" class="js-timer-path"></path></svg><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--center js-center">'+n.off+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-down js-scroll-down">'+i("zIOD")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-bid js-clear-bid">'+i("BhuR")+"</span></div>");this._$navBlock=r,this._$svgTimerPath=r.find(".js-timer-path"),this._navButtons={$clearBuy:r.find(".js-clear-ask").addClass("apply-common-tooltip").attr("title",$.t("Cancel all buy orders")).on("click",(function(t){t.preventDefault(),e.uiCancelAllOrders(u.SIDE.BUY)})),$clearSell:r.find(".js-clear-bid").addClass("apply-common-tooltip").attr("title",$.t("Cancel all sell orders")).on("click",(function(t){t.preventDefault(),e.uiCancelAllOrders(u.SIDE.SELL)})),$scrollUp:r.find(".js-scroll-up").addClass("apply-common-tooltip").attr("title",$.t("Scroll up")).on("click",(function(t){t.preventDefault(),e.uiScroll(1)})),$scrollDown:r.find(".js-scroll-down").addClass("apply-common-tooltip").attr("title",$.t("Scroll down")).on("click",(function(t){t.preventDefault(),e.uiScroll(-1)})),$centerView:r.find(".js-center").addClass("apply-common-tooltip").attr("title",$.t("Enable dynamic mode")).on("click",(function(t){t.preventDefault(),e.uiCenter()
;var i=e._data.toggleDynamicModeState(),s=i?n.on:n.off,a=i?$.t("Disable dynamic mode"):$.t("Enable dynamic mode");r.find(".js-center").html(s).attr("title",a),r.find(".js-scroll-down, .js-scroll-up").toggleClass("apply-common-tooltip tv-dome-widget-nav__button--mute")}))},r.appendTo(t);var s=r.prop("ownerDocument");this._timer.setWindow(s&&s.defaultView)}},{key:"_syncActionButtons",value:function(){var e=this._uiState,t=e.isTradable,i=e.hasPosition,n=e.hasBuyOrders,r=e.hasSellOrders,s=e.qty,a=e.gtcOrder;if(this._actionButtons){var o=this._actionButtons;if(o.$gtc.toggleClass("i-active",!!this._hasDayGTC&&!!a&&t),o.$day.toggleClass("i-active",!!this._hasDayGTC&&!a&&t),o.$gtc.toggleClass("i-disabled",!this._hasDayGTC||!t),o.$day.toggleClass("i-disabled",!this._hasDayGTC||!t),o.$flatten.toggleClass("i-disabled",!t||!i||!this._hasFlatten),o.$reverse.toggleClass("i-disabled",!t||!i||!this._hasReverse),o.$clear.toggleClass("i-disabled",!t||!(n||r)),s&&t){var l=(0,f.abbreviatedNumber)(s);o.$buyMarket.text($.t("Buy {0} Market").format(l)),o.$sellMarket.text($.t("Sell {0} Market").format(l))}else o.$buyMarket.text($.t("Buy Market")),o.$sellMarket.text($.t("Sell Market"));var d=this._isOrderTypeSupported(u.ORDERTYPE.MARKET);o.$buyMarket.toggleClass("i-disabled",!d),o.$sellMarket.toggleClass("i-disabled",!d)}if(this._navButtons){var c=this._navButtons;c.$clearBuy.toggleClass("tv-dome-widget-nav__button--disabled",!t||!n),c.$clearSell.toggleClass("tv-dome-widget-nav__button--disabled",!t||!r)}}},{key:"_calculateLayout",value:function(){for(var e=this._height.value(),t=!1,i=[{$element:this._$actionsBlock,height:131},{$element:this._$navBlock,height:46},{$element:this._$calculatorBlock,height:49},{$element:this._$legendBlock,height:40}],n=0;n<i.length;n++){var r=i[n],s=r.$element,a=r.height;t||(e-a<100?t=!0:e-=a),t?s.addClass("js-hidden"):s.css("height",a).removeClass("js-hidden")}this._$mainBlock.css("height",e);var o=Math.ceil(e/20);this._data.setHeight(o)}},{key:"uiScroll",value:function(e){this._data.getDynamicModeState()||(this._data.shiftTopIndexRelativeToIndex(this._data.topIndex,0|e),this._timer.revert())}},{key:"uiCenter",value:function(){this._data.centerOnLast(),this._trackEvent("Center")}},{key:"uiCancelOrder",value:function(e){this._uiState.isTradable&&((0,y.ensureNotNull)(this._trading.brokerCommandsUI()).cancelOrder(e,!0),this._trackEvent("Cancel Order"))}},{key:"uiModifyOrder",value:function(e,t){if(!1===this._realtimeProvider.activeBroker().metainfo().configFlags.supportModifyOrder||!e||!this._uiState.isTradable)return Promise.resolve();var i=!0;null==t&&(t={},i=!1);var n=(0,y.ensureNotNull)(this._trading.brokerCommandsUI()).modifyOrder(o({},e,t),i,void 0,!0);return this._lockTimerUntilSettled(n),this._trackEvent("Modify Order"),n}},{key:"uiPlaceOrder",value:function(e){var t=e.side,i=e.price,n=e.altPrice,r=e.type,s=this._realtimeProvider.activeBroker(),a=this,o=s&&s.metainfo().durations;if(s)if(null!==this._subscription.broker){if(r===u.ORDERTYPE.MARKET||isFinite(i)){null==r&&(r=this._data.guessOrderType(i,t))
;var l=!0;if(null==r&&(l=!1,r=u.ORDERTYPE.LIMIT),this._isOrderTypeSupported(r)){var d=t===u.SIDE.BUY?this._calcData.ask():this._calcData.bid(),c={symbol:T.proSymbol.value(),qty:this._calcData.getQty(),side:t,type:r,seenPrice:void 0!==d?d:null,duration:(0,w.getSuitableDuration)(r,o)};null!=c.type&&(c.type===u.ORDERTYPE.STOP?c.stopPrice=i:c.type===u.ORDERTYPE.LIMIT?c.limitPrice=i:c.type===u.ORDERTYPE.STOPLIMIT&&(c.stopPrice=i,isFinite(n)?c.limitPrice=n:l=!1));var h=(0,y.ensureNotNull)(this._trading.brokerCommandsUI()).placeOrder(c,l,!0);return this._lockTimerUntilSettled(h),this._trackEvent("Place Order",u.ORDERTYPE[r]),h}}}else a._trading.toggleTradingWidget();else a._trading.toggleTradingWidget().then((function(){a._trading.onNeedSelectBroker.fire()}))}},{key:"uiCancelAllOrders",value:function(e){var t=this._uiState;if(!t.isTradable||!t.hasBuyOrders&&!t.hasSellOrders||e===u.SIDE.BUY&&!t.hasBuyOrders||e===u.SIDE.SELL&&!t.hasSellOrders)return Promise.resolve();var i=(0,y.ensureNotNull)(this._trading.brokerCommandsUI()).cancelOrders(T.proSymbol.value(),e);return this._lockTimerUntilSettled(i),e?this._trackEvent("Cancel All "+(1===e?"Buy":"Sell")+" Orders"):this._trackEvent("Cancel All Orders"),i}},{key:"uiClosePosition",value:function(){var e=this;if(!this._uiState.isTradable||!this._uiState.hasPosition||!this._hasFlatten)return Promise.resolve();var t=this._realtimeProvider.activeBroker().positions(T.proSymbol.value()).then((function(t){for(var i=0;i<t.length;i++){var n=t[i];if(0!==n.qty)return(0,y.ensureNotNull)(e._trading.brokerCommandsUI()).closePosition(n.id,!0)}}));return this._lockTimerUntilSettled(t),this._trackEvent("Close Position"),t}},{key:"uiReversePosition",value:function(){var e=this;if(!this._uiState.isTradable||!this._uiState.hasPosition||!this._hasReverse)return Promise.resolve();var t=this._realtimeProvider.activeBroker().positions(T.proSymbol.value()).then((function(t){for(var i=0;i<t.length;i++){var n=t[i];if(0!==n.qty)return(0,y.ensureNotNull)(e._trading.brokerCommandsUI()).reversePosition(n.id,!0)}}));return this._lockTimerUntilSettled(t),this._trackEvent("Reverse"),t}},{key:"uiOrderMousedown",value:function(e,t,i){var n=this;if(1===(e.buttons||e.which)){var r=t[i],s=this._data.priceToIndex(t[i]);if(isFinite(s)){this.uiStopOrderDrag();var a=function(e){return e.touches&&e.touches[0]&&e.touches[0].pageY||e.pageY||0},o=a(e),l=NaN,d=!1,u=this._subscription;u.$orderMouseRoot=this._$mainBlock.parents("html").eq(0),u.orderMousemoveHandler=function(e){if(e.preventDefault(),1===(e.buttons||e.which)){var u=0;$(e.target).closest(n._$mainBlock).size()&&(u=o-a(e));var c=Math.round(u/20);if(0===c)l=r;else{var h=n._data.correctIndex(s,c);l=n._data.indexToPrice(h),d=!0,n._data.setDragShield(!0),n._mergeTimerLockState({drag:!0})}d&&n._data.setOrderGhost({order:t,pricePropertyName:i,price:l})}else n.uiStopOrderDrag()},u.orderMouseupHandler=function(e){n.uiStopOrderDrag(),n._realtimeProvider.activeBroker()&&isFinite(l)&&l!==r&&(n._data.setOrderGhost({order:t,pricePropertyName:i,price:l}),n._data.setDragShield(!0),
n._trackEvent("Move Order"),n.uiModifyOrder(t,function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},i,l)).then((function(){return n.uiStopOrderDrag()})).catch((function(){return n.uiStopOrderDrag()})))},u.orderMousedownHandler=function(e){n.uiStopOrderDrag()},u.$orderMouseRoot.on("mousemove",u.orderMousemoveHandler),u.$orderMouseRoot.on("mouseup",u.orderMouseupHandler),setTimeout((function(){u.$orderMouseRoot.on("mousedown",u.orderMousedownHandler)}),0)}}}},{key:"uiStopOrderDrag",value:function(){if(this._data.setDragShield(!1),this._data.resetOrderGhost(),this._mergeTimerLockState({drag:!1}),this._subscription){var e=this._subscription,t=e.orderMousemoveHandler,i=e.orderMouseupHandler,n=e.orderMousedownHandler,r=e.$orderMouseRoot;delete this._subscription.orderMousemoveHandler,delete this._subscription.orderMouseupHandler,delete this._subscription.orderMousedownHandler,delete this._subscription.$orderMouseRoot,r&&t&&r.off("mousemove",t),r&&i&&r.off("mouseup",i),r&&n&&r.off("mousedown",n)}}},{key:"uiContextMenu",value:function(e,t,i){var n=this;if(this._uiState.isTradable&&(t===u.SIDE.BUY||t===u.SIDE.SELL)){var r=T.seriesShortSymbol.value()||T.proSymbol.value(),s=(0,f.abbreviatedNumber)(this._uiState.qty),a=[],o=this._symbolData&&this._symbolData.priceFormatter||new _.PriceFormatter;if(this._trackEvent("Context Menu"),isFinite(i)){var l=o.format(i);if(this._isOrderTypeSupported(u.ORDERTYPE.STOP)){var d={stopPrice:l,qty:s,symbol:r},c="";c=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop",d):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop",d);var h=new b.Action({label:c,onExecute:function(){n.uiPlaceOrder({side:t,price:i,type:u.ORDERTYPE.STOP})}});a.push(h)}if(this._isOrderTypeSupported(u.ORDERTYPE.LIMIT)){var p={limitPrice:l,qty:s,symbol:r},v="";v=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __limitPrice__ Limit",p):$.t("Sell __qty__ __symbol__ @ __limitPrice__ Limit",p);var m=new b.Action({label:v,onExecute:function(){n.uiPlaceOrder({side:t,price:i,type:u.ORDERTYPE.LIMIT})}});a.push(m)}if(this._symbolData&&this._hasStopLimit){var y=i+this._symbolData.minTick*(t===u.SIDE.BUY?1:-1),g={stopPrice:l,limitPrice:o.format(y),qty:s,symbol:r},w="";w=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g);var P=new b.Action({label:w,onExecute:function(){n.uiPlaceOrder({side:t,price:i,altPrice:y,type:u.ORDERTYPE.STOPLIMIT})}});a.push(P)}}if(this._isOrderTypeSupported(u.ORDERTYPE.MARKET)){var x={qty:s,symbol:r},C="";C=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ Market",x):$.t("Sell __qty__ __symbol__ @ Market",x);var S=new b.Action({label:C,onExecute:function(){n.uiPlaceOrder({side:t,type:u.ORDERTYPE.MARKET})}});a.push(S)}a.length&&k.ContextMenuManager.createMenu(a).then((function(t){t.show(e)}))}}},{key:"_mergeUiState",value:function(e){var t=this._uiState,i=!1;for(var n in e)t!==e[n]&&(t[n]=e[n],i=!0);i&&this._syncActionButtons()}},{
key:"_handlers",value:function(){var e=this;return{closeButtonClick:function(t,i){var n=i.order;t.preventDefault(),e.uiCancelOrder(n&&n.id)},qtyClick:function(t,i){var n=i.order;t.preventDefault(),e.uiModifyOrder(n)},bidAskClick:function(t,i){var n=i.side,r=i.price,s=i.type;t.preventDefault(),e.uiPlaceOrder({side:n,price:r,type:s})},bidAskContextMenu:function(t,i){var n=i.side,r=i.price;t.preventDefault(),e.uiContextMenu(t,n,r)},qtyChange:function(t,i){var n=i.qty;!isFinite(n)||n<0||e._trading.suggestedQty().setValue(T.proSymbol.value(),n)},qtyInput:function(t,i){var n=i.qty;!isFinite(n)||n<0||e._mergeUiState({qty:n})},orderMousedown:function(t,i){var n=i.order,r=i.pricePropertyName;e.uiOrderMousedown(t,n,r)}}}},{key:"_mergeTimerLockState",value:function(e){var t=this._timerLockState,i=!1;for(var n in e)t[n]!==e[n]&&(t[n]=e[n],i=!0);i&&(!t.autoCenterRequired||t.scroll||t.drag||t.dialog?this._timer.abort():this._timer.run())}},{key:"_lockTimerUntilSettled",value:function(e){var t=this;if(e){this._mergeTimerLockState({dialog:e});var i=function(){t._timerLockState.dialog===e&&t._mergeTimerLockState({dialog:null})};return e.then(i,i)}}},{key:"_updateTimerUi",value:function(e){e=e||0,this._$svgTimerPath.attr("d",(0,v.pieChartD)(e))}},{key:"_getSymbolData",value:(r=P(s.default.mark((function e(t,i){var n,r,o,l,d,u;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._realtimeProvider.symbolInfo(i),this._realtimeProvider.formatter(i),this._realtimeProvider.quantityFormatter(i)]);case 2:return n=e.sent,r=a(n,3),o=r[0],l=r[1],d=r[2],u=void 0!==o.domVolumePrecision?new p.VolumeFormatter(o.domVolumePrecision):new p.VolumeFormatter,e.abrupt("return",{minTick:o.minTick,pipSize:o.pipSize,priceFormatter:l,volumeFormatter:u,quantityFormatter:d,qtyProperties:o.qty});case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_unsubscribeData",value:function(){if(this._subscription){var e=this._subscription,t=e.broker,i=e.symbol,n=e.domeHandler,r=e.realtimeHandler,s=e.orderHandler,a=e.positionHandler,o=e.plHandler,l=e.plPositionId,d=e.suggestedQtyHandler,u=e.fullUpdateOrders,c=e.fullUpdatePosition;this._subscription=null,i&&r&&this._realtimeProvider.unsubscribeRealtime(i,r),i&&n&&this._realtimeProvider.unsubscribeDOME(i,n),t&&s&&t.orderUpdate.unsubscribe(null,s),t&&a&&t.positionUpdate.unsubscribe(null,a),t&&o&&l&&t.unsubscribePL(l,o),d&&this._trading.suggestedQty().changed.unsubscribe(null,d),t&&u&&t.currentAccountUpdate.unsubscribe(u),t&&c&&t.currentAccountUpdate.unsubscribe(c)}}},{key:"_trackEvent",value:function(e,t){this._trading.trackEvent("DOM",e,t)}},{key:"_processOrders",value:function(e){for(var t=[],i=!1,n=!1,r=0;r<e.length;r++){var s=e[r];if(s.status===u.ORDERSTATUS.PLACING||s.status===u.ORDERSTATUS.INACTIVE||s.status===u.ORDERSTATUS.WORKING)switch(t.push(s),s.side){case u.SIDE.BUY:i=!0;break;case u.SIDE.SELL:n=!0}}this._data.updateOrders(t),this._mergeUiState({hasBuyOrders:i,hasSellOrders:n})}},{key:"_processPositions",
value:function(e,t,i){var n=this,r=i.filter((function(e){return 0!==e.qty}))[0];this._mergeUiState({hasPosition:!!r}),r&&r.id===t.plPositionId||t.plPositionId&&t.plHandler&&(e.unsubscribePL(t.plPositionId,t.plHandler),delete t.plPositionId,delete t.plHandler),r&&(t.plPositionId===r.id&&t.plHandler||(t.plHandler=function(e,i){n._subscription===t&&n._calcData.updatePL(i)},t.plPositionId=r.id,e.subscribePL(t.plPositionId,t.plHandler))),this._data.updatePosition(r),this._calcData.updatePosition(r)}},{key:"_onStateChange",value:(n=P(s.default.mark((function e(){var t,i,n,r,a,o,l,d,u,c=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._visible.value()){e.next=3;break}return this._unsubscribeData(),e.abrupt("return");case 3:if(t=T.proSymbol.value(),i=this._realtimeProvider.activeBroker(),this._noDataTimeout&&clearTimeout(this._noDataTimeout),this._noDataTimeout=setTimeout((function(){return c._$warning.toggleClass("i-hidden",!1)}),3e3),this._symbolData=null,this._unsubscribeData(),this._data.reset(),this._calcData.setBrokerConfigFlags({calculatePLUsingLast:i&&i.metainfo().configFlags.calculatePLUsingLast}),this._calcData.reset(),n=i&&i.metainfo().durations,r=null===i||i.metainfo().configFlags.supportDOM,this._hasDayGTC=!!(n&&n.find((function(e){return"DAY"===e.value}))&&n.find((function(e){return"GTC"===e.value}))),this._hasReverse=i&&i.metainfo().configFlags.supportReversePosition,this._hasFlatten=i&&!i.metainfo().configFlags.supportMultiposition,this._hasStopLimit=i&&i.metainfo().configFlags.supportStopLimitOrders,this._mergeUiState({isTradable:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:void 0}),this._mergeTimerLockState({scroll:!1,drag:!1,dialog:null}),this.uiStopOrderDrag(),a=[],o=[],t&&r){e.next=25;break}return e.abrupt("return");case 25:return l={broker:i,symbol:t,domeHandler:null,realtimeHandler:null,orderHandler:null,positionHandler:null,plHandler:null,plPositionId:void 0,suggestedQtyHandler:null,fullUpdateOrders:null,fullUpdatePosition:null},this._subscription=l,l.suggestedQtyHandler=function(){c._trading.suggestedQty().value(t).then((function(e){c._subscription===l&&(c._calcData.updateQty(e),c._mergeUiState({qty:e}))}))},this._trading.suggestedQty().changed.subscribe(null,l.suggestedQtyHandler),l.suggestedQtyHandler(),e.next=32,this._getSymbolData(i,t);case 32:if(d=e.sent){e.next=35;break}return e.abrupt("return");case 35:if(this._subscription===l){e.next=37;break}return e.abrupt("return");case 37:return this._symbolData=d,this._data.setSymbolInfo(d),this._calcData.setSymbolInfo(d),l.realtimeHandler=function(e,t){var i=t.trade||t.bid||t.ask;i&&c._noDataTimeout&&(c._$warning.toggleClass("i-hidden",!0),clearTimeout(c._noDataTimeout),c._noDataTimeout=null),c._data.updateLast(i),c._calcData.updateLast(t.trade,t.bid,t.ask),c.delayedData.setValue(Boolean(t.isDelayed))},l.domeHandler=function(e,t){c._data.updateData(t)},e.next=44,this._realtimeProvider.isTradable(t);case 44:u=e.sent.tradable,this._mergeUiState({isTradable:u}),
this._realtimeProvider.subscribeRealtime(t,l.realtimeHandler),this._realtimeProvider.subscribeDOME(t,l.domeHandler),this._supportedOrderTypes=this._getSupportedOrderTypes(i),i&&u&&(l.orderHandler=function(e){if(e.symbol===l.symbol){var t=a.findIndex((function(t){return t.id===e.id}));-1!==t?a[t]=e:a.push(e),c._processOrders(a)}},l.positionHandler=function(e){if(e.symbol===l.symbol){var t=o.findIndex((function(t){return t.id===e.id}));-1!==t?o[t]=e:o.push(e),c._processPositions(i,l,o)}},l.fullUpdateOrders=function(){var e=i.orders(t);l.orderPromise=e,e.then((function(t){c._subscription===l&&l.orderPromise===e&&(a=t,c._processOrders(t))}))},l.fullUpdatePosition=function(){var e=i.positions(t);l.positionPromise=e,e.then((function(t){c._subscription===l&&l.positionPromise===e&&(o=t,c._processPositions(i,l,t))}))},i.orderUpdate.subscribe(null,l.orderHandler),i.positionUpdate.subscribe(null,l.positionHandler),i.currentAccountUpdate.subscribe(null,l.fullUpdateOrders),i.currentAccountUpdate.subscribe(null,l.fullUpdatePosition),l.fullUpdateOrders(),l.fullUpdatePosition());case 50:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_getSupportedOrderTypes",value:function(e){var t=[];return null===e||e.connectionStatus()!==u.CONNECTSTATUSES.CONNECTED?[u.ORDERTYPE.MARKET]:(e.metainfo().configFlags.supportMarketOrders&&t.push(u.ORDERTYPE.MARKET),e.metainfo().configFlags.supportLimitOrders&&t.push(u.ORDERTYPE.LIMIT),e.metainfo().configFlags.supportStopOrders&&t.push(u.ORDERTYPE.STOP),e.metainfo().configFlags.supportStopLimitOrders&&t.push(u.ORDERTYPE.STOPLIMIT),t)}},{key:"_isOrderTypeSupported",value:function(e){return-1!==this._supportedOrderTypes.indexOf(e)}}]),t}()}).call(this,i("hY0g"))},vCF3:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckboxInput=void 0;var n=i("q1tI"),r=i("TSYQ"),s=i("Iivm"),a=i("aJjg"),o=i("F0Qt");i("P4l+"),t.CheckboxInput=function(e){var t,i=r(o.box,((t={})[o.check]=!Boolean(e.indeterminate),t[o.dot]=Boolean(e.indeterminate),t[o.noOutline]=-1===e.tabIndex,t));return n.createElement("div",{className:o.wrapper,title:e.title},n.createElement("input",{id:e.id,tabIndex:e.tabIndex,className:o.input,type:"checkbox",name:e.name,checked:e.checked,disabled:e.disabled,value:e.value,autoFocus:e.autoFocus,role:e.role,onChange:function(){e.onChange&&e.onChange(e.value)},ref:e.reference}),n.createElement("div",{className:i},n.createElement(s.Icon,{icon:a,className:o.icon})))}},vqb8:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("q1tI"),r=function(e){var t="watchedValue"in e?e.watchedValue:void 0,i="defaultValue"in e?e.defaultValue:e.watchedValue.value(),r=Object(n.useState)(t?t.value():i),s=r[0],a=r[1];return Object(n.useEffect)((function(){if(t){a(t.value());var e=function(e){return a(e)};return t.subscribe(e),function(){return t.unsubscribe(e)}}return function(){}}),[t]),s}},"y1L/":function(e,t,i){},zIOD:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 0a1 1 0 0 0-1 1c0 .276.1.538.28.72l5 5c.182.18.444.28.72.28.276 0 .538-.1.72-.28l5-5c.18-.182.28-.444.28-.72a1 1 0 0 0-1-1c-.276 0-.538.1-.72.28L6 4.563 1.72.282C1.537.1 1.275 0 1 0z"/></svg>'}}]);