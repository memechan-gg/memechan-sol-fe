(window.webpackJsonp=window.webpackJsonp||[]).push([["bottom-widgetbar"],{"3A7E":function(e,t,i){},Vg5g:function(e,t,i){"use strict";i.r(t),i.d(t,"Bottomwidgetbar",(function(){return d}));i("P5fv");var o=i("hY0g"),n=i.n(o),a=i("Vdly"),s=i("dwZ6"),r=i("ZzsE"),d=(i("3A7E"),i("i8AX"),function(){function e(e,t){var i=this;this._inited=!1,this._minHeight=30,this._paddingTop=s.a,this.open=function(){"minimized"===i._mode.value()&&i._mode.setValue("normal")},this.close=function(){i._mode.setValue("minimized")},this.toggleMaximize=function(){switch(i._mode.value()){case"minimized":case"normal":i._mode.setValue("maximized");break;case"maximized":i._mode.setValue("normal")}},this.toggleMinimize=function(){switch(i._mode.value()){case"minimized":i.open();break;case"normal":case"maximized":i.close()}},this._mode=new n.a,this._isOverlap=new n.a,this._activeWidget=new n.a,this._widgets={},this._buttons={},this._widgetsProperties={},this._normalHeight=new n.a,this._actualHeight=new n.a,this._userSettings=t,this._options=e||{},this._config=e.config,this._enabledWidgets=(e&&e.widgets||[]).filter((function(e){return e&&Boolean(i._config[e])})),this._init(e)}return e.prototype.activeWidget=function(){return this._activeWidget.readonly()},e.prototype.footerWidgetContainer=function(){return this._$footerWidgetContainer[0]},e.prototype.toggleWidget=function(e,t){var i=this;return new Promise((function(o){"boolean"==typeof e?e?i.open():i.close():i.isWidgetEnabled(e)&&(t?i.open():i.activeWidget().value()===e&&"minimized"!==i.mode().value()?i.close():i.open(),i._activeWidget.setValue(e)),o()}))},e.prototype.getWidgetByName=function(e){return this._widgets[e]||null},e.prototype.getButtonByName=function(e){return this._buttons[e]||null},e.prototype.mode=function(){return this._mode.readonly()},e.prototype.isOverlap=function(){return this._isOverlap.readonly()},e.prototype.setNormalHeight=function(e){this._normalHeight.setValue(e)},e.prototype.destroy=function(){},e.prototype.isWidgetEnabled=function(e){return this._enabledWidgets.includes(e)},e.prototype.activateTradingTab=function(){var e=this;return this.toggleWidget("paper_trading",!0).then((function(){var t=e.getWidgetByName("paper_trading");t&&t.activate&&t.activate()}))},e.prototype.activateScriptEditorTab=function(e){var t=this;this.toggleWidget("screener",!0).then((function(){var i=t._config.scripteditor;i&&i.ctor.open(e)}))},e.prototype.turnOffMaximize=function(){"maximized"===this._mode.value()&&this.toggleMaximize()},e.prototype.enabledWidgets=function(){var e=this;return this._enabledWidgets.map((function(t){return e._config[t]}))},e.prototype.activeWidgetName=function(){return this._activeWidget.value()},e.prototype._init=function(e){var t=this;if(this._enabledWidgets.length&&!this._inited){this._createLayout($(this._options.resizerBridge.container.value()));var i=function(){var e=0;switch(t._mode.value()){case"normal":e=t._normalHeight.value();break;case"maximized":e=t._resizerAvailHeight()}var i={min:Math.min(t._getPaddingBoxHeight(e),t._getPaddingBoxHeight(t._minHeight)),
max:t._getPaddingBoxHeight(e)};t._options.resizerBridge.negotiateHeight(i)},o=function(){if("minimized"!==t._mode.value()){var o=t._activeWidget.value(),a=void 0;if(t._$container.removeClass("js-hidden").css({height:t._actualHeight.value()}),t._$container.find(".bottom-widgetbar-content").addClass("js-hidden"),t._widgets[o]){(r=t._widgets[o])&&r._$content&&(a=r._$content).removeClass("js-hidden")}else{(a=$(document.createElement("div")).attr("class","bottom-widgetbar-content "+o)).appendTo(t._$container),t._initWidgetProperties(o);var s=new n.a;t._activeWidget.subscribe((function(e){s.setValue(e===o)}),{callWithLast:!0});var r,d=t._config[o];if(d){var c=d.ctor;t._widgets[o]=new c({$body:a,container:a[0],bottomAreaContainer:t._$container[0],height:t._actualHeight,width:t._options.resizerBridge.width,bottomToolbarMode:t.mode(),visible:s.readonly(),properties:t._widgetsProperties[o],activate:function(){t.toggleWidget(o,!0)},chartWidgetCollection:e.chartWidgetCollection||null,originalStandalone:"screener"===o,backtestingStrategyDispatcher:t._options.backtestingStrategyDispatcher})}(r=t._widgets[o])&&(r._$content=a,r.disabled&&r.disabled.subscribe((function(e){t._$loadingOverlay.toggleClass("js-hidden",!e)})))}}t._normalHeight.unsubscribe(i),t._normalHeight.subscribe(i),t._mode.unsubscribe(i),t._mode.subscribe(i),t._options.resizerBridge.availHeight.unsubscribe(i),t._options.resizerBridge.availHeight.subscribe(i),i(),t._save()};this._mode.subscribe(o),this._activeWidget.subscribe(o),this._normalHeight.subscribe((function(){t._save()})),this._mode.subscribe((function(){t._save()})),this._options.resizerBridge.height.subscribe((function(){var e=t._options.resizerBridge.height.value(),i=Math.max(t._getContentBoxHeight(e),0);t._$container.css("height",i),t._actualHeight.setValue(i)}),{callWithLast:!0}),this._registerWidgets(),this._loadState(),this._subscribeCheckOverlap(),this._inited=!0}},e.prototype._getContentBoxHeight=function(e){return e-this._paddingTop},e.prototype._getPaddingBoxHeight=function(e){return e+this._paddingTop},e.prototype._subscribeCheckOverlap=function(){var e=this;this._checkOverlap(),this._actualHeight.subscribe((function(){e._checkOverlap()})),this._mode.subscribe((function(){e._checkOverlap()})),this._options.resizerBridge.availHeight.subscribe((function(){e._checkOverlap()}))},e.prototype._createLayout=function(e){e[0].innerHTML="",this._$footerWidgetContainer=$("<div>").css({height:s.a}).appendTo(e),this._$container=$("<div>").attr("id","bottom-area").appendTo(e),$(document.createElement("div")).attr("class","bottom-widgetbar-handle").appendTo(this._$container).on("contextmenu",(function(e){e.preventDefault()})).on("mousedown touchstart",this._onLayoutResizeHandleMousedown.bind(this)),this._$loadingOverlay=$(document.createElement("div")).attr("class","bottom-widgetbar-loading-overlay js-hidden").appendTo(this._$container)},e.prototype._onLayoutResizeHandleMousedown=function(e){var t=this;if(!e.defaultPrevented){e.preventDefault()
;var i,o=this._mode.value(),n=this._normalHeight.value(),a="minimized"===this._mode.value()?0:this._$container.height();i=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY;var s=function(e){var o=(e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY)-i,n="minimized"===t._mode.value(),s=a-o;s<=0?(s=a,n=!0):n=!1,s=Math.max(s,t._minHeight),isFinite(s)&&("minimized"===t._mode.value()!==n?n?(t._mode.setValue("minimized"),t.setNormalHeight(Math.max(a,t._minHeight))):(t._mode.setValue("normal"),t.setNormalHeight(s)):t._normalHeight.value()!==s&&(s>=t._getContentBoxHeight(t._resizerAvailHeight())?(t._mode.setValue("maximized"),t.setNormalHeight(a)):(t._mode.setValue("normal"),t.setNormalHeight(s))))},r=function(){n>0&&"normal"!==t._mode.value()&&"normal"!==o&&t.setNormalHeight(n),$(document.documentElement).off("mousemove touchmove",s).off("mouseup touchend",r),t._save()};$(document.documentElement).on("mousemove touchmove",s).on("mouseup touchend",r)}},e.prototype._checkOverlap=function(){var e=this._getPaddingBoxHeight(this._actualHeight.value()),t=this._mode.value();this._isOverlap.setValue("maximized"===t||"normal"===t&&this._resizerAvailHeight()-e<=300)},e.prototype._resizerAvailHeight=function(){return this._options.resizerBridge.availHeight.value()},e.prototype._initWidgetProperties=function(e){var t="bottom"+e+"widget",i=new n.a(a.getJSON(t,null));i.subscribe((function(e){e?a.setJSON(t,e):a.remove(t)})),this._widgetsProperties[e]=i},e.prototype._loadState=function(){var e=this._userSettings;this._mode.setValue(e.mode),this._activeWidget.setValue(this.isWidgetEnabled(e.activeWidget)?e.activeWidget:this._enabledWidgets[0]),this.setNormalHeight(Math.max(e.height,this._minHeight))},e.prototype._save=function(){this._inited&&Object(r.e)({activeWidget:this._activeWidget.value(),height:this._normalHeight.value(),mode:this._mode.value()})},e.prototype._registerWidgets=function(){var e=this;this._enabledWidgets.forEach((function(t){var i=e._config[t];if(i&&"function"==typeof i.onRegister){i.onRegister.call(null,{activate:function(){e.toggleWidget(t,!0)},name:t})}}))},e}())},i8AX:function(e,t,i){}}]);